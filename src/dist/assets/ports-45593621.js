import{m as x,F as r,E as ie,w as ae,i as V,G as y,A as Y,h as D,j as M,x as U,$ as e,t as H,T as re}from"./index-9715db87.js";const se=[{name:"AIR32",identifier:"AR32",vcp:!0},{name:"AIRHEROF3",identifier:"AIR3",vcp:!1},{name:"ALIENFLIGHTF1",identifier:"AFF1",vcp:!1},{name:"ALIENFLIGHTF3",identifier:"AFF3",vcp:!0},{name:"ALIENFLIGHTF4",identifier:"AFF4",vcp:!0},{name:"ANYFCF7",identifier:"ANY7",vcp:!0},{name:"BETAFLIGHTF3",identifier:"BFF3",vcp:!0},{name:"BLUEJAYF4",identifier:"BJF4",vcp:!0},{name:"CC3D",identifier:"CC3D",vcp:!0},{name:"CHEBUZZF3",identifier:"CHF3",vcp:!0},{name:"CJMCU",identifier:"CJM1",vcp:!1},{name:"COLIBRI",identifier:"COLI",vcp:!0},{name:"COLIBRI_RACE",identifier:"CLBR",vcp:!0},{name:"DOGE",identifier:"DOGE",vcp:!0},{name:"ELLE0",identifier:"ELL0",vcp:!0},{name:"F4BY",identifier:"F4BY",vcp:!0},{name:"FISHDRONEF4",identifier:"FDF4",vcp:!0},{name:"FURYF3",identifier:"FYF3",vcp:!0},{name:"FURYF4",identifier:"FYF4",vcp:!0},{name:"FURYF7",identifier:"FYF7",vcp:!0},{name:"IMPULSERCF3",identifier:"IMF3",vcp:!0},{name:"IRCFUSIONF3",identifier:"IFF3",vcp:!0},{name:"ISHAPEDF3",identifier:"ISF3",vcp:!1},{name:"KAKUTEF4",identifier:"KTV1",vcp:!0},{name:"KISSFC",identifier:"KISS",vcp:!0},{name:"KIWIF4",identifier:"KIWI",vcp:!0},{name:"LUXV2_RACE",identifier:"LUXR",vcp:!0},{name:"LUX_RACE",identifier:"LUX",vcp:!0},{name:"MICROSCISKY",identifier:"MSKY",vcp:!1},{name:"MOTOLAB",identifier:"MOTO",vcp:!0},{name:"MULTIFLITEPICO",identifier:"MFPB",vcp:!1},{name:"AFROMINI",identifier:"AFMN",vcp:!1},{name:"NAZE",identifier:"AFNA",vcp:!1},{name:"BEEBRAIN",identifier:"BEBR",vcp:!1},{name:"NERO",identifier:"NERO",vcp:!0},{name:"NUCLEOF7",identifier:"NUC7",vcp:!0},{name:"OMNIBUSF4",identifier:"OBF4",vcp:!0},{name:"OMNIBUSF4SD",identifier:"OBSD",vcp:!0},{name:"OMNIBUS",identifier:"OMNI",vcp:!0},{name:"PIKOBLX",identifier:"PIKO",vcp:!0},{name:"RACEBASE",identifier:"RBFC",vcp:!1},{name:"RCEXPLORERF3",identifier:"REF3",vcp:!0},{name:"AIRBOTF4",identifier:"AIR4",vcp:!0},{name:"PODIUMF4",identifier:"PODI",vcp:!0},{name:"REVO",identifier:"REVO",vcp:!0},{name:"REVOLT",identifier:"RVLT",vcp:!0},{name:"SOULF4",identifier:"SOUL",vcp:!0},{name:"REVONANO",identifier:"REVN",vcp:!0},{name:"RG_SSD_F3",identifier:"RGF3",vcp:!0},{name:"SINGULARITY",identifier:"SING",vcp:!0},{name:"SIRINFPV",identifier:"SIRF",vcp:!0},{name:"SPARKY2",identifier:"SPK2",vcp:!0},{name:"SPARKY",identifier:"SPKY",vcp:!0},{name:"SPRACINGF3EVO",identifier:"SPEV",vcp:!0},{name:"AIORACERF3",identifier:"ARF3",vcp:!0},{name:"RMDO",identifier:"RMDO",vcp:!1},{name:"SPRACINGF3",identifier:"SRF3",vcp:!1},{name:"SPRACINGF3MINI",identifier:"SRFM",vcp:!0},{name:"TINYBEEF3",identifier:"TBF3",vcp:!0},{name:"SPRACINGF3NEO",identifier:"SP3N",vcp:!0},{name:"STM32F3DISCOVERY",identifier:"SDF3",vcp:!0},{name:"TINYFISH",identifier:"TFSH",vcp:!0},{name:"VRRACE",identifier:"VRRA",vcp:!0},{name:"X_RACERSPI",identifier:"XRC3",vcp:!1},{name:"YUPIF4",identifier:"YPF4",vcp:!0},{name:"ZCOREF3",identifier:"ZCF3",vcp:!1}],oe={name:"Unknown",identifier:"????",vcp:!1},W={};W.find_board_definition=function(I){for(const d of se)if(d.identifier===I)return d;return oe};const $={analyticsChanges:{}};$.initialize=function(I){const d=this;let k={};const C=[{name:"MSP",groups:["configuration","msp"],maxPorts:2},{name:"GPS",groups:["sensors"],maxPorts:1},{name:"TELEMETRY_FRSKY",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1},{name:"TELEMETRY_HOTT",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1},{name:"TELEMETRY_SMARTPORT",groups:["telemetry"],maxPorts:1},{name:"RX_SERIAL",groups:["rx"],maxPorts:1},{name:"BLACKBOX",groups:["peripherals"],sharableWith:["msp"],notSharableWith:["telemetry"],maxPorts:1},{name:"TELEMETRY_LTM",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1},{name:"TELEMETRY_MAVLINK",groups:["telemetry"],sharableWith:["msp"],notSharableWith:["peripherals"],maxPorts:1},{name:"IRC_TRAMP",groups:["peripherals"],maxPorts:1},{name:"ESC_SENSOR",groups:["sensors"],maxPorts:1},{name:"TBS_SMARTAUDIO",groups:["peripherals"],maxPorts:1},{name:"TELEMETRY_IBUS",groups:["telemetry"],maxPorts:1},{name:"RUNCAM_DEVICE_CONTROL",groups:["peripherals"],maxPorts:1},{name:"LIDAR_TF",groups:["peripherals"],maxPorts:1}];x.gte(r.CONFIG.apiVersion,ie)&&C.push({name:"FRSKY_OSD",groups:["peripherals"],maxPorts:1}),x.gte(r.CONFIG.apiVersion,ae)&&C.push({name:"VTX_MSP",groups:["peripherals"],sharableWith:["msp"],maxPorts:1});for(const o of C)o.displayName=V.getMessage(`portsFunction_${o.name}`);let w=["9600","19200","38400","57600","115200","230400","250000","500000","1000000"];const Z=["AUTO","9600","19200","38400","57600","115200"],J=["AUTO","9600","19200","38400","57600","115200"],z=["AUTO","19200","38400","57600","115200","230400","250000","1500000","2000000","2470000"],K=["configuration","peripherals","sensors","telemetry","rx"];y.active_tab="ports",j();function j(){let o;x.gte(r.CONFIG.apiVersion,Y)?o=D.promise(M.MSP_VTX_CONFIG):o=Promise.resolve(),o.then(function(){U.loadSerialConfig(m)});function m(){e("#content").load("./tabs/ports.html",Q),k=W.find_board_definition(r.CONFIG.boardIdentifier),console.log("Using board definition",k)}}function q(){d.analyticsChanges={},e(".tab-ports").addClass("supported");const o=20,m={0:"UART1",1:"UART2",2:"UART3",3:"UART4",4:"UART5",5:"UART6",6:"UART7",7:"UART8",8:"UART9",9:"UART10",20:"USB VCP",30:"SOFTSERIAL1",31:"SOFTSERIAL2",40:"LPUART1"};let F=e("select.gps_baudrate");for(const t of Z)F.append(`<option value="${t}">${t}</option>`);let S=e("select.msp_baudrate");for(const t of w)S.append(`<option value="${t}">${t}</option>`);let _=e("select.telemetry_baudrate");for(const t of J)_.append(`<option value="${t}">${t}</option>`);let s=e("select.blackbox_baudrate");for(const t of z)s.append(`<option value="${t}">${t}</option>`);let h,N;const g=e(".tab-ports .ports"),i=e("#tab-ports-templates .portIdentifier"),P=e("#tab-ports-templates .portConfiguration");for(let t=0;t<r.SERIAL_CONFIG.ports.length;t++){const p=i.clone(),a=P.clone(),n=r.SERIAL_CONFIG.ports[t];a.data("serialPort",n),S=a.find("select.msp_baudrate"),S.val(n.msp_baudrate),_=a.find("select.telemetry_baudrate"),_.val(n.telemetry_baudrate);let c;n.functions.indexOf("GPS")>=0?c=n.gps_baudrate:c="AUTO",F=a.find("select.gps_baudrate"),F.val(c);let A;n.functions.indexOf("BLACKBOX")>=0?A=n.blackbox_baudrate:A="AUTO",s=a.find("select.blackbox_baudrate"),s.val(A),p.find(".identifier").text(m[n.identifier]),a.find(".identifier").text(m[n.identifier]),a.data("index",t),a.data("port",n);for(let O=0;O<K.length;O++){const f=K[O],T=e(a).find(`.functionsCell-${f}`);for(let B=0;B<C.length;B++){const G=C[B],l=G.name;if(G.groups.indexOf(f)===-1)continue;let u;if(f!=="telemetry"&&f!=="sensors"&&f!=="peripherals"){const E=`functionCheckbox-${t}-${O}-${B}`;let L='<span class="function"><input type="checkbox" class="togglemedium" id=';if(L+=`"${E}" value="${l}" /><label for="${E}"></label></span>`,T.prepend(L),n.functions.indexOf(l)>=0&&T.find(`#${E}`).prop("checked",!0),n.identifier===o&&l==="MSP"){const b=T.find(`#${E}`);b.prop("checked",!0),b.prop("disabled",!0)}}else{const E=`function-${f}`,L=`select[name=${E}]`;u=T.find(L);const b=V.getMessage("portsTelemetryDisabled");if(u.length===0&&(T.prepend(`<span class="function"><select name="${E}" /></span>`),u=T.find(L),u.append(`<option value="">${b}</option>`)),u.append(`<option value="${l}">${G.displayName}</option>`),u.sortSelect(b),n.functions.indexOf(l)>=0&&(u.val(l),f==="peripherals"&&(l==="TBS_SMARTAUDIO"||l==="IRC_TRAMP")&&(h=l),f==="peripherals"&&l.includes("MSP")&&(N=l)),f==="telemetry"){const te=l;u.on("change",function(){const ne=e(this).val();let X;ne!==te&&(X=e(this).find("option:selected").text()),d.analyticsChanges.Telemetry=X})}}}}g.find("tbody").append(p),g.find("tbody").append(a)}let R=!0;x.gte(r.CONFIG.apiVersion,Y)?R=r.VTX_CONFIG.vtx_table_available&&(r.VTX_CONFIG.vtx_table_bands===0||r.VTX_CONFIG.vtx_table_channels===0||r.VTX_CONFIG.vtx_table_powerlevels===0):e(".vtxTableNotSet").hide();const v=e('select[name="function-peripherals"]');v.on("change",function(){let t,p;v.each(function(a,n){const c=e(n).val();(c==="TBS_SMARTAUDIO"||c==="IRC_TRAMP")&&(t=c),c.includes("MSP")&&(p=c,e(".tab-ports .portConfiguration").each(function(A,O){e(O).find("select[name=function-peripherals]").val().includes("MSP")&&a===A&&e(`#functionCheckbox-${A}-0-0`).prop("checked",!0).trigger("change")}))}),h!==t&&(d.analyticsChanges.VtxControl=t,h=t),N!==p&&(d.analyticsChanges.MspControl=p,N=p),x.gte(r.CONFIG.apiVersion,Y)&&e(".vtxTableNotSet").toggle(t&&R)}),v.trigger("change")}function Q(){V.localizePage(),q(),e("a.save").on("click",ee),y.interval_add("status_pull",function(){D.send_message(M.MSP_STATUS)},250,!0),y.content_ready(I)}function ee(){H.sendSaveAndChangeEvents(H.EVENT_CATEGORIES.FLIGHT_CONTROLLER,d.analyticsChanges,"ports"),d.analyticsChanges={},r.SERIAL_CONFIG.ports=[],e(".tab-ports .portConfiguration").each(function(g,i){const P=e(i).data("serialPort"),R=e(i).find("input:checkbox:checked").map(function(){return this.value}).get(),v=e(i).find("select[name=function-telemetry]").val();v&&R.push(v);const t=e(i).find("select[name=function-sensors]").val();t&&R.push(t);const p=e(i).find("select[name=function-peripherals]").val();p&&R.push(p);let a=e(i).find(".gps_baudrate").val();a==="AUTO"&&(a="57600");let n=e(i).find(".blackbox_baudrate").val();n==="AUTO"&&(n="115200");const c={functions:R,msp_baudrate:e(i).find(".msp_baudrate").val(),telemetry_baudrate:e(i).find(".telemetry_baudrate").val(),gps_baudrate:a,blackbox_baudrate:n,identifier:P.identifier};r.SERIAL_CONFIG.ports.push(c)});let o=!1,m=!1,F=!1,S=!1,_=!1;for(const g of r.SERIAL_CONFIG.ports){const i=g.functions;i.includes("RX_SERIAL")&&(o=!0),i.some(P=>P.startsWith("TELEMETRY"))&&(m=!0),i.includes("BLACKBOX")&&(F=!0),i.includes("ESC_SENSOR")&&(S=!0),i.includes("GPS")&&(_=!0)}const s=r.FEATURE_CONFIG.features;o?s.enable("RX_SERIAL"):s.disable("RX_SERIAL"),m&&s.enable("TELEMETRY"),F?s.enable("BLACKBOX"):s.disable("BLACKBOX"),S?s.enable("ESC_SENSOR"):s.disable("ESC_SENSOR"),_?s.enable("GPS"):s.disable("GPS"),U.sendSerialConfig(h);function h(){D.send_message(M.MSP_SET_FEATURE_CONFIG,U.crunch(M.MSP_SET_FEATURE_CONFIG),!1,N)}function N(){U.writeConfiguration(!0)}}};$.cleanup=function(I){I&&I()};re.ports=$;export{$ as ports};
