import{F as i,Z as qe,m as o,I as F,$ as e,h as S,j as g,x as Q,T as _e,G as he,w as X,i as y,f as Te,A as Ce,a0 as Ve,t as ze,X as We,a1 as Xe,a2 as be,E as ne,Y as ve}from"./index-9715db87.js";import{R as He}from"./RateCurve-9f00eea3.js";const ke={redWhiteGreen:[{percentage:-1,color:{r:255,g:0,b:0,a:1}},{percentage:0,color:{r:255,g:255,b:255,a:1}},{percentage:1,color:{r:0,g:255,b:0,a:1}}],pidSlider:[{percentage:-1,color:{r:197,g:197,b:197,a:1}},{percentage:0,color:{r:255,g:255,b:255,a:0}},{percentage:1,color:{r:255,g:84,b:14,a:1}}]};function $e(r,t=null){t=t||ke.redWhiteGreen,r=Math.min(1,Math.max(-1,r));let l;for(l=1;l<t.length-1&&!(r<t[l].percentage);l++);const _=t[l-1],I=t[l],s=I.percentage-_.percentage,E=(r-_.percentage)/s,c=1-E,u=E,L={r:Math.floor(_.color.r*c+I.color.r*u),g:Math.floor(_.color.g*c+I.color.g*u),b:Math.floor(_.color.b*c+I.color.b*u),a:_.color.a*c+I.color.a*u};return`rgba(${[L.r,L.g,L.b,L.a].join(",")})`}const n={sliderMasterMultiplierLegacy:1,sliderPDRatio:1,sliderPDGain:1,sliderFeedforwardGainLegacy:1,sliderPidsMode:2,sliderDGain:1,sliderPIGain:1,sliderFeedforwardGain:1,sliderDMaxGain:1,sliderIGain:1,sliderRollPitchRatio:1,sliderPitchPIGain:1,sliderMasterMultiplier:1,pidSlidersUnavailable:!1,GyroSliderUnavailable:!1,DTermSliderUnavailable:!1,sliderGyroFilter:1,sliderGyroFilterMultiplier:1,sliderDTermFilter:1,sliderDTermFilterMultiplier:1,dMinFeatureEnabled:!0,defaultPDRatio:0,PID_DEFAULT:[],FILTER_DEFAULT:{},SLIDER_DEFAULT:{},NON_EXPERT_SLIDER_MIN:70,NON_EXPERT_SLIDER_MAX:140,NON_EXPERT_SLIDER_MIN_GYRO:50,NON_EXPERT_SLIDER_MAX_GYRO:150,NON_EXPERT_SLIDER_MIN_DTERM:80,NON_EXPERT_SLIDER_MAX_DTERM:120,cachedPidSliderValues:!1,cachedGyroSliderValues:!1,cachedDTermSliderValues:!1,expertMode:!1},Oe=.85;n.setDMinFeatureEnabled=function(r){this.dMinFeatureEnabled=r,this.dMinFeatureEnabled?this.defaultPDRatio=this.PID_DEFAULT[2]/this.PID_DEFAULT[0]:this.defaultPDRatio=this.PID_DEFAULT[2]/(this.PID_DEFAULT[0]*(1/Oe))};n.initialize=function(){this.PID_DEFAULT=i.getPidDefaults(),this.FILTER_DEFAULT=i.getFilterDefaults(),this.SLIDER_DEFAULT=i.getSliderDefaults(),this.setExpertMode(qe()),this.cachedPidSliderValues=!1,this.cachedGyroSliderValues=!1,this.cachedDTermSliderValues=!1,o.gte(i.CONFIG.apiVersion,F)?(this.initPidSlidersPosition(),this.initGyroFilterSliderPosition(),this.initDTermFilterSliderPosition(),this.validateTuningSliders(),this.updatePidSlidersDisplay(),this.updateGyroFilterSliderDisplay(),this.updateDTermFilterSliderDisplay(),this.updateFilterSlidersWarning(),e(".subtab-pid .slidersDisabled").hide(),e(".subtab-filter .slidersDisabled").hide()):(e("#sliderGyroFilterMultiplier, #sliderDTermFilterMultiplier").attr("min","0.5"),e("#sliderGyroFilterMultiplier, #sliderDTermFilterMultiplier").attr("max","1.5"),this.setDMinFeatureEnabled(e("#dMinSwitch").is(":checked")),this.initPidSlidersPosition(),this.initGyroFilterSliderPosition(),this.initDTermFilterSliderPosition(),this.dMinFeatureEnabled?(i.ADVANCED_TUNING.dMinRoll=i.PIDS_ACTIVE[0][2],i.ADVANCED_TUNING.dMinPitch=i.PIDS_ACTIVE[1][2],i.ADVANCED_TUNING.dMinYaw=i.PIDS_ACTIVE[2][2]):(i.PIDS[0][2]=i.ADVANCED_TUNING.dMinRoll,i.PIDS[1][2]=i.ADVANCED_TUNING.dMinPitch,i.PIDS[2][2]=i.ADVANCED_TUNING.dMinYaw),this.updatePidSlidersDisplay(),this.updateFilterSlidersDisplay(),e('select[id="sliderGyroFilterModeSelect"]').hide(),e('select[id="sliderDTermFilterModeSelect"]').hide())};n.updateExpertModePidSlidersDisplay=function(){const r=i.TUNING_SLIDERS.slider_d_gain<this.NON_EXPERT_SLIDER_MIN||i.TUNING_SLIDERS.slider_d_gain>this.NON_EXPERT_SLIDER_MAX,t=i.TUNING_SLIDERS.slider_pi_gain<this.NON_EXPERT_SLIDER_MIN||i.TUNING_SLIDERS.slider_pi_gain>this.NON_EXPERT_SLIDER_MAX,l=i.TUNING_SLIDERS.slider_feedforward_gain<this.NON_EXPERT_SLIDER_MIN||i.TUNING_SLIDERS.slider_feedforward_gain>this.NON_EXPERT_SLIDER_MAX,_=i.TUNING_SLIDERS.slider_dmax_gain!==i.DEFAULT_TUNING_SLIDERS.slider_dmax_gain,I=i.TUNING_SLIDERS.slider_i_gain!==i.DEFAULT_TUNING_SLIDERS.slider_i_gain,s=i.TUNING_SLIDERS.slider_roll_pitch_ratio!==i.DEFAULT_TUNING_SLIDERS.slider_roll_pitch_ratio,E=i.TUNING_SLIDERS.slider_pitch_pi_gain!==i.DEFAULT_TUNING_SLIDERS.slider_pitch_pi_gain,c=i.TUNING_SLIDERS.slider_master_multiplier!==i.DEFAULT_TUNING_SLIDERS.slider_master_multiplier,u=r||t||l,L=_||I||s||E||c;e(".baseSliderDGain").toggleClass("disabledSliders",!this.sliderPidsMode||r&&!this.expertMode),e(".baseSliderPIGain").toggleClass("disabledSliders",!this.sliderPidsMode||t&&!this.expertMode),e(".baseSliderFeedforwardGain").toggleClass("disabledSliders",!this.sliderPidsMode||l&&!this.expertMode),e(".advancedSlider").toggleClass("disabledSliders",!this.sliderPidsMode||!this.expertMode),e(".advancedSliderDmaxGain").toggle(_||this.expertMode),e(".advancedSliderIGain").toggle(I||this.expertMode),e(".advancedSliderRollPitchRatio").toggle(s||this.expertMode),e(".advancedSliderPitchPIGain").toggle(E||this.expertMode),e(".advancedSliderMaster").toggle(c||this.expertMode),e("#sliderDGain").prop("disabled",!this.sliderPidsMode||r&&!this.expertMode),e("#sliderPIGain").prop("disabled",!this.sliderPidsMode||t&&!this.expertMode),e("#sliderFeedforwardGain").prop("disabled",!this.sliderPidsMode||l&&!this.expertMode),e("#sliderDMaxGain").prop("disabled",!this.sliderPidsMode||_&&!this.expertMode),e("#sliderIGain").prop("disabled",!this.sliderPidsMode||I&&!this.expertMode),e("#sliderRollPitchRatio").prop("disabled",!this.sliderPidsMode||s&&!this.expertMode),e("#sliderPitchPIGain").prop("disabled",!this.sliderPidsMode||E&&!this.expertMode),e("#sliderMasterMultiplier").prop("disabled",!this.sliderPidsMode||c&&!this.expertMode),e(".subtab-pid .expertSettingsDetectedNote").toggle(!this.sliderPidsMode||(u||L)&&!this.expertMode)};n.updateExpertModeFilterSlidersDisplay=function(){const r=(i.TUNING_SLIDERS.slider_gyro_filter_multiplier<this.NON_EXPERT_SLIDER_MIN_GYRO||i.TUNING_SLIDERS.slider_gyro_filter_multiplier>this.NON_EXPERT_SLIDER_MAX_GYRO)&&!this.expertMode,t=(i.TUNING_SLIDERS.slider_dterm_filter_multiplier<this.NON_EXPERT_SLIDER_MIN_DTERM||i.TUNING_SLIDERS.slider_dterm_filter_multiplier>this.NON_EXPERT_SLIDER_MAX_DTERM)&&!this.expertMode,l=e('.pid_filter input[name="gyroLowpassDynMinFrequency"]'),_=e('.pid_filter input[name="gyroLowpassFrequency"]'),I=e('.pid_filter input[name="gyroLowpass2Frequency"]'),s=e('.pid_filter input[name="dtermLowpassDynMinFrequency"]'),E=e('.pid_filter input[name="dtermLowpassFrequency"]'),c=e('.pid_filter input[name="dtermLowpass2Frequency"]'),u=parseInt(l.val())===0&&parseInt(_.val())===0&&parseInt(I.val())===0,L=parseInt(s.val())===0&&parseInt(E.val())===0&&parseInt(c.val())===0,x=!this.sliderGyroFilter||r||u,v=!this.sliderDTermFilter||t||L;e(".sliderGyroFilter").toggleClass("disabledSliders",x),e(".sliderDTermFilter").toggleClass("disabledSliders",v),e("#sliderGyroFilterMultiplier").prop("disabled",x),e("#sliderDTermFilterMultiplier").prop("disabled",v),e(".subtab-filter .expertSettingsDetectedNote").toggle(r||t)};n.setExpertMode=function(r){this.expertMode=r,o.gte(i.CONFIG.apiVersion,F)?(this.updateExpertModePidSlidersDisplay(),this.updateExpertModeFilterSlidersDisplay(),e(".tab-pid_tuning .legacySlider").hide(),e(".legacyNonExpertModeSlidersNote").hide(),e(".subtab-pid .nonExpertModeSlidersNote").toggle(!this.pidSlidersUnavailable&&!this.expertMode),e(".subtab-filter .nonExpertModeSlidersNote").toggle((!this.GyroSliderUnavailable||!this.DTermSliderUnavailable)&&!this.expertMode)):(e("#slidersPidsBox, #slidersFilterBox").toggleClass("nonExpertModeSliders",!this.expertMode),e(".tab-pid_tuning .baseSlider").hide(),e(".tab-pid_tuning .advancedSlider").hide(),e(".nonExpertModeSlidersNote").hide(),e(".expertSettingsDetectedNote").hide(),e(".subtab-pid .legacyNonExpertModeSlidersNote").toggle(!this.pidSlidersUnavailable&&!this.expertMode),e(".subtab-filter .legacyNonExpertModeSlidersNote").toggle((!this.GyroSliderUnavailable||!this.DTermSliderUnavailable)&&!this.expertMode))};n.scaleSliderValue=function(r){return r>1?Math.round(((r-1)*2+1)*10)/10:r};n.downscaleSliderValue=function(r){return r>1?(r-1)/2+1:r};n.initPidSlidersPosition=function(){o.gte(i.CONFIG.apiVersion,F)?(this.sliderPidsMode=i.TUNING_SLIDERS.slider_pids_mode,this.sliderDGain=i.TUNING_SLIDERS.slider_d_gain/100,this.sliderPIGain=i.TUNING_SLIDERS.slider_pi_gain/100,this.sliderFeedforwardGain=i.TUNING_SLIDERS.slider_feedforward_gain/100,this.sliderDMaxGain=i.TUNING_SLIDERS.slider_dmax_gain/100,this.sliderIGain=i.TUNING_SLIDERS.slider_i_gain/100,this.sliderRollPitchRatio=i.TUNING_SLIDERS.slider_roll_pitch_ratio/100,this.sliderPitchPIGain=i.TUNING_SLIDERS.slider_pitch_pi_gain/100,this.sliderMasterMultiplier=i.TUNING_SLIDERS.slider_master_multiplier/100,e('output[name="sliderDGain-number"]').val(this.sliderDGain),e('output[name="sliderPIGain-number"]').val(this.sliderPIGain),e('output[name="sliderFeedforwardGain-number"]').val(this.sliderFeedforwardGain),e('output[name="sliderDMaxGain-number"]').val(this.sliderDMaxGain),e('output[name="sliderIGain-number"]').val(this.sliderIGain),e('output[name="sliderRollPitchRatio-number"]').val(this.sliderRollPitchRatio),e('output[name="sliderPitchPIGain-number"]').val(this.sliderPitchPIGain),e('output[name="sliderMasterMultiplier-number"]').val(this.sliderMasterMultiplier),e("#sliderDGain").val(this.sliderDGain),e("#sliderPIGain").val(this.sliderPIGain),e("#sliderFeedforwardGain").val(this.sliderFeedforwardGain),e("#sliderDMaxGain").val(this.sliderDMaxGain),e("#sliderIGain").val(this.sliderIGain),e("#sliderRollPitchRatio").val(this.sliderRollPitchRatio),e("#sliderPitchPIGain").val(this.sliderPitchPIGain),e("#sliderMasterMultiplier").val(this.sliderMasterMultiplier)):(this.sliderMasterMultiplierLegacy=Math.round(i.PIDS_ACTIVE[2][1]/this.PID_DEFAULT[11]*10)/10,this.sliderPDRatio=Math.round(i.PIDS_ACTIVE[0][2]/i.PIDS_ACTIVE[0][0]/this.defaultPDRatio*10)/10,this.dMinFeatureEnabled?this.sliderPDGain=Math.round(i.ADVANCED_TUNING.dMinRoll/this.sliderPDRatio/this.sliderMasterMultiplierLegacy/this.PID_DEFAULT[3]*10)/10:this.sliderPDGain=Math.round(i.PIDS_ACTIVE[0][0]/this.sliderMasterMultiplierLegacy/(this.PID_DEFAULT[2]*(1/Oe))*10)/10,this.sliderFeedforwardGainLegacy=Math.round(i.ADVANCED_TUNING.feedforwardRoll/this.sliderMasterMultiplierLegacy/this.PID_DEFAULT[4]*10)/10,e('output[name="sliderMasterMultiplierLegacy-number"]').val(this.sliderMasterMultiplierLegacy),e('output[name="sliderPDRatio-number"]').val(this.sliderPDRatio),e('output[name="sliderPDGain-number"]').val(this.sliderPDGain),e('output[name="sliderFeedforwardGainLegacy-number"]').val(this.sliderFeedforwardGainLegacy),e("#sliderMasterMultiplierLegacy").val(this.downscaleSliderValue(this.sliderMasterMultiplierLegacy)),e("#sliderPDRatio").val(this.downscaleSliderValue(this.sliderPDRatio)),e("#sliderPDGain").val(this.downscaleSliderValue(this.sliderPDGain)),e("#sliderFeedforwardGainLegacy").val(this.downscaleSliderValue(this.sliderFeedforwardGainLegacy)))};n.initGyroFilterSliderPosition=function(){o.gte(i.CONFIG.apiVersion,F)?(this.sliderGyroFilter=i.TUNING_SLIDERS.slider_gyro_filter,this.sliderGyroFilterMultiplier=i.TUNING_SLIDERS.slider_gyro_filter_multiplier/100,e("#sliderGyroFilterMultiplier").val(this.sliderGyroFilterMultiplier)):(this.sliderGyroFilterMultiplier=Math.round((i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz+i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz+i.FILTER_CONFIG.gyro_lowpass2_hz)/(this.FILTER_DEFAULT.gyro_lowpass_dyn_min_hz+this.FILTER_DEFAULT.gyro_lowpass_dyn_max_hz+this.FILTER_DEFAULT.gyro_lowpass2_hz)*100)/100,e("#sliderGyroFilterMultiplier").val(this.downscaleSliderValue(this.sliderGyroFilterMultiplier))),e('output[name="sliderGyroFilterMultiplier-number"]').val(this.sliderGyroFilterMultiplier)};n.initDTermFilterSliderPosition=function(){o.gte(i.CONFIG.apiVersion,F)?(this.sliderDTermFilter=i.TUNING_SLIDERS.slider_dterm_filter,this.sliderDTermFilterMultiplier=i.TUNING_SLIDERS.slider_dterm_filter_multiplier/100,e("#sliderDTermFilterMultiplier").val(this.sliderDTermFilterMultiplier)):(this.sliderDTermFilterMultiplier=Math.round((i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz+i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz+i.FILTER_CONFIG.dterm_lowpass2_hz)/(this.FILTER_DEFAULT.dterm_lowpass_dyn_min_hz+this.FILTER_DEFAULT.dterm_lowpass_dyn_max_hz+this.FILTER_DEFAULT.dterm_lowpass2_hz)*100)/100,e("#sliderDTermFilterMultiplier").val(this.downscaleSliderValue(this.sliderDTermFilterMultiplier))),e('output[name="sliderDTermFilterMultiplier-number"]').val(this.sliderDTermFilterMultiplier)};n.gyroFilterSliderEnable=function(){this.sliderGyroFilter=1,this.calculateNewGyroFilters()};n.dtermFilterSliderEnable=function(){this.sliderDTermFilter=1,this.calculateNewDTermFilters()};n.gyroFilterSliderDisable=function(){i.TUNING_SLIDERS.slider_gyro_filter=0,this.updateGyroFilterSliderDisplay()};n.dtermFilterSliderDisable=function(){i.TUNING_SLIDERS.slider_dterm_filter=0,this.updateDTermFilterSliderDisplay()};n.updateSlidersWarning=function(r=!1){let l=120;const _=60;let I=40,s;o.gte(i.CONFIG.apiVersion,F)?(l=2.5*i.PIDS[0][0],I=42,s=i.PIDS[0][0]>70||i.PIDS[0][1]>l||i.PIDS[0][2]>_||i.ADVANCED_TUNING.dMinRoll>I):s=i.PIDS[1][0]>70||i.PIDS[1][1]>l||i.PIDS[1][2]>_||i.ADVANCED_TUNING.dMinPitch>I,e(".subtab-pid .slidersWarning").toggle(s&&!r)};n.updateFilterSlidersWarning=function(){let r=.7,t=1.4,l=.7,_=1.4;o.gte(i.CONFIG.apiVersion,F)&&(r=.45,t=1.55,l=.75,_=1.25),e(".subtab-filter .slidersWarning").toggle(this.sliderGyroFilterMultiplier>=t||this.sliderGyroFilterMultiplier<=r||this.sliderDTermFilterMultiplier>=_||this.sliderDTermFilterMultiplier<=l)};n.updatePidSlidersDisplay=function(){o.gte(i.CONFIG.apiVersion,F)?(e("#pid_main .ROLL .pid_data input, #pid_main .PITCH .pid_data input").each((r,t)=>e(t).prop("disabled",this.sliderPidsMode>0)),e("#pid_main .YAW .pid_data input").each((r,t)=>e(t).prop("disabled",this.sliderPidsMode===2)),this.updateExpertModePidSlidersDisplay(),e("#sliderPidsModeSelect").val(this.sliderPidsMode)):(this.pidSlidersUnavailable=!1,this.calculateNewPids(!0),i.PID_NAMES.forEach(function(r,t){e(`.pid_tuning .${r} input`).each(function(_){const I=parseInt(e(this).val());if(t<3&&_<3)I!==i.PIDS[t][_]&&(n.pidSlidersUnavailable=!0);else if(t<3&&_===3&&!this.dMinFeatureEnabled){const s=I!==i.ADVANCED_TUNING.dMinRoll&&t===0,E=I!==i.ADVANCED_TUNING.dMinPitch&&t===1,c=I!==i.ADVANCED_TUNING.dMinYaw&&t===2;(s||E||c)&&(n.pidSlidersUnavailable=!0)}else if(t<3&&_===3&&this.dMinFeatureEnabled||t<3&&_===4&&!this.dMinFeatureEnabled){const s=I!==i.ADVANCED_TUNING.feedforwardRoll&&t===0,E=I!==i.ADVANCED_TUNING.feedforwardPitch&&t===1,c=I!==i.ADVANCED_TUNING.feedforwardYaw&&t===2;(s||E||c)&&(n.pidSlidersUnavailable=!0)}})}),e('input[id="useIntegratedYaw"]').is(":checked")&&(this.pidSlidersUnavailable=!0),this.pidSlidersUnavailable||(this.cachedPidSliderValues=!0),e(".tuningPIDSliders").toggle(!this.pidSlidersUnavailable),e(".subtab-pid .slidersDisabled").toggle(this.pidSlidersUnavailable),e(".subtab-pid .nonExpertModeSlidersNote").toggle(!this.pidSlidersUnavailable&&!this.expertMode)),this.updateSlidersWarning(this.pidSlidersUnavailable)};n.updateGyroFilterSliderDisplay=function(){const r=e('.pid_filter input[name="gyroLowpassDynMinFrequency"]'),t=e('.pid_filter input[name="gyroLowpassDynMaxFrequency"]'),l=e('.pid_filter input[name="gyroLowpassFrequency"]'),_=e('.pid_filter input[name="gyroLowpass2Frequency"]'),I=(i.TUNING_SLIDERS.slider_gyro_filter_multiplier<this.NON_EXPERT_SLIDER_MIN_GYRO||i.TUNING_SLIDERS.slider_gyro_filter_multiplier>this.NON_EXPERT_SLIDER_MAX_GYRO)&&!this.expertMode;i.TUNING_SLIDERS.slider_gyro_filter===0?(this.GyroSliderUnavailable=!0,this.sliderGyroFilter=0):(this.GyroSliderUnavailable=!1,this.sliderGyroFilter=1,this.cachedGyroSliderValues=!0),r.val(i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz).prop("disabled",this.sliderGyroFilter),t.val(i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz).prop("disabled",this.sliderGyroFilter),l.val(i.FILTER_CONFIG.gyro_lowpass_hz).prop("disabled",this.sliderGyroFilter),_.val(i.FILTER_CONFIG.gyro_lowpass2_hz).prop("disabled",this.sliderGyroFilter),e('output[name="sliderGyroFilterMultiplier-number"]').val(this.sliderGyroFilterMultiplier);const E=i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz===0&&i.FILTER_CONFIG.gyro_lowpass_hz===0&&i.FILTER_CONFIG.gyro_lowpass2_hz===0||I||this.GyroSliderUnavailable;e('select[id="sliderGyroFilterModeSelect"]').val(this.sliderGyroFilter),e(".sliderGyroFilter").toggleClass("disabledSliders",E),e('input[id="sliderGyroFilterMultiplier"]').prop("disabled",E),this.updateFilterSlidersWarning()};n.updateDTermFilterSliderDisplay=function(){const r=e('.pid_filter input[name="dtermLowpassDynMinFrequency"]'),t=e('.pid_filter input[name="dtermLowpassDynMaxFrequency"]'),l=e('.pid_filter input[name="dtermLowpassFrequency"]'),_=e('.pid_filter input[name="dtermLowpass2Frequency"]'),I=(i.TUNING_SLIDERS.slider_dterm_filter_multiplier<this.NON_EXPERT_SLIDER_MIN_DTERM||i.TUNING_SLIDERS.slider_dterm_filter_multiplier>this.NON_EXPERT_SLIDER_MAX_DTERM)&&!this.expertMode;i.TUNING_SLIDERS.slider_dterm_filter===0?(this.DTermSliderUnavailable=!0,this.sliderDTermFilter=0):(this.DTermSliderUnavailable=!1,this.sliderDTermFilter=1,this.cachedDTermSliderValues=!0),r.val(i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz).prop("disabled",this.sliderDTermFilter),t.val(i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz).prop("disabled",this.sliderDTermFilter),l.val(i.FILTER_CONFIG.dterm_lowpass_hz).prop("disabled",this.sliderDTermFilter),_.val(i.FILTER_CONFIG.dterm_lowpass2_hz).prop("disabled",this.sliderDTermFilter);const E=i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz===0&&i.FILTER_CONFIG.dterm_lowpass_hz===0&&i.FILTER_CONFIG.dterm_lowpass2_hz===0||I||this.DTermSliderUnavailable;e('output[name="sliderDTermFilterMultiplier-number"]').val(this.sliderDTermFilterMultiplier),e('select[id="sliderDTermFilterModeSelect"]').val(this.sliderDTermFilter),e(".sliderDTermFilter").toggleClass("disabledSliders",E),e('input[id="sliderDTermFilterMultiplier"]').prop("disabled",E),this.updateFilterSlidersWarning()};n.updateFilterSlidersDisplay=function(){o.gte(i.CONFIG.apiVersion,F)?(this.updateGyroFilterSliderDisplay(),this.updateDTermFilterSliderDisplay()):(this.legacyUpdateFilterSlidersDisplay(),this.updateFilterSlidersWarning()),e(".subtab-filter .nonExpertModeSlidersNote").toggle((!this.GyroSliderUnavailable||!this.DTermSliderUnavailable)&&!this.expertMode)};n.updateFormPids=function(r=!1){r||(i.PID_NAMES.forEach(function(t,l){e(`.pid_tuning .${t} input`).each(function(I){l<3&&I<3&&e(this).val(i.PIDS[l][I])})}),e('.pid_tuning input[name="dMinRoll"]').val(i.ADVANCED_TUNING.dMinRoll),e('.pid_tuning input[name="dMinPitch"]').val(i.ADVANCED_TUNING.dMinPitch),e('.pid_tuning input[name="dMinYaw"]').val(i.ADVANCED_TUNING.dMinYaw),e('.pid_tuning .ROLL input[name="f"]').val(i.ADVANCED_TUNING.feedforwardRoll),e('.pid_tuning .PITCH input[name="f"]').val(i.ADVANCED_TUNING.feedforwardPitch),e('.pid_tuning .YAW input[name="f"]').val(i.ADVANCED_TUNING.feedforwardYaw)),o.gte(i.CONFIG.apiVersion,F)?(e('output[name="sliderDGain-number"]').val(this.sliderDGain),e('output[name="sliderPIGain-number"]').val(this.sliderPIGain),e('output[name="sliderFeedforwardGain-number"]').val(this.sliderFeedforwardGain),e('output[name="sliderDMaxGain-number"]').val(this.sliderDMaxGain),e('output[name="sliderIGain-number"]').val(this.sliderIGain),e('output[name="sliderRollPitchRatio-number"]').val(this.sliderRollPitchRatio),e('output[name="sliderPitchPIGain-number"]').val(this.sliderPitchPIGain),e('output[name="sliderMasterMultiplier-number"]').val(this.sliderMasterMultiplier)):(e('output[name="sliderMasterMultiplierLegacy-number"]').val(this.sliderMasterMultiplierLegacy),e('output[name="sliderPDRatio-number"]').val(this.sliderPDRatio),e('output[name="sliderPDGain-number"]').val(this.sliderPDGain),e('output[name="sliderFeedforwardGainLegacy-number"]').val(this.sliderFeedforwardGainLegacy)),this.updateSlidersWarning()};n.calculateNewPids=function(r=!1){o.gte(i.CONFIG.apiVersion,F)?(i.TUNING_SLIDERS.slider_pids_mode=this.sliderPidsMode,i.TUNING_SLIDERS.slider_d_gain=Math.round(this.sliderDGain*20)*5,i.TUNING_SLIDERS.slider_pi_gain=Math.round(this.sliderPIGain*20)*5,i.TUNING_SLIDERS.slider_feedforward_gain=Math.round(this.sliderFeedforwardGain*20)*5,i.TUNING_SLIDERS.slider_dmax_gain=Math.round(this.sliderDMaxGain*20)*5,i.TUNING_SLIDERS.slider_i_gain=Math.round(this.sliderIGain*20)*5,i.TUNING_SLIDERS.slider_roll_pitch_ratio=Math.round(this.sliderRollPitchRatio*20)*5,i.TUNING_SLIDERS.slider_pitch_pi_gain=Math.round(this.sliderPitchPIGain*20)*5,i.TUNING_SLIDERS.slider_master_multiplier=Math.round(this.sliderMasterMultiplier*20)*5,this.readSimplifiedPids()):this.legacyCalculatePids(r)};n.calculateNewGyroFilters=function(){o.gte(i.CONFIG.apiVersion,F)?this.readSimplifiedGyroFilters():this.calculateLegacyGyroFilters()};n.calculateNewDTermFilters=function(){o.gte(i.CONFIG.apiVersion,F)?this.readSimplifiedDTermFilters():this.calculateLegacyDTermFilters()};n.readSimplifiedPids=function(r=!1){i.TUNING_SLIDERS.slider_pids_mode=this.sliderPidsMode,i.TUNING_SLIDERS.slider_master_multiplier=Math.round(this.sliderMasterMultiplier*100),i.TUNING_SLIDERS.slider_roll_pitch_ratio=Math.round(this.sliderRollPitchRatio*100),i.TUNING_SLIDERS.slider_i_gain=Math.round(this.sliderIGain*100),i.TUNING_SLIDERS.slider_d_gain=Math.round(this.sliderDGain*100),i.TUNING_SLIDERS.slider_pi_gain=Math.round(this.sliderPIGain*100),i.TUNING_SLIDERS.slider_dmax_gain=Math.round(this.sliderDMaxGain*100),i.TUNING_SLIDERS.slider_feedforward_gain=Math.round(this.sliderFeedforwardGain*100),i.TUNING_SLIDERS.slider_pitch_pi_gain=Math.round(this.sliderPitchPIGain*100),S.promise(g.MSP_CALCULATE_SIMPLIFIED_PID,Q.crunch(g.MSP_CALCULATE_SIMPLIFIED_PID)).then(()=>this.updateFormPids(r))};n.readSimplifiedGyroFilters=function(){i.TUNING_SLIDERS.slider_gyro_filter=this.sliderGyroFilter,i.TUNING_SLIDERS.slider_gyro_filter_multiplier=this.sliderGyroFilterMultiplier*100,i.FILTER_CONFIG.gyro_lowpass_hz=parseInt(e('.pid_filter input[name="gyroLowpassFrequency"]').val()),i.FILTER_CONFIG.gyro_lowpass2_hz=parseInt(e('.pid_filter input[name="gyroLowpass2Frequency"]').val()),i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz=parseInt(e('.pid_filter input[name="gyroLowpassDynMinFrequency"]').val()),S.promise(g.MSP_CALCULATE_SIMPLIFIED_GYRO,Q.crunch(g.MSP_CALCULATE_SIMPLIFIED_GYRO)).then(()=>this.updateGyroFilterSliderDisplay())};n.readSimplifiedDTermFilters=function(){i.TUNING_SLIDERS.slider_dterm_filter=this.sliderDTermFilter,i.TUNING_SLIDERS.slider_dterm_filter_multiplier=this.sliderDTermFilterMultiplier*100,i.FILTER_CONFIG.dterm_lowpass_hz=parseInt(e('.pid_filter input[name="dtermLowpassFrequency"]').val()),i.FILTER_CONFIG.dterm_lowpass2_hz=parseInt(e('.pid_filter input[name="dtermLowpass2Frequency"]').val()),i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz=parseInt(e('.pid_filter input[name="dtermLowpassDynMinFrequency"]').val()),S.promise(g.MSP_CALCULATE_SIMPLIFIED_DTERM,Q.crunch(g.MSP_CALCULATE_SIMPLIFIED_DTERM)).then(()=>this.updateDTermFilterSliderDisplay())};n.validateTuningSliders=function(){S.promise(g.MSP_VALIDATE_SIMPLIFIED_TUNING).then(()=>{this.sliderPidsMode=i.TUNING_SLIDERS.slider_pids_valid>0?i.TUNING_SLIDERS.slider_pids_mode:0,this.sliderGyroFilter=i.TUNING_SLIDERS.slider_gyro_valid,this.sliderDTermFilter=i.TUNING_SLIDERS.slider_dterm_valid,i.TUNING_SLIDERS.slider_pids_mode=i.TUNING_SLIDERS.slider_pids_valid?i.TUNING_SLIDERS.slider_pids_mode:0,i.TUNING_SLIDERS.slider_gyro_filter=i.TUNING_SLIDERS.slider_gyro_valid?i.TUNING_SLIDERS.slider_gyro_filter:0,i.TUNING_SLIDERS.slider_dterm_filter=i.TUNING_SLIDERS.slider_dterm_valid?i.TUNING_SLIDERS.slider_dterm_filter:0,e("#sliderPidsModeSelect").val(this.sliderPidsMode),e("#sliderGyroFilterModeSelect").val(this.sliderGyroFilter),e("#sliderDTermFilterModeSelect").val(this.sliderDTermFilter),this.updatePidSlidersDisplay(),this.updateGyroFilterSliderDisplay(),this.updateDTermFilterSliderDisplay()})};n.legacyCalculatePids=function(r=!1){this.dMinFeatureEnabled?(i.ADVANCED_TUNING.dMinRoll=Math.round(this.PID_DEFAULT[3]*this.sliderPDGain*this.sliderPDRatio),i.ADVANCED_TUNING.dMinPitch=Math.round(this.PID_DEFAULT[8]*this.sliderPDGain*this.sliderPDRatio),i.PIDS[0][2]=Math.round(this.PID_DEFAULT[2]*this.sliderPDGain*this.sliderPDRatio),i.PIDS[1][2]=Math.round(this.PID_DEFAULT[7]*this.sliderPDGain*this.sliderPDRatio)):(i.ADVANCED_TUNING.dMinRoll=0,i.ADVANCED_TUNING.dMinPitch=0,i.PIDS[0][2]=Math.round(this.PID_DEFAULT[2]*Oe*this.sliderPDGain*this.sliderPDRatio),i.PIDS[1][2]=Math.round(this.PID_DEFAULT[7]*Oe*this.sliderPDGain*this.sliderPDRatio)),i.PIDS[0][0]=Math.round(this.PID_DEFAULT[0]*this.sliderPDGain),i.PIDS[1][0]=Math.round(this.PID_DEFAULT[5]*this.sliderPDGain),i.PIDS[2][0]=Math.round(this.PID_DEFAULT[10]*this.sliderPDGain),i.ADVANCED_TUNING.feedforwardRoll=Math.round(this.PID_DEFAULT[4]*this.sliderFeedforwardGainLegacy),i.ADVANCED_TUNING.feedforwardPitch=Math.round(this.PID_DEFAULT[9]*this.sliderFeedforwardGainLegacy),i.ADVANCED_TUNING.feedforwardYaw=Math.round(this.PID_DEFAULT[14]*this.sliderFeedforwardGainLegacy),i.PIDS[0][1]=this.PID_DEFAULT[1],i.PIDS[1][1]=this.PID_DEFAULT[6],i.PIDS[2][1]=this.PID_DEFAULT[11],i.PIDS[2][2]=this.PID_DEFAULT[12],i.ADVANCED_TUNING.dMinYaw=this.PID_DEFAULT[13];for(let I=0;I<3;I++)for(let s=0;s<3;s++)i.PIDS[s][I]=Math.min(Math.round(i.PIDS[s][I]*this.sliderMasterMultiplierLegacy),200);i.ADVANCED_TUNING.feedforwardRoll=Math.min(Math.round(i.ADVANCED_TUNING.feedforwardRoll*this.sliderMasterMultiplierLegacy),2e3),i.ADVANCED_TUNING.feedforwardPitch=Math.min(Math.round(i.ADVANCED_TUNING.feedforwardPitch*this.sliderMasterMultiplierLegacy),2e3),i.ADVANCED_TUNING.feedforwardYaw=Math.min(Math.round(i.ADVANCED_TUNING.feedforwardYaw*this.sliderMasterMultiplierLegacy),2e3),this.dMinFeatureEnabled&&(i.ADVANCED_TUNING.dMinRoll=Math.min(Math.round(i.ADVANCED_TUNING.dMinRoll*this.sliderMasterMultiplierLegacy),100),i.ADVANCED_TUNING.dMinPitch=Math.min(Math.round(i.ADVANCED_TUNING.dMinPitch*this.sliderMasterMultiplierLegacy),100),i.ADVANCED_TUNING.dMinYaw=Math.min(Math.round(i.ADVANCED_TUNING.dMinYaw*this.sliderMasterMultiplierLegacy),100)),this.updateFormPids(r),_e.pid_tuning.updatePIDColors(),this.updateSlidersWarning()};n.calculateLegacyGyroFilters=function(){i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz=Math.round(this.FILTER_DEFAULT.gyro_lowpass_dyn_min_hz*this.sliderGyroFilterMultiplier),i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz=Math.round(this.FILTER_DEFAULT.gyro_lowpass_dyn_max_hz*this.sliderGyroFilterMultiplier),i.FILTER_CONFIG.gyro_lowpass2_hz=Math.round(this.FILTER_DEFAULT.gyro_lowpass2_hz*this.sliderGyroFilterMultiplier),i.FILTER_CONFIG.gyro_lowpass_type=this.FILTER_DEFAULT.gyro_lowpass_type,i.FILTER_CONFIG.gyro_lowpass2_type=this.FILTER_DEFAULT.gyro_lowpass2_type,e('.pid_filter input[name="gyroLowpassDynMinFrequency"]').val(i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz),e('.pid_filter input[name="gyroLowpassDynMaxFrequency"]').val(i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz),e('.pid_filter input[name="gyroLowpassFrequency"]').val(i.FILTER_CONFIG.gyro_lowpass_hz),e('.pid_filter input[name="gyroLowpass2Frequency"]').val(i.FILTER_CONFIG.gyro_lowpass2_hz),e('output[name="sliderGyroFilterMultiplier-number"]').val(this.sliderGyroFilterMultiplier),this.updateFilterSlidersWarning()};n.calculateLegacyDTermFilters=function(){i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz=Math.round(this.FILTER_DEFAULT.dterm_lowpass_dyn_min_hz*this.sliderDTermFilterMultiplier),i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz=Math.round(this.FILTER_DEFAULT.dterm_lowpass_dyn_max_hz*this.sliderDTermFilterMultiplier),i.FILTER_CONFIG.dterm_lowpass_hz=Math.round(this.FILTER_DEFAULT.dterm_lowpass_hz*this.sliderDTermFilterMultiplier),i.FILTER_CONFIG.dterm_lowpass2_hz=Math.round(this.FILTER_DEFAULT.dterm_lowpass2_hz*this.sliderDTermFilterMultiplier),i.FILTER_CONFIG.dterm_lowpass_type=this.FILTER_DEFAULT.dterm_lowpass_type,i.FILTER_CONFIG.dterm_lowpass2_type=this.FILTER_DEFAULT.dterm_lowpass2_type,e('.pid_filter input[name="dtermLowpassDynMinFrequency"]').val(i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz),e('.pid_filter input[name="dtermLowpassDynMaxFrequency"]').val(i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz),e('.pid_filter input[name="dtermLowpassFrequency"]').val(i.FILTER_CONFIG.dterm_lowpass_hz),e('.pid_filter input[name="dtermLowpass2Frequency"]').val(i.FILTER_CONFIG.dterm_lowpass2_hz),e('output[name="sliderDTermFilterMultiplier-number"]').val(this.sliderDTermFilterMultiplier),this.updateFilterSlidersWarning()};n.legacyUpdateFilterSlidersDisplay=function(){this.GyroSliderUnavailable=!1,this.DTermSliderUnavailable=!1,parseInt(e('.pid_filter input[name="gyroLowpassDynMinFrequency"]').val())!==Math.round(this.FILTER_DEFAULT.gyro_lowpass_dyn_min_hz*this.sliderGyroFilterMultiplier)||parseInt(e('.pid_filter input[name="gyroLowpassDynMaxFrequency"]').val())!==Math.round(this.FILTER_DEFAULT.gyro_lowpass_dyn_max_hz*this.sliderGyroFilterMultiplier)||parseInt(e('.pid_filter select[name="gyroLowpassDynType"]').val())!==this.FILTER_DEFAULT.gyro_lowpass_type||parseInt(e('.pid_filter input[name="gyroLowpass2Frequency"]').val())!==Math.round(this.FILTER_DEFAULT.gyro_lowpass2_hz*this.sliderGyroFilterMultiplier)||parseInt(e('.pid_filter select[name="gyroLowpass2Type"]').val())!==this.FILTER_DEFAULT.gyro_lowpass2_type?this.GyroSliderUnavailable=!0:this.cachedGyroSliderValues=!0,parseInt(e('.pid_filter input[name="dtermLowpassDynMinFrequency"]').val())!==Math.round(this.FILTER_DEFAULT.dterm_lowpass_dyn_min_hz*this.sliderDTermFilterMultiplier)||parseInt(e('.pid_filter input[name="dtermLowpassDynMaxFrequency"]').val())!==Math.round(this.FILTER_DEFAULT.dterm_lowpass_dyn_max_hz*this.sliderDTermFilterMultiplier)||parseInt(e('.pid_filter select[name="dtermLowpassDynType"]').val())!==this.FILTER_DEFAULT.dterm_lowpass_type||parseInt(e('.pid_filter input[name="dtermLowpassFrequency"]').val())!==Math.round(this.FILTER_DEFAULT.dterm_lowpass_hz*this.sliderDTermFilterMultiplier)||parseInt(e('.pid_filter input[name="dtermLowpass2Frequency"]').val())!==Math.round(this.FILTER_DEFAULT.dterm_lowpass2_hz*this.sliderDTermFilterMultiplier)||parseInt(e('.pid_filter select[name="dtermLowpass2Type"]').val())!==this.FILTER_DEFAULT.dterm_lowpass2_type?this.DTermSliderUnavailable=!0:this.cachedDTermSliderValues=!0,e(".tuningFilterSliders .sliderLabels tr:nth-child(2)").toggle(!this.GyroSliderUnavailable),e(".tuningFilterSliders .sliderLabels tr:last-child").toggle(!this.DTermSliderUnavailable),e(".tuningFilterSliders").toggle(!(this.GyroSliderUnavailable&&this.DTermSliderUnavailable)),e(".subtab-filter .slidersDisabled").toggle(this.GyroSliderUnavailable||this.DTermSliderUnavailable)};n.resetPidSliders=function(){this.cachedPidSliderValues||(this.sliderMasterMultiplierLegacy=1,this.sliderPDRatio=1,this.sliderPDGain=1,this.sliderFeedforwardGainLegacy=1),e("#sliderMasterMultiplierLegacy").val(this.downscaleSliderValue(this.sliderMasterMultiplierLegacy)),e("#sliderPDRatio").val(this.downscaleSliderValue(this.sliderPDRatio)),e("#sliderPDGain").val(this.downscaleSliderValue(this.sliderPDGain)),e("#sliderFeedforwardGainLegacy").val(this.downscaleSliderValue(this.sliderFeedforwardGainLegacy)),this.calculateNewPids()};n.resetGyroFilterSlider=function(){this.sliderGyroFilterMultiplier=1,e("#sliderGyroFilterMultiplier").val(this.sliderGyroFilterMultiplier),this.calculateNewGyroFilters(),this.updateFilterSlidersDisplay()};n.resetDTermFilterSlider=function(){this.sliderDTermFilterMultiplier=1,e("#sliderDTermFilterMultiplier").val(this.sliderDTermFilterMultiplier),this.calculateNewDTermFilters(),this.updateFilterSlidersDisplay()};const U={RATE_PROFILE_MASK:128,showAllPids:!1,updating:!0,dirty:!1,previousFilterDynQ:null,previousFilterDynCount:null,currentProfile:null,currentRateProfile:null,currentRatesType:null,previousRatesType:null,SETPOINT_WEIGHT_RANGE_LOW:2.55,SETPOINT_WEIGHT_RANGE_HIGH:20,SETPOINT_WEIGHT_RANGE_LEGACY:2.54,activeSubtab:"pid",analyticsChanges:{},CONFIGURATOR_PIDS:[],CONFIGURATOR_ADVANCED_TUNING:{},CONFIGURATOR_FILTER_CONFIG:{},CONFIGURATOR_RC_TUNING:{},CONFIGURATOR_FEATURE_CONFIG:{},CONFIGURATOR_TUNING_SLIDERS:{}};U.initialize=function(r){const t=this;he.active_tab!=="pid_tuning"&&(he.active_tab="pid_tuning",t.activeSubtab="pid");const l=i.getFilterDefaults(),_=i.getPidDefaults();S.promise(g.MSP_PID_CONTROLLER).then(()=>S.promise(g.MSP_PIDNAMES)).then(()=>S.promise(g.MSP_PID)).then(()=>S.promise(g.MSP_PID_ADVANCED)).then(()=>S.promise(g.MSP_RC_TUNING)).then(()=>S.promise(g.MSP_FILTER_CONFIG)).then(()=>S.promise(g.MSP_RC_DEADBAND)).then(()=>S.promise(g.MSP_MOTOR_CONFIG)).then(()=>o.gte(i.CONFIG.apiVersion,X)?S.promise(g.MSP2_GET_TEXT,Q.crunch(g.MSP2_GET_TEXT,g.PID_PROFILE_NAME)):!0).then(()=>o.gte(i.CONFIG.apiVersion,X)?S.promise(g.MSP2_GET_TEXT,Q.crunch(g.MSP2_GET_TEXT,g.RATE_PROFILE_NAME)):!0).then(()=>o.gte(i.CONFIG.apiVersion,F)?S.promise(g.MSP_SIMPLIFIED_TUNING):!0).then(()=>o.gte(i.CONFIG.apiVersion,F)?S.promise(g.MSP_ADVANCED_CONFIG):!0).then(()=>S.send_message(g.MSP_MIXER_CONFIG,!1,!1,I));function I(){e("#content").load("./tabs/pid_tuning.html",Z)}const s=o.lt(i.CONFIG.apiVersion,F);function E(){t.setProfile(),t.setRateProfile(),o.gte(i.CONFIG.apiVersion,"1.45.0")?(e('input[name="pidProfileName"]').val(i.CONFIG.pidProfileNames[i.CONFIG.profile]),e('input[name="rateProfileName"]').val(i.CONFIG.rateProfileNames[i.CONFIG.rateProfile])):e(".profile_name").hide(),i.PID_NAMES.forEach(function(a,p){e(`.pid_tuning .${a} input`).each((P,w)=>{i.PIDS[p][P]!==void 0&&e(w).val(i.PIDS_ACTIVE[p][P])})}),e('.pid_tuning input[name="rc_rate"]').val(i.RC_TUNING.RC_RATE.toFixed(2)),e('.pid_tuning input[name="roll_pitch_rate"]').val(i.RC_TUNING.roll_pitch_rate.toFixed(2)),e('.pid_tuning input[name="roll_rate"]').val(i.RC_TUNING.roll_rate.toFixed(2)),e('.pid_tuning input[name="pitch_rate"]').val(i.RC_TUNING.pitch_rate.toFixed(2)),e('.pid_tuning input[name="yaw_rate"]').val(i.RC_TUNING.yaw_rate.toFixed(2)),e('.pid_tuning input[name="rc_expo"]').val(i.RC_TUNING.RC_EXPO.toFixed(2)),e('.pid_tuning input[name="rc_yaw_expo"]').val(i.RC_TUNING.RC_YAW_EXPO.toFixed(2)),e('.throttle input[name="mid"]').val(i.RC_TUNING.throttle_MID.toFixed(2)),e('.throttle input[name="expo"]').val(i.RC_TUNING.throttle_EXPO.toFixed(2)),o.gte(i.CONFIG.apiVersion,X)?(e('select[id="tpaMode"]').val(i.ADVANCED_TUNING.tpaMode),e('input[id="tpaRate"]').val(i.ADVANCED_TUNING.tpaRate.toFixed(2)),e('input[id="tpaBreakpoint"]').val(i.ADVANCED_TUNING.tpaBreakpoint)):(e('.tpa-old input[name="tpa"]').val(i.RC_TUNING.dynamic_THR_PID.toFixed(2)),e('.tpa-old input[name="tpa-breakpoint"]').val(i.RC_TUNING.dynamic_THR_breakpoint)),e(".vbatpidcompensation").toggle(s),e('input[id="vbatpidcompensation"]').prop("checked",i.ADVANCED_TUNING.vbatPidCompensation!==0),e("#pid-tuning .delta select").val(i.ADVANCED_TUNING.deltaMethod),e('.pid_tuning input[name="rc_rate_yaw"]').val(i.RC_TUNING.rcYawRate.toFixed(2)),e('.pid_filter input[name="gyroLowpassFrequency"]').val(i.FILTER_CONFIG.gyro_lowpass_hz),e('.pid_filter input[name="dtermLowpassFrequency"]').val(i.FILTER_CONFIG.dterm_lowpass_hz),e('.pid_filter input[name="yawLowpassFrequency"]').val(i.FILTER_CONFIG.yaw_lowpass_hz),e("#pid-tuning .rate").text(y.getMessage("pidTuningSuperRate")),e('.pid_filter input[name="gyroNotch1Frequency"]').val(i.FILTER_CONFIG.gyro_notch_hz),e('.pid_filter input[name="gyroNotch1Cutoff"]').val(i.FILTER_CONFIG.gyro_notch_cutoff),e('.pid_filter input[name="dTermNotchFrequency"]').val(i.FILTER_CONFIG.dterm_notch_hz),e('.pid_filter input[name="dTermNotchCutoff"]').val(i.FILTER_CONFIG.dterm_notch_cutoff);const N=e('input[name="dtermSetpointTransition-number"]');N.attr("min",0),N.val(i.ADVANCED_TUNING.dtermSetpointTransition/100),e('input[name="dtermSetpoint-number"]').val(i.ADVANCED_TUNING.dtermSetpointWeight/100),e('.pid_filter input[name="gyroNotch2Frequency"]').val(i.FILTER_CONFIG.gyro_notch2_hz),e('.pid_filter input[name="gyroNotch2Cutoff"]').val(i.FILTER_CONFIG.gyro_notch2_cutoff),e('.pid_tuning input[name="angleLimit"]').val(i.ADVANCED_TUNING.levelAngleLimit),e('.pid_tuning input[name="sensitivity"]').hide(),e(".pid_tuning .levelSensitivityHeader").empty();const m=e("#antiGravitySwitch"),G=e('.antigravity input[name="itermAcceleratorGain"]');e('.pid_filter select[name="dtermLowpassType"]').val(i.FILTER_CONFIG.dterm_lowpass_type);const A=o.gte(i.CONFIG.apiVersion,F)?0:1e3;o.gte(i.CONFIG.apiVersion,X)?(G.val(i.ADVANCED_TUNING.antiGravityGain/10),m.prop("checked",i.ADVANCED_TUNING.antiGravityGain!==A)):(e('.antigravity input[name="itermThrottleThreshold"]').val(i.ADVANCED_TUNING.itermThrottleThreshold),G.val(i.ADVANCED_TUNING.itermAcceleratorGain/1e3),m.prop("checked",i.ADVANCED_TUNING.itermAcceleratorGain!==A)),o.gte(i.CONFIG.apiVersion,F)&&(G.attr("min","0.1"),o.gte(i.CONFIG.apiVersion,X)&&G.attr({min:"0.1",max:"25.0",step:"0.1"})),m.on("change",function(){if(m.is(":checked")){if(o.gte(i.CONFIG.apiVersion,X))G.val(Number.parseFloat(i.ADVANCED_TUNING.antiGravityGain/10||8).toFixed(1));else{const a=o.gte(i.CONFIG.apiVersion,ne)?3.5:1.1;if(i.ADVANCED_TUNING.itermAcceleratorGain===A)G.val(a);else{const p=i.ADVANCED_TUNING.itermAcceleratorGain/1e3;G.val(p)}}e(".antigravity .suboption").show(),e(".antigravity .antiGravityThres").toggle(o.lt(i.CONFIG.apiVersion,X)&&i.ADVANCED_TUNING.itermAcceleratorGain===0),e(".antigravity .antiGravityMode").toggle(o.lt(i.CONFIG.apiVersion,X))}else o.gte(i.CONFIG.apiVersion,X)?G.val(A/1e3):(e('.antigravity select[id="antiGravityMode"]').val(0),G.val(A)),e(".antigravity .suboption").hide()}),m.trigger("change"),e('.pid_tuning input[name="rc_rate_pitch"]').val(i.RC_TUNING.rcPitchRate.toFixed(2)),e('.pid_tuning input[name="rc_pitch_expo"]').val(i.RC_TUNING.RC_PITCH_EXPO.toFixed(2)),e('.pid_filter input[name="gyroLowpass2Frequency"]').val(i.FILTER_CONFIG.gyro_lowpass2_hz),e('.pid_filter select[name="gyroLowpassType"]').val(i.FILTER_CONFIG.gyro_lowpass_type),e('.pid_filter select[name="gyroLowpass2Type"]').val(i.FILTER_CONFIG.gyro_lowpass2_type),e('.pid_filter input[name="dtermLowpass2Frequency"]').val(i.FILTER_CONFIG.dterm_lowpass2_hz),e('.pid_filter select[name="dtermLowpass2Type"]').val(i.FILTER_CONFIG.dterm_lowpass2_type),e('.pid_filter input[name="gyroLowpassFrequency"]').attr("max","16000"),e('.pid_filter input[name="gyroLowpassFrequency"]').val(i.FILTER_CONFIG.gyro_lowpass_hz),e("#pid_main .pid_titlebar2 th").attr("colspan",4),e('input[id="itermrotation"]').prop("checked",i.ADVANCED_TUNING.itermRotation!==0),e('input[id="smartfeedforward"]').prop("checked",i.ADVANCED_TUNING.smartFeedforward!==0);const R=e('input[id="itermrelax"]');if(R.prop("checked",i.ADVANCED_TUNING.itermRelax!==0),e('select[id="itermrelaxAxes"]').val(i.ADVANCED_TUNING.itermRelax>0?i.ADVANCED_TUNING.itermRelax:1),e('select[id="itermrelaxType"]').val(i.ADVANCED_TUNING.itermRelaxType),e('input[name="itermRelaxCutoff"]').val(i.ADVANCED_TUNING.itermRelaxCutoff),o.gte(i.CONFIG.apiVersion,ne)&&e('.itermrelax input[name="itermRelaxCutoff"]').attr("max","50"),R.change(function(){e(this).is(":checked")?(e(".itermrelax .suboption").show(),o.gte(i.CONFIG.apiVersion,Ce)?e(".itermRelaxCutoff").show():e(".itermRelaxCutoff").hide()):e(".itermrelax .suboption").hide()}),R.change(),e('input[name="absoluteControlGain-number"]').val(i.ADVANCED_TUNING.absoluteControlGain).trigger("input"),e('input[name="throttleBoost-number"]').val(i.ADVANCED_TUNING.throttleBoost).trigger("input"),e('input[name="acroTrainerAngleLimit-number"]').val(i.ADVANCED_TUNING.acroTrainerAngleLimit).trigger("input"),e('.pid_tuning .YAW input[name="d"]').val(i.PIDS[2][2]),e('.pid_tuning .ROLL input[name="f"]').val(i.ADVANCED_TUNING.feedforwardRoll),e('.pid_tuning .PITCH input[name="f"]').val(i.ADVANCED_TUNING.feedforwardPitch),e('.pid_tuning .YAW input[name="f"]').val(i.ADVANCED_TUNING.feedforwardYaw),e("#pid_main .pid_titlebar2 th").attr("colspan",5),e('input[name="feedforwardTransition-number"]').val(Number.parseFloat(i.ADVANCED_TUNING.feedforwardTransition/100).toFixed(2)),o.lt(i.CONFIG.apiVersion,X)){const a=e('.antigravity select[id="antiGravityMode"]');a.on("change",function(){const p=a.val();e(".antiGravityThres").toggle(p!==0)}),a.val(i.ADVANCED_TUNING.antiGravityMode).trigger("change")}if(e('select[id="throttleLimitType"]').val(i.RC_TUNING.throttleLimitType),e('.throttle_limit input[name="throttleLimitPercent"]').val(i.RC_TUNING.throttleLimitPercent),e('.pid_filter input[name="gyroLowpassDynMinFrequency"]').val(i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz),e('.pid_filter input[name="gyroLowpassDynMaxFrequency"]').val(i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz),e('.pid_filter select[name="gyroLowpassDynType"]').val(i.FILTER_CONFIG.gyro_lowpass_type),e('.pid_filter input[name="dtermLowpassDynMinFrequency"]').val(i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz),e('.pid_filter input[name="dtermLowpassDynMaxFrequency"]').val(i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz),e('.pid_filter select[name="dtermLowpassDynType"]').val(i.FILTER_CONFIG.dterm_lowpass_type),e('.pid_tuning input[name="dMinRoll"]').val(i.ADVANCED_TUNING.dMinRoll),e('.pid_tuning input[name="dMinPitch"]').val(i.ADVANCED_TUNING.dMinPitch),e('.pid_tuning input[name="dMinYaw"]').val(i.ADVANCED_TUNING.dMinYaw),e('.dminGroup input[name="dMinGain"]').val(i.ADVANCED_TUNING.dMinGain),e('.dminGroup input[name="dMinAdvance"]').val(i.ADVANCED_TUNING.dMinAdvance),e('input[id="useIntegratedYaw"]').prop("checked",i.ADVANCED_TUNING.useIntegratedYaw!==0),e("#pid_main .pid_titlebar2 th").attr("colspan",6),o.gte(i.CONFIG.apiVersion,Ce)){e(".smartfeedforward").hide();const a=i.CONFIG.sampleRateHz/i.PID_ADVANCED_CONFIG.pid_process_denom;let p=i.FEATURE_CONFIG.features.isEnabled("DYNAMIC_FILTER");p=p||i.FILTER_CONFIG.dyn_notch_count!==0,p=p&&a>=2e3,o.lt(i.CONFIG.apiVersion,F)&&(p?e(".dynamicNotch span.inputSwitch").hide():e(".dynamicNotch").hide());const D=e('.pid_filter select[name="dynamicNotchRange"]'),P=e('.pid_filter input[name="dynamicNotchWidthPercent"]'),w=e('.pid_filter input[name="dynamicNotchCount"]'),de=e('.pid_filter input[name="dynamicNotchQ"]'),Pe=e('.pid_filter input[name="dynamicNotchMinHz"]'),Ue=e('.pid_filter input[name="dynamicNotchMaxHz"]');D.val(i.FILTER_CONFIG.dyn_notch_range),P.val(i.FILTER_CONFIG.dyn_notch_width_percent),w.val(i.FILTER_CONFIG.dyn_notch_count),de.val(i.FILTER_CONFIG.dyn_notch_q),Pe.val(i.FILTER_CONFIG.dyn_notch_min_hz),Ue.val(i.FILTER_CONFIG.dyn_notch_max_hz),o.gte(i.CONFIG.apiVersion,ne)?Pe.attr("max","250"):e(".dynamicNotchMaxHz").hide(),e('.pid_filter input[id="dynamicNotchEnabled"]').on("change",function(){const ue=parseInt(w.val()),B=e(this).is(":checked");B&&!ue&&w.val(l.dyn_notch_count),e(".dynamicNotch span.suboption").toggle(B),e(".dynamicNotchRange").toggle(o.lt(i.CONFIG.apiVersion,ne)&&B),e(".dynamicNotchMaxHz").toggle(o.gte(i.CONFIG.apiVersion,ne)&&B),e(".dynamicNotchWidthPercent").toggle(o.lt(i.CONFIG.apiVersion,F)&&B),e(".dynamicNotchCount").toggle(o.gte(i.CONFIG.apiVersion,F)&&B)}).prop("checked",p).trigger("change"),e(".rpmFilter").toggle(i.MOTOR_CONFIG.use_dshot_telemetry);const Le=e('.pid_filter input[name="rpmFilterHarmonics"]'),pe=e('.pid_filter input[name="rpmFilterMinHz"]');Le.val(i.FILTER_CONFIG.gyro_rpm_notch_harmonics),pe.val(i.FILTER_CONFIG.gyro_rpm_notch_min_hz),e(".pid_filter #rpmFilterEnabled").on("change",function(){const ue=Le.val(),B=e(this).is(":checked")&&ue!==0;if(Le.attr("disabled",!B),pe.attr("disabled",!B),t.previousFilterDynQ=i.FILTER_CONFIG.dyn_notch_q,t.previousFilterDynCount=i.FILTER_CONFIG.dyn_notch_count,ue==0&&Le.val(l.gyro_rpm_notch_harmonics),o.gte(i.CONFIG.apiVersion,F)){const Ae={title:y.getMessage("dialogDynFiltersChangeTitle"),text:y.getMessage("dialogDynFiltersChangeNote"),buttonYesText:y.getMessage("presetsWarningDialogYesButton"),buttonNoText:y.getMessage("presetsWarningDialogNoButton"),buttonYesCallback:()=>Fe(),buttonNoCallback:null},Fe=function(){B?(w.val(l.dyn_notch_count_rpm),de.val(l.dyn_notch_q_rpm)):(w.val(l.dyn_notch_count),de.val(l.dyn_notch_q))};B!==(i.FILTER_CONFIG.gyro_rpm_notch_harmonics!==0)?he.showYesNoDialog(Ae):(w.val(t.previousFilterDynCount),de.val(t.previousFilterDynQ))}e(".rpmFilter span.suboption").toggle(B)}).prop("checked",i.FILTER_CONFIG.gyro_rpm_notch_harmonics!==0).trigger("change")}else e(".itermRelaxCutoff").hide(),e(".dynamicNotch").hide(),e(".rpmFilter").hide();if(o.gte(i.CONFIG.apiVersion,X)&&e('input[name="idleMinRpm-number"]').attr("max",200),o.gte(i.CONFIG.apiVersion,ne)?(e('.tab-pid_tuning input[name="motorLimit"]').val(i.ADVANCED_TUNING.motorOutputLimit),e('.tab-pid_tuning select[name="cellCount"]').val(i.ADVANCED_TUNING.autoProfileCellCount),e('input[name="idleMinRpm-number"]').val(i.ADVANCED_TUNING.idleMinRpm).prop("disabled",!i.MOTOR_CONFIG.use_dshot_telemetry),i.MOTOR_CONFIG.use_dshot_telemetry?e("span.pidTuningIdleMinRpmDisabled").text(y.getMessage("pidTuningIdleMinRpm")):e("span.pidTuningIdleMinRpmDisabled").text(y.getMessage("pidTuningIdleMinRpmDisabled"))):(e(".motorOutputLimit").hide(),e(".idleMinRpm").hide()),o.gte(i.CONFIG.apiVersion,ne)){const a=e('select[id="ratesType"]'),p=[{name:"Betaflight"},{name:"Raceflight"},{name:"KISS"},{name:"Actual"},{name:"QuickRates"}];for(let D=0;D<p.length;D++)a.append(`<option value="${D}">${p[D].name}</option>`);t.currentRatesType=i.RC_TUNING.rates_type,t.previousRatesType=null,a.val(t.currentRatesType),t.changeRatesType(t.currentRatesType)}else t.currentRatesType=null,t.previousRatesType=null,e(".rates_type").hide();if(o.gte(i.CONFIG.apiVersion,F)?(e(".gyroLowpassLegacy").hide(),e(".gyroLowpassDynLegacy").hide(),e(".dtermLowpassLegacy").hide(),e(".dtermLowpassDynLegacy").hide(),e('.pid_filter input[name="dtermLowpassExpo"]').val(i.FILTER_CONFIG.dyn_lpf_curve_expo)):(e(".gyroLowpass").hide(),e(".dtermLowpass").hide(),e('.pid_tuning .ROLL input[name="p"]').attr("max","200"),e('.pid_tuning .ROLL input[name="i"]').attr("max","200"),e('.pid_tuning .ROLL input[name="d"]').attr("max","200"),e('.pid_tuning .ROLL input[name="dMinPitch"]').attr("max","100"),e('.pid_tuning .PITCH input[name="p"]').attr("max","200"),e('.pid_tuning .PITCH input[name="i"]').attr("max","200"),e('.pid_tuning .PITCH input[name="d"]').attr("max","200"),e('.pid_tuning .PITCH input[name="dMinPitch"]').attr("max","100"),e('.pid_tuning .YAW input[name="p"]').attr("max","200"),e('.pid_tuning .YAW input[name="i"]').attr("max","200"),e('.pid_tuning .YAW input[name="d"]').attr("max","200"),e('.pid_tuning .YAW input[name="dMinPitch"]').attr("max","100")),o.gte(i.CONFIG.apiVersion,F)){e('select[id="feedforwardAveraging"]').val(i.ADVANCED_TUNING.feedforward_averaging),e('input[name="feedforwardSmoothFactor"]').val(i.ADVANCED_TUNING.feedforward_smooth_factor),e('input[name="feedforwardBoost"]').val(i.ADVANCED_TUNING.feedforward_boost),e('input[name="feedforwardMaxRateLimit"]').val(i.ADVANCED_TUNING.feedforward_max_rate_limit),e('input[name="feedforwardJitterFactor"]').val(i.ADVANCED_TUNING.feedforward_jitter_factor);const a=e('input[id="vbatSagCompensation"]');a.prop("checked",i.ADVANCED_TUNING.vbat_sag_compensation!==0),e('input[name="vbatSagValue"]').val(i.ADVANCED_TUNING.vbat_sag_compensation>0?i.ADVANCED_TUNING.vbat_sag_compensation:100),a.change(function(){const D=e(this).is(":checked");e(".vbatSagCompensation .suboption").toggle(D)}).change();const p=e('input[id="thrustLinearization"]');p.prop("checked",i.ADVANCED_TUNING.thrustLinearization!==0),e('input[name="thrustLinearValue"]').val(i.ADVANCED_TUNING.thrustLinearization>0?i.ADVANCED_TUNING.thrustLinearization:20),p.change(function(){const D=e(this).is(":checked");e(".thrustLinearization .suboption").toggle(D)}).change()}else e(".vbatSagCompensation").hide(),e(".thrustLinearization").hide(),e('.pid_tuning .ROLL input[name="f"]').val(i.ADVANCED_TUNING.feedforwardRoll>0?i.ADVANCED_TUNING.feedforwardRoll:_[4]),e('.pid_tuning .PITCH input[name="f"]').val(i.ADVANCED_TUNING.feedforwardPitch>0?i.ADVANCED_TUNING.feedforwardPitch:_[9]),e('.pid_tuning .YAW input[name="f"]').val(i.ADVANCED_TUNING.feedforwardYaw>0?i.ADVANCED_TUNING.feedforwardYaw:_[14]),e("span.feedforwardOption").hide();e('input[id="useIntegratedYaw"]').change(function(){const a=e(this).is(":checked");e("#pidTuningIntegratedYawCaution").toggle(a)}).change();function O(a,p){const D=parseInt(a.val()),P=parseInt(p.val());let w=Math.min(Math.max(D-1,0),100);o.gte(i.CONFIG.apiVersion,F)?w=Math.min(Math.max(D,0),250):p.attr("max",w),P>w&&p.val(w)}e('.pid_tuning .ROLL input[name="d"]').change(function(){const a=e('.pid_tuning input[name="dMinRoll"]');O(e(this),a)}).change(),e('.pid_tuning .PITCH input[name="d"]').change(function(){const a=e('.pid_tuning input[name="dMinPitch"]');O(e(this),a)}).change(),e('.pid_tuning .YAW input[name="d"]').change(function(){const a=e('.pid_tuning input[name="dMinYaw"]');O(e(this),a)}).change();function b(a,p){if(o.gte(i.CONFIG.apiVersion,F)){const D=parseInt(p.val()),P=parseInt(a.val()),w=Math.min(Math.max(P,0),250);D<w&&p.val(w)}}e('.pid_tuning input[name="dMinRoll"]').change(function(){const a=e('.pid_tuning .ROLL input[name="d"]');b(e(this),a)}).change(),e('.pid_tuning input[name="dMinPitch"]').change(function(){const a=e('.pid_tuning .PITCH input[name="d"]');b(e(this),a)}).change(),e('.pid_tuning input[name="dMinYaw"]').change(function(){const a=e('.pid_tuning .YAW input[name="d"]');b(e(this),a)}).change(),e('.pid_tuning .ROLL input[name="d"]').change(function(){const a=e('.pid_tuning input[name="dMinRoll"]');O(e(this),a)}).change(),e('.pid_tuning .PITCH input[name="d"]').change(function(){const a=e('.pid_tuning input[name="dMinPitch"]');O(e(this),a)}).change(),e('.pid_tuning .YAW input[name="d"]').change(function(){const a=e('.pid_tuning input[name="dMinYaw"]');O(e(this),a)}).change();const k=e("#dMinSwitch");if(o.gte(i.CONFIG.apiVersion,F)){const a=document.getElementById("dMinSwitch");a.parentNode&&a.parentNode.removeChild(a),e(".dMinDisabledNote").hide()}else k.prop("checked",i.ADVANCED_TUNING.dMinRoll>0||i.ADVANCED_TUNING.dMinPitch>0||i.ADVANCED_TUNING.dMinYaw>0),k.on("change",function(){e(this).is(":checked")?(e('.pid_tuning input[name="dMinRoll"]').val()==0&&e('.pid_tuning input[name="dMinPitch"]').val()==0&&e('.pid_tuning input[name="dMinYaw"]').val()==0?(e('.pid_tuning input[name="dMinRoll"]').val(Math.min(Math.round(e('.pid_tuning .ROLL input[name="d"]').val()*.57),100)),e('.pid_tuning input[name="dMinPitch"]').val(Math.min(Math.round(e('.pid_tuning .PITCH input[name="d"]').val()*.57),100)),e('.pid_tuning input[name="dMinYaw"]').val(Math.min(Math.round(e('.pid_tuning .YAW input[name="d"]').val()*.57),100)),o.eq(i.CONFIG.apiVersion,ne)&&(e('.pid_tuning input[name="dMinRoll"]').val(Math.min(Math.round(e('.pid_tuning .ROLL input[name="d"]').val()*.65),100)),e('.pid_tuning input[name="dMinPitch"]').val(Math.min(Math.round(e('.pid_tuning .PITCH input[name="d"]').val()*.65),100)),e('.pid_tuning input[name="dMinYaw"]').val(Math.min(Math.round(e('.pid_tuning .YAW input[name="d"]').val()*.65),100)))):(e('.pid_tuning input[name="dMinRoll"]').val(i.ADVANCED_TUNING.dMinRoll),e('.pid_tuning input[name="dMinPitch"]').val(i.ADVANCED_TUNING.dMinPitch),e('.pid_tuning input[name="dMinYaw"]').val(i.ADVANCED_TUNING.dMinYaw)),e(".dMinDisabledNote").hide(),e(".dminGroup .suboption").show(),e("#pid_main tr :nth-child(5)").show(),e("#pid_main .pid_titlebar2 th").attr("colspan",6),e(".derivativeText").text(y.getMessage("pidTuningDMax"))):(e(".dMinDisabledNote").show(),e(".dminGroup .suboption").hide(),e("#pid_main tr :nth-child(5)").hide(),e("#pid_main .pid_titlebar2 th").attr("colspan",5),e(".derivativeText").text(y.getMessage("pidTuningDerivative")),e('.pid_tuning input[name="dMinRoll"]').val(0),e('.pid_tuning input[name="dMinPitch"]').val(0),e('.pid_tuning input[name="dMinYaw"]').val(0))}).trigger("change");e('input[id="gyroNotch1Enabled"]').change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.gyro_notch_hz>0?i.FILTER_CONFIG.gyro_notch_hz:l.gyro_notch_hz;e('.pid_filter input[name="gyroNotch1Frequency"]').val(a?p:0).attr("disabled",!a).attr("min",a?1:0).change(),e('.pid_filter input[name="gyroNotch1Cutoff"]').attr("disabled",!a).change(),e(".gyroNotch1 span.suboption").toggle(a)}),e('input[id="gyroNotch2Enabled"]').change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.gyro_notch2_hz>0?i.FILTER_CONFIG.gyro_notch2_hz:l.gyro_notch2_hz;e('.pid_filter input[name="gyroNotch2Frequency"]').val(a?p:0).attr("disabled",!a).attr("min",a?1:0).change(),e('.pid_filter input[name="gyroNotch2Cutoff"]').attr("disabled",!a).change(),e(".gyroNotch2 span.suboption").toggle(a)}),e('input[id="dtermNotchEnabled"]').change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.dterm_notch_hz>0?i.FILTER_CONFIG.dterm_notch_hz:l.dterm_notch_hz;e('.pid_filter input[name="dTermNotchFrequency"]').val(a?p:0).attr("disabled",!a).attr("min",a?1:0).change(),e('.pid_filter input[name="dTermNotchCutoff"]').attr("disabled",!a).change(),e(".dtermNotch span.suboption").toggle(a)});const H=e('.pid_filter input[name="gyroLowpassDynMinFrequency"]'),Ie=e('.pid_filter input[name="gyroLowpassDynMaxFrequency"]'),Me=e('.pid_filter input[name="gyroLowpassFrequency"]'),Ne=e('.pid_filter input[name="gyroLowpass2Frequency"]'),me=e('.pid_filter select[name="gyroLowpassType"]'),se=e('.pid_filter select[name="gyroLowpass2Type"]'),ce=e('.pid_filter select[name="gyroLowpassDynType"]'),ie=e('.pid_filter input[id="gyroLowpassDynEnabled"]'),le=e('.pid_filter input[id="gyroLowpassEnabled"]'),ge=e('.pid_filter input[id="gyroLowpass2Enabled"]'),De=e(".gyroLowpass span.suboption"),Re=e(".gyroLowpass span.suboption.static"),Ee=e(".gyroLowpass span.suboption.dynamic"),we=e(".gyroLowpass2 span.suboption"),Ge=e('.pid_filter select[name="gyroLowpassFilterMode"]'),ye=e('.pid_filter input[name="dtermLowpassDynMinFrequency"]'),h=e('.pid_filter input[name="dtermLowpassDynMaxFrequency"]'),f=e('.pid_filter input[name="dtermLowpassFrequency"]'),C=e('.pid_filter input[name="dtermLowpass2Frequency"]'),V=e('.pid_filter select[name="dtermLowpassType"]'),oe=e('.pid_filter select[name="dtermLowpass2Type"]'),te=e('.pid_filter select[name="dtermLowpassDynType"]'),ae=e('.pid_filter input[id="dtermLowpassDynEnabled"]'),Y=e('input[id="dtermLowpassEnabled"]'),M=e('input[id="dtermLowpass2Enabled"]'),j=e(".dtermLowpass span.suboption"),d=e(".dtermLowpass span.suboption.static"),T=e(".dtermLowpass span.suboption.dynamic"),Se=e(".dtermLowpass2 span.suboption"),fe=e('.pid_filter select[name="dtermLowpassFilterMode"]');o.lt(i.CONFIG.apiVersion,F)?(le.change(function(){const a=e(this).is(":checked"),p=ie.is(":checked"),D=i.FILTER_CONFIG.gyro_lowpass_hz>0?i.FILTER_CONFIG.gyro_lowpass_hz:l.gyro_lowpass_hz,P=i.FILTER_CONFIG.gyro_lowpass_hz>0?i.FILTER_CONFIG.gyro_lowpass_type:l.gyro_lowpass_type;Me.val(a||p?D:0).attr("disabled",!a),me.each((w,de)=>e(de).val(P).attr("disabled",!a)),a&&ie.prop("checked",!1).change(),t.updateFilterWarning()}),ie.change(function(){const a=e(this).is(":checked");let p=l.gyro_lowpass_dyn_min_hz,D=l.gyro_lowpass_type;i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz>0&&i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz<i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz&&(p=i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz,D=i.FILTER_CONFIG.gyro_lowpass_type),H.val(a?p:0).attr("disabled",!a),Ie.attr("disabled",!a),ce.each((P,w)=>e(w).val(D).attr("disabled",!a)),a?le.prop("checked",!1).change():i.FILTER_CONFIG.gyro_lowpass_hz>0&&!le.is(":checked")&&le.prop("checked",!0).change(),t.updateFilterWarning()}),ge.change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.gyro_lowpass2_hz>0?i.FILTER_CONFIG.gyro_lowpass2_hz:l.gyro_lowpass2_hz,D=i.FILTER_CONFIG.gyro_lowpass2_hz>0?i.FILTER_CONFIG.gyro_lowpass2_type:l.gyro_lowpass2_type;Ne.val(a?p:0).attr("disabled",!a),se.each((P,w)=>e(w).val(D).attr("disabled",!a))}),Y.change(function(){const a=e(this).is(":checked"),p=ae.is(":checked"),D=i.FILTER_CONFIG.dterm_lowpass_hz>0?i.FILTER_CONFIG.dterm_lowpass_hz:l.dterm_lowpass_hz,P=i.FILTER_CONFIG.dterm_lowpass_hz>0?i.FILTER_CONFIG.dterm_lowpass_type:l.dterm_lowpass_type;f.val(a||p?D:0).attr("disabled",!a),V.each((w,de)=>e(de).val(P).attr("disabled",!a)),a&&ae.prop("checked",!1).change(),t.updateFilterWarning()}),ae.change(function(){const a=e(this).is(":checked");let p=l.dterm_lowpass_dyn_min_hz,D=l.dterm_lowpass_type;i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz>0&&i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz<i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz&&(p=i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz,D=i.FILTER_CONFIG.dterm_lowpass_type),ye.val(a?p:0).attr("disabled",!a),h.attr("disabled",!a),te.each((P,w)=>e(w).val(D).attr("disabled",!a)),a?Y.prop("checked",!1).change():i.FILTER_CONFIG.dterm_lowpass_hz>0&&!Y.is(":checked")&&Y.prop("checked",!0).change(),t.updateFilterWarning()}),M.change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.dterm_lowpass2_hz>0?i.FILTER_CONFIG.dterm_lowpass2_hz:l.dterm_lowpass2_hz,D=i.FILTER_CONFIG.dterm_lowpass2_hz>0?i.FILTER_CONFIG.dterm_lowpass2_type:l.dterm_lowpass2_type;C.val(a?p:0).attr("disabled",!a),oe.each((P,w)=>e(w).val(D).attr("disabled",!a))})):(le.change(function(){const a=e(this).is(":checked");a?i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz>0||i.FILTER_CONFIG.gyro_lowpass_hz>0?Ge.val(i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz>0?1:0).change():Ge.val(1).change():(H.val(0),Ie.val(0),Me.val(0),t.calculateNewGyroFilters()),De.toggle(a),Re.toggle(a&&i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz===0),Ee.toggle(a&&i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz!==0)}),Ge.change(function(){const a=parseInt(e(this).val()),p=i.FILTER_CONFIG.gyro_lowpass_hz>0?i.FILTER_CONFIG.gyro_lowpass_hz:l.gyro_lowpass_hz,D=i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz>0?i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz:l.gyro_lowpass_dyn_min_hz,P=i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz>0?i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz:l.gyro_lowpass_dyn_max_hz;Me.val(a?0:p),H.val(a?D:0),Ie.val(a?P:0),t.calculateNewGyroFilters(),Re.toggle(!a),Ee.toggle(!!a)}),ge.change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.gyro_lowpass2_hz>0?i.FILTER_CONFIG.gyro_lowpass2_hz:l.gyro_lowpass2_hz;Ne.val(a?p:0).attr("disabled",!a),t.calculateNewGyroFilters(),we.toggle(a),t.updateFilterWarning()}),Y.change(function(){const a=e(this).is(":checked");a?i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz>0||i.FILTER_CONFIG.dterm_lowpass_hz>0?fe.val(i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz>0?1:0).change():fe.val(1).change():(ye.val(0),h.val(0),f.val(0),t.calculateNewDTermFilters()),j.toggle(a),d.toggle(a&&i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz===0),T.toggle(a&&i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz!==0)}),fe.change(function(){const a=parseInt(e(this).val()),p=i.FILTER_CONFIG.dterm_lowpass_hz>0?i.FILTER_CONFIG.dterm_lowpass_hz:l.dterm_lowpass_hz,D=i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz>0?i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz:l.dterm_lowpass_dyn_min_hz,P=i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz>0?i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz:l.dterm_lowpass_dyn_max_hz;f.val(a?0:p),ye.val(a?D:0),h.val(a?P:0),t.calculateNewDTermFilters(),d.toggle(!a),T.toggle(!!a)}),M.change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.dterm_lowpass2_hz>0?i.FILTER_CONFIG.dterm_lowpass2_hz:l.dterm_lowpass2_hz;C.val(a?p:0).attr("disabled",!a),t.calculateNewDTermFilters(),Se.toggle(a),t.updateFilterWarning()})),e('input[id="yawLowpassEnabled"]').change(function(){const a=e(this).is(":checked"),p=i.FILTER_CONFIG.yaw_lowpass_hz>0?i.FILTER_CONFIG.yaw_lowpass_hz:l.yaw_lowpass_hz;e('.pid_filter input[name="yawLowpassFrequency"]').val(a?p:0).attr("disabled",!a),e(".yawLowpass span.suboption").toggle(a)});function re(a,p){const D=parseInt(e(`.pid_filter input[name='${a}']`).val()),P=parseInt(e(`.pid_filter input[name='${p}']`).val()),w=D==0?0:D-1;e(`.pid_filter input[name='${p}']`).attr("max",w),P>=D&&e(`.pid_filter input[name='${p}']`).val(w)}e('input[name="gyroNotch1Frequency"]').change(function(){re("gyroNotch1Frequency","gyroNotch1Cutoff")}).change(),e('input[name="gyroNotch2Frequency"]').change(function(){re("gyroNotch2Frequency","gyroNotch2Cutoff")}).change(),e('input[name="dTermNotchFrequency"]').change(function(){re("dTermNotchFrequency","dTermNotchCutoff")}).change(),e('input[id="gyroNotch1Enabled"]').prop("checked",i.FILTER_CONFIG.gyro_notch_hz!==0).change(),e('input[id="gyroNotch2Enabled"]').prop("checked",i.FILTER_CONFIG.gyro_notch2_hz!==0).change(),e('input[id="dtermNotchEnabled"]').prop("checked",i.FILTER_CONFIG.dterm_notch_hz!==0).change(),o.gte(i.CONFIG.apiVersion,F)?(le.prop("checked",i.FILTER_CONFIG.gyro_lowpass_hz!==0||i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz!==0).change(),Y.prop("checked",i.FILTER_CONFIG.dterm_lowpass_hz!==0||i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz!==0).change()):(le.prop("checked",i.FILTER_CONFIG.gyro_lowpass_hz!==0).change(),ie.prop("checked",i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz!==0&&i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz<i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz).change(),Y.prop("checked",i.FILTER_CONFIG.dterm_lowpass_hz!==0).change(),ae.prop("checked",i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz!==0&&i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz<i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz).change()),ge.prop("checked",i.FILTER_CONFIG.gyro_lowpass2_hz!==0).change(),M.prop("checked",i.FILTER_CONFIG.dterm_lowpass2_hz!==0).change(),e('input[id="yawLowpassEnabled"]').prop("checked",i.FILTER_CONFIG.yaw_lowpass_hz!==0).change(),t.updatePIDColors()}function c(){o.gte(i.CONFIG.apiVersion,"1.45.0")&&(i.CONFIG.pidProfileNames[i.CONFIG.profile]=e('input[name="pidProfileName"]').val().trim(),i.CONFIG.rateProfileNames[i.CONFIG.rateProfile]=e('input[name="rateProfileName"]').val().trim()),i.PID_NAMES.forEach(function(b,k){e(`.pid_tuning .${b} input`).each(function(Ie){e(this).val()&&(i.PIDS[k][Ie]=parseInt(e(this).val()))})});const N=e('.pid_tuning input[name="pitch_rate"]'),m=e('.pid_tuning input[name="roll_rate"]'),G=e('.pid_tuning input[name="yaw_rate"]'),A=e('.pid_tuning input[name="rc_rate_pitch"]'),R=e('.pid_tuning input[name="rc_rate"]'),z=e('.pid_tuning input[name="rc_rate_yaw"]'),q=e('.pid_tuning input[name="rc_pitch_expo"]'),$=e('.pid_tuning input[name="rc_expo"]'),K=e('.pid_tuning input[name="rc_yaw_expo"]');if(i.RC_TUNING.roll_pitch_rate=parseFloat(e('.pid_tuning input[name="roll_pitch_rate"]').val()),i.RC_TUNING.RC_RATE=parseFloat(R.val()),i.RC_TUNING.roll_rate=parseFloat(m.val()),i.RC_TUNING.pitch_rate=parseFloat(N.val()),i.RC_TUNING.yaw_rate=parseFloat(G.val()),i.RC_TUNING.RC_EXPO=parseFloat($.val()),i.RC_TUNING.RC_YAW_EXPO=parseFloat(K.val()),i.RC_TUNING.rcYawRate=parseFloat(z.val()),i.RC_TUNING.rcPitchRate=parseFloat(A.val()),i.RC_TUNING.RC_PITCH_EXPO=parseFloat(q.val()),o.gte(i.CONFIG.apiVersion,ne))switch(t.currentRatesType){case i.RATES_TYPE.RACEFLIGHT:i.RC_TUNING.pitch_rate=parseFloat(N.val())/100,i.RC_TUNING.roll_rate=parseFloat(m.val())/100,i.RC_TUNING.yaw_rate=parseFloat(G.val())/100,i.RC_TUNING.rcPitchRate=parseFloat(A.val())/1e3,i.RC_TUNING.RC_RATE=parseFloat(R.val())/1e3,i.RC_TUNING.rcYawRate=parseFloat(z.val())/1e3,i.RC_TUNING.RC_PITCH_EXPO=parseFloat(q.val())/100,i.RC_TUNING.RC_EXPO=parseFloat($.val())/100,i.RC_TUNING.RC_YAW_EXPO=parseFloat(K.val())/100;break;case i.RATES_TYPE.ACTUAL:i.RC_TUNING.pitch_rate=parseFloat(N.val())/1e3,i.RC_TUNING.roll_rate=parseFloat(m.val())/1e3,i.RC_TUNING.yaw_rate=parseFloat(G.val())/1e3,i.RC_TUNING.rcPitchRate=parseFloat(A.val())/1e3,i.RC_TUNING.RC_RATE=parseFloat(R.val())/1e3,i.RC_TUNING.rcYawRate=parseFloat(z.val())/1e3;break;case i.RATES_TYPE.QUICKRATES:i.RC_TUNING.pitch_rate=parseFloat(N.val())/1e3,i.RC_TUNING.roll_rate=parseFloat(m.val())/1e3,i.RC_TUNING.yaw_rate=parseFloat(G.val())/1e3;break}if(i.RC_TUNING.throttle_MID=parseFloat(e('.throttle input[name="mid"]').val()),i.RC_TUNING.throttle_EXPO=parseFloat(e('.throttle input[name="expo"]').val()),o.gte(i.CONFIG.apiVersion,X)?(i.ADVANCED_TUNING.tpaMode=e('select[id="tpaMode"]').val(),i.ADVANCED_TUNING.tpaRate=parseFloat(e('input[id="tpaRate"]').val()),i.ADVANCED_TUNING.tpaBreakpoint=parseInt(e('input[id="tpaBreakpoint"]').val())):(i.RC_TUNING.dynamic_THR_PID=parseFloat(e('.tpa-old input[name="tpa"]').val()),i.RC_TUNING.dynamic_THR_breakpoint=parseInt(e('.tpa-old input[name="tpa-breakpoint"]').val())),i.FILTER_CONFIG.gyro_lowpass_hz=parseInt(e('.pid_filter input[name="gyroLowpassFrequency"]').val()),i.FILTER_CONFIG.dterm_lowpass_hz=parseInt(e('.pid_filter input[name="dtermLowpassFrequency"]').val()),i.FILTER_CONFIG.yaw_lowpass_hz=parseInt(e('.pid_filter input[name="yawLowpassFrequency"]').val()),s){const b=e('input[id="vbatpidcompensation"]'),k=b.is(":checked")?1:0;let H;k!==i.ADVANCED_TUNING.vbatPidCompensation&&(H=b.is(":checked")),t.analyticsChanges.VbatPidCompensation=H,i.ADVANCED_TUNING.vbatPidCompensation=k}i.ADVANCED_TUNING.deltaMethod=e("#pid-tuning .delta select").val(),i.ADVANCED_TUNING.dtermSetpointTransition=parseInt(e('input[name="dtermSetpointTransition-number"]').val()*100),i.ADVANCED_TUNING.dtermSetpointWeight=parseInt(e('input[name="dtermSetpoint-number"]').val()*100),i.FILTER_CONFIG.gyro_notch_hz=parseInt(e('.pid_filter input[name="gyroNotch1Frequency"]').val()),i.FILTER_CONFIG.gyro_notch_cutoff=parseInt(e('.pid_filter input[name="gyroNotch1Cutoff"]').val()),i.FILTER_CONFIG.dterm_notch_hz=parseInt(e('.pid_filter input[name="dTermNotchFrequency"]').val()),i.FILTER_CONFIG.dterm_notch_cutoff=parseInt(e('.pid_filter input[name="dTermNotchCutoff"]').val()),i.FILTER_CONFIG.gyro_notch2_hz=parseInt(e('.pid_filter input[name="gyroNotch2Frequency"]').val()),i.FILTER_CONFIG.gyro_notch2_cutoff=parseInt(e('.pid_filter input[name="gyroNotch2Cutoff"]').val()),i.ADVANCED_TUNING.levelAngleLimit=parseInt(e('.pid_tuning input[name="angleLimit"]').val());const O=e('.antigravity input[name="itermAcceleratorGain"]');if(i.FILTER_CONFIG.dterm_lowpass_type=parseInt(e('.pid_filter select[name="dtermLowpassType"]').val()),o.gte(i.CONFIG.apiVersion,X)?i.ADVANCED_TUNING.antiGravityGain=parseInt(O.val()*10):(i.ADVANCED_TUNING.itermThrottleThreshold=parseInt(e('.antigravity input[name="itermThrottleThreshold"]').val()),i.ADVANCED_TUNING.itermAcceleratorGain=parseInt(O.val()*1e3)),i.FILTER_CONFIG.gyro_lowpass2_hz=parseInt(e('.pid_filter input[name="gyroLowpass2Frequency"]').val()),i.FILTER_CONFIG.gyro_lowpass_type=parseInt(e('.pid_filter select[name="gyroLowpassType"]').val()),i.FILTER_CONFIG.gyro_lowpass2_type=parseInt(e('.pid_filter select[name="gyroLowpass2Type"]').val()),i.FILTER_CONFIG.dterm_lowpass2_hz=parseInt(e('.pid_filter input[name="dtermLowpass2Frequency"]').val()),i.FILTER_CONFIG.dterm_lowpass2_type=parseInt(e('.pid_filter select[name="dtermLowpass2Type"]').val()),i.ADVANCED_TUNING.itermRotation=e('input[id="itermrotation"]').is(":checked")?1:0,i.ADVANCED_TUNING.smartFeedforward=e('input[id="smartfeedforward"]').is(":checked")?1:0,i.ADVANCED_TUNING.itermRelax=e('input[id="itermrelax"]').is(":checked")?e('select[id="itermrelaxAxes"]').val():0,i.ADVANCED_TUNING.itermRelaxType=e('select[id="itermrelaxType"]').val(),i.ADVANCED_TUNING.itermRelaxCutoff=parseInt(e('input[name="itermRelaxCutoff"]').val()),i.ADVANCED_TUNING.absoluteControlGain=e('input[name="absoluteControlGain-number"]').val(),i.ADVANCED_TUNING.throttleBoost=e('input[name="throttleBoost-number"]').val(),i.ADVANCED_TUNING.acroTrainerAngleLimit=e('input[name="acroTrainerAngleLimit-number"]').val(),i.ADVANCED_TUNING.feedforwardRoll=parseInt(e('.pid_tuning .ROLL input[name="f"]').val()),i.ADVANCED_TUNING.feedforwardPitch=parseInt(e('.pid_tuning .PITCH input[name="f"]').val()),i.ADVANCED_TUNING.feedforwardYaw=parseInt(e('.pid_tuning .YAW input[name="f"]').val()),i.ADVANCED_TUNING.feedforwardTransition=parseInt(e('input[name="feedforwardTransition-number"]').val()*100),i.ADVANCED_TUNING.antiGravityMode=o.lt(i.CONFIG.apiVersion,X)?e('select[id="antiGravityMode"]').val():0,i.RC_TUNING.throttleLimitType=e('select[id="throttleLimitType"]').val(),i.RC_TUNING.throttleLimitPercent=parseInt(e('.throttle_limit input[name="throttleLimitPercent"]').val()),i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz=parseInt(e('.pid_filter input[name="gyroLowpassDynMinFrequency"]').val()),i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz=parseInt(e('.pid_filter input[name="gyroLowpassDynMaxFrequency"]').val()),i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz=parseInt(e('.pid_filter input[name="dtermLowpassDynMinFrequency"]').val()),i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz=parseInt(e('.pid_filter input[name="dtermLowpassDynMaxFrequency"]').val()),o.lt(i.CONFIG.apiVersion,F)&&(i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz>0&&i.FILTER_CONFIG.gyro_lowpass_dyn_min_hz<i.FILTER_CONFIG.gyro_lowpass_dyn_max_hz&&(i.FILTER_CONFIG.gyro_lowpass_type=e('.pid_filter select[name="gyroLowpassDynType"]').val()),i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz>0&&i.FILTER_CONFIG.dterm_lowpass_dyn_min_hz<i.FILTER_CONFIG.dterm_lowpass_dyn_max_hz&&(i.FILTER_CONFIG.dterm_lowpass_type=e('.pid_filter select[name="dtermLowpassDynType"]').val())),i.ADVANCED_TUNING.dMinRoll=parseInt(e('.pid_tuning input[name="dMinRoll"]').val()),i.ADVANCED_TUNING.dMinPitch=parseInt(e('.pid_tuning input[name="dMinPitch"]').val()),i.ADVANCED_TUNING.dMinYaw=parseInt(e('.pid_tuning input[name="dMinYaw"]').val()),i.ADVANCED_TUNING.dMinGain=parseInt(e('.dminGroup input[name="dMinGain"]').val()),i.ADVANCED_TUNING.dMinAdvance=parseInt(e('.dminGroup input[name="dMinAdvance"]').val()),i.ADVANCED_TUNING.useIntegratedYaw=e('input[id="useIntegratedYaw"]').is(":checked")?1:0,o.gte(i.CONFIG.apiVersion,Ce)){i.FILTER_CONFIG.dyn_notch_range=parseInt(e('.pid_filter select[name="dynamicNotchRange"]').val()),i.FILTER_CONFIG.dyn_notch_width_percent=parseInt(e('.pid_filter input[name="dynamicNotchWidthPercent"]').val()),i.FILTER_CONFIG.dyn_notch_q=parseInt(e('.pid_filter input[name="dynamicNotchQ"]').val()),i.FILTER_CONFIG.dyn_notch_min_hz=parseInt(e('.pid_filter input[name="dynamicNotchMinHz"]').val());const b=e(".pid_filter #rpmFilterEnabled").is(":checked");i.FILTER_CONFIG.gyro_rpm_notch_harmonics=b?parseInt(e('.pid_filter input[name="rpmFilterHarmonics"]').val()):0,i.FILTER_CONFIG.gyro_rpm_notch_min_hz=parseInt(e('.pid_filter input[name="rpmFilterMinHz"]').val())}if(o.gte(i.CONFIG.apiVersion,ne)){i.FILTER_CONFIG.dyn_notch_max_hz=parseInt(e('.pid_filter input[name="dynamicNotchMaxHz"]').val()),i.ADVANCED_TUNING.motorOutputLimit=parseInt(e('.tab-pid_tuning input[name="motorLimit"]').val()),i.ADVANCED_TUNING.autoProfileCellCount=parseInt(e('.tab-pid_tuning select[name="cellCount"]').val()),i.ADVANCED_TUNING.idleMinRpm=parseInt(e('input[name="idleMinRpm-number"]').val());const b=e('select[id="ratesType"]').val();let k;b!==i.RC_TUNING.rates_type&&(k=e('select[id="ratesType"]').find("option:selected").text()),t.analyticsChanges.RatesType=k,i.RC_TUNING.rates_type=b}if(o.gte(i.CONFIG.apiVersion,F)){i.ADVANCED_TUNING.feedforward_averaging=e('select[id="feedforwardAveraging"]').val(),i.ADVANCED_TUNING.feedforward_smooth_factor=parseInt(e('input[name="feedforwardSmoothFactor"]').val()),i.ADVANCED_TUNING.feedforward_boost=parseInt(e('input[name="feedforwardBoost"]').val()),i.ADVANCED_TUNING.feedforward_max_rate_limit=parseInt(e('input[name="feedforwardMaxRateLimit"]').val()),i.ADVANCED_TUNING.feedforward_jitter_factor=parseInt(e('input[name="feedforwardJitterFactor"]').val()),i.FILTER_CONFIG.dyn_lpf_curve_expo=parseInt(e('.pid_filter input[name="dtermLowpassDynExpo"]').val()),i.ADVANCED_TUNING.vbat_sag_compensation=e('input[id="vbatSagCompensation"]').is(":checked")?parseInt(e('input[name="vbatSagValue"]').val()):0,i.ADVANCED_TUNING.thrustLinearization=e('input[id="thrustLinearization"]').is(":checked")?parseInt(e('input[name="thrustLinearValue"]').val()):0,i.FILTER_CONFIG.dyn_lpf_curve_expo=parseInt(e('.pid_filter input[name="dtermLowpassExpo"]').val());const b=e('.pid_filter input[id="dynamicNotchEnabled"]').is(":checked");i.FILTER_CONFIG.dyn_notch_count=b?parseInt(e('.pid_filter input[name="dynamicNotchCount"]').val()):0,i.TUNING_SLIDERS.slider_pids_mode=n.sliderPidsMode,i.TUNING_SLIDERS.slider_master_multiplier=Math.round(n.sliderMasterMultiplier*20)*5,i.TUNING_SLIDERS.slider_d_gain=Math.round(n.sliderDGain*20)*5,i.TUNING_SLIDERS.slider_pi_gain=Math.round(n.sliderPIGain*20)*5,i.TUNING_SLIDERS.slider_feedforward_gain=Math.round(n.sliderFeedforwardGain*20)*5,i.TUNING_SLIDERS.slider_i_gain=Math.round(n.sliderIGain*20)*5,i.TUNING_SLIDERS.slider_dmax_gain=Math.round(n.sliderDMaxGain*20)*5,i.TUNING_SLIDERS.slider_roll_pitch_ratio=Math.round(n.sliderRollPitchRatio*20)*5,i.TUNING_SLIDERS.slider_pitch_pi_gain=Math.round(n.sliderPitchPIGain*20)*5,i.TUNING_SLIDERS.slider_dterm_filter=n.sliderDTermFilter,i.TUNING_SLIDERS.slider_dterm_filter_multiplier=Math.round(n.sliderDTermFilterMultiplier*20)*5,i.TUNING_SLIDERS.slider_gyro_filter=n.sliderGyroFilter,i.TUNING_SLIDERS.slider_gyro_filter_multiplier=Math.round(n.sliderGyroFilterMultiplier*20)*5}}function u(){e(".pid_optional tr").hide(),e(".pid_optional table").hide(),e(".pid_optional").hide(),i.PID_NAMES.forEach(function(N){e(`.pid_tuning .${N}`).show(),e(`.needed_by_${N}`).show()})}function L(){ve(i.CONFIG.activeSensors,"acc")||(e("#pid_accel").hide(),e(".acroTrainerAngleLimit").hide());const N=function(G,A){let R=G.is(":visible");return(!R||!A)&&(G.hide(),R=!1),R};let m=!1;m|=N(e("#pid_baro"),ve(i.CONFIG.activeSensors,"baro")||ve(i.CONFIG.activeSensors,"sonar")),m|=N(e("#pid_mag"),ve(i.CONFIG.activeSensors,"mag")),m|=N(e("#pid_gps"),ve(i.CONFIG.activeSensors,"GPS")),m||e("#pid_baro_mag_gps").hide()}function x(N,m,G){N.strokeStyle="#000000",N.lineWidth=4,N.beginPath(),N.moveTo(0,G/2),N.lineTo(m,G/2),N.stroke(),N.beginPath(),N.moveTo(m/2,0),N.lineTo(m/2,G),N.stroke()}function v(N){let m=parseFloat(N.val());return(m<parseFloat(N.prop("min"))||m>parseFloat(N.prop("max")))&&(m=void 0),m}const J=!1;t.rateCurve=new He(J),e('.pid_tuning input[name="sensitivity"]').hide(),e(".pid_tuning .levelSensitivityHeader").empty();function W(N,m,G,A,R,z,q){const $=t.rateCurve.getMaxAngularVel(N,m,G,A,R,z).toFixed(0);return q.text($),$}function ee(N,m,G,A,R,z,q,$,K,O){O.save(),O.strokeStyle=$,O.translate(0,K),t.rateCurve.draw(N,m,G,A,R,z,q,O),O.restore()}function Z(){_e.pid_tuning.isHtmlProcessing=!0,i.FEATURE_CONFIG.features.generateElements(e(".tab-pid_tuning .features")),e(".tab-pid_tuning .pidTuningSuperexpoRates").hide(),y.localizePage(),t.currentRates=t.rateCurve.getCurrentRates(),e(".tab-pid_tuning .tab-container .pid").on("click",()=>Ne("pid")),e(".tab-pid_tuning .tab-container .rates").on("click",()=>Ne("rates")),e(".tab-pid_tuning .tab-container .filter").on("click",()=>Ne("filter"));function N(){const h=i.CONFIG.numProfiles,f=[];for(let C=0;C<h;C++)f.push(y.getMessage("pidTuningProfileOption",[C+1]));return f}function m(){let h=6;o.gte(i.CONFIG.apiVersion,X)&&(h=4);const f=[];for(let C=0;C<h;C++)f.push(y.getMessage("pidTuningRateProfileOption",[C+1]));return f}const G=m(),A=N();function R(h){const f=e('select[name="profile"]');h.forEach(function(C,V){f.append(`<option value="${V}">${C}</option>`)})}R(A);function z(h){const f=e('select[name="rate_profile"]');h.forEach(function(C,V){f.append(`<option value="${V}">${C}</option>`)})}z(G);const q=e("#showAllPids");function $(){t.showAllPids?(u(),q.text(y.getMessage("pidTuningHideUnusedPids"))):(L(),q.text(y.getMessage("pidTuningShowAllPids")))}u(),$(),q.on("click",function(){t.showAllPids=!t.showAllPids,$()}),e("#resetPidProfile").on("click",function(){t.updating=!0,S.promise(g.MSP_SET_RESET_CURR_PID).then(function(){t.refresh(function(){t.updating=!1,Te(y.getMessage("pidTuningPidProfileReset"))})})}),e('.tab-pid_tuning select[name="profile"]').change(function(){t.currentProfile=parseInt(e(this).val()),t.updating=!0,e(this).prop("disabled","true"),S.promise(g.MSP_SELECT_SETTING,[t.currentProfile]).then(function(){t.refresh(function(){t.updating=!1,e('.tab-pid_tuning select[name="profile"]').prop("disabled","false"),i.CONFIG.profile=t.currentProfile,Te(y.getMessage("pidTuningLoadedProfile",[t.currentProfile+1]))})})}),e('.tab-pid_tuning select[name="rate_profile"]').change(function(){t.currentRateProfile=parseInt(e(this).val()),t.updating=!0,e(this).prop("disabled","true"),S.promise(g.MSP_SELECT_SETTING,[t.currentRateProfile+t.RATE_PROFILE_MASK]).then(function(){t.refresh(function(){t.updating=!1,e('.tab-pid_tuning select[name="rate_profile"]').prop("disabled","false"),i.CONFIG.rateProfile=t.currentRateProfile,t.currentRates=t.rateCurve.getCurrentRates(),Te(y.getMessage("pidTuningLoadedRateProfile",[t.currentRateProfile+1]))})})});const K=e('input[name="dtermSetpointTransition-number"]'),O=e("#pid-tuning .dtermSetpointTransitionWarning");function b(h){h>0&&h<.1?O.show():O.hide()}b(K.val()),K.on("input",function(){b(e(this).val())}),e("#pid-tuning .delta").hide(),e(".tab-pid_tuning .note").hide(),e(".pid_tuning tr").each(function(){for(const h of i.PID_NAMES)if(e(this).hasClass(h)){const f=e(this).find("td:first");f.text()||f.text(h)}});function k(){const h=[];return h.push("PT1"),h.push("BIQUAD"),o.gte(i.CONFIG.apiVersion,F)&&(h.push("PT2"),h.push("PT3")),h}function H(h,f){const C=e(`select[name="${h}"]`);f.forEach(function(V,oe){C.append(`<option value="${oe}">${V}</option>`)})}function Ie(){return["HIGH","MEDIUM","LOW","AUTO"]}function Me(h){const f=e('select[name="dynamicNotchRange"]');h.forEach(function(C,V){f.append(`<option value="${V}">${C}</option>`)})}o.gte(i.CONFIG.apiVersion,Ce)&&Me(Ie()),H("gyroLowpassType",k()),H("gyroLowpass2Type",k()),H("dtermLowpassType",k()),H("dtermLowpass2Type",k()),o.lt(i.CONFIG.apiVersion,F)&&(H("gyroLowpassDynType",k()),H("dtermLowpassDynType",k())),E();function Ne(h){const f=["pid","rates","filter"];if(!f.includes(h)){console.debug(`Invalid subtab name: "${h}"`);return}for(name of f)e(`.tab-pid_tuning .subtab-${name}`)[name==h?"show":"hide"]();e(".tab-pid_tuning .tab-container .tab").removeClass("active"),e(`.tab-pid_tuning .tab-container .${h}`).addClass("active"),t.activeSubtab=h,h=="rates"&&ge(!0)}Ne(t.activeSubtab),e(".tab-pid_tuning div.controller").hide(),t.updatePidControllerParameters(),e(".pid_tuning .roll_pitch_rate").hide(),o.gte(i.CONFIG.apiVersion,X)?e(".tpa-old").hide():e(".tpa").hide(),e(".pid_tuning .bracket").hide(),e(".pid_tuning input[name=rc_rate]").parent().attr("class","pid_data"),e(".pid_tuning input[name=rc_rate]").parent().attr("rowspan",1),e(".pid_tuning input[name=rc_expo]").parent().attr("class","pid_data"),e(".pid_tuning input[name=rc_expo]").parent().attr("rowspan",1);const me=e(".rate_curve canvas#rate_curve_layer0").get(0),se=me.getContext("2d");let ce=!0,ie;t.maxAngularVelRollElement=e(".pid_tuning .maxAngularVelRoll"),t.maxAngularVelPitchElement=e(".pid_tuning .maxAngularVelPitch"),t.maxAngularVelYawElement=e(".pid_tuning .maxAngularVelYaw"),me.width=1e3,me.height=1e3;function le(h){setTimeout(function(){if(h){const f=e(h.target);let C=v(f);if(t.currentRates.hasOwnProperty(f.attr("name"))&&C!==void 0){const V=parseFloat(f.prop("step"));V!=null&&(C=Math.round(C/V)*V),t.currentRates[f.attr("name")]=C,ce=!0}f.attr("name")==="SUPEREXPO_RATES"&&(t.currentRates.superexpo=f.is(":checked"),ce=!0),f.attr("id")==="ratesType"&&o.gte(i.CONFIG.apiVersion,ne)&&(t.changeRatesType(C),ce=!0)}else ce=!0;if(ce){const f=me.height,C=me.width,V=se.canvas.width/se.canvas.clientWidth;se.clearRect(0,0,C,f),ie=Math.max(W(t.currentRates.roll_rate,t.currentRates.rc_rate,t.currentRates.rc_expo,t.currentRates.superexpo,t.currentRates.deadband,t.currentRates.roll_rate_limit,t.maxAngularVelRollElement),W(t.currentRates.pitch_rate,t.currentRates.rc_rate_pitch,t.currentRates.rc_pitch_expo,t.currentRates.superexpo,t.currentRates.deadband,t.currentRates.pitch_rate_limit,t.maxAngularVelPitchElement),W(t.currentRates.yaw_rate,t.currentRates.rc_rate_yaw,t.currentRates.rc_yaw_expo,t.currentRates.superexpo,t.currentRates.yawDeadband,t.currentRates.yaw_rate_limit,t.maxAngularVelYawElement)),ie=t.rateCurve.setMaxAngularVel(ie),x(se,C,f),se.lineWidth=2*V,ee(t.currentRates.roll_rate,t.currentRates.rc_rate,t.currentRates.rc_expo,t.currentRates.superexpo,t.currentRates.deadband,t.currentRates.roll_rate_limit,ie,"#ff0000",0,se),ee(t.currentRates.pitch_rate,t.currentRates.rc_rate_pitch,t.currentRates.rc_pitch_expo,t.currentRates.superexpo,t.currentRates.deadband,t.currentRates.pitch_rate_limit,ie,"#00ff00",-4,se),ee(t.currentRates.yaw_rate,t.currentRates.rc_rate_yaw,t.currentRates.rc_yaw_expo,t.currentRates.superexpo,t.currentRates.yawDeadband,t.currentRates.yaw_rate_limit,ie,"#0000ff",4,se),t.updateRatesLabels(),ce=!1}},0)}e("input.feature").on("input change",function(){const h=e(this);i.FEATURE_CONFIG.features.updateData(h),le()}),e(".pid_tuning").on("input change",le).trigger("input");function ge(h){if(!h&&!_e.pid_tuning.checkThrottle())return;function f(pe,ue,B,Ae){const Fe=1-pe;return Fe*Fe*ue+2*Fe*pe*B+pe*pe*Ae}function C(pe,ue,B,Ae,Fe,Ye,xe){return{x:f(xe,pe,B,Fe),y:f(xe,ue,Ae,Ye)}}const V=e('.throttle input[name="mid"]'),oe=e('.throttle input[name="expo"]'),te=parseFloat(V.val()),ae=parseFloat(oe.val()),Y=e(".throttle .throttle_curve canvas").get(0),M=Y.getContext("2d");if(!(te>=parseFloat(V.prop("min"))&&te<=parseFloat(V.prop("max"))&&ae>=parseFloat(oe.prop("min"))&&ae<=parseFloat(oe.prop("max"))))return;Y.width=Y.height*(Y.clientWidth/Y.clientHeight);const j=Y.height,d=Y.width,T=d*te,Se=T*.5,fe=(d-T)*.5+T,re=j-T*(j/d),a=j-(j-re)*.5*(ae+1),p=re/2*(ae+1);let D=(i.RC.channels[3]-1e3)/1e3,P=D<=te?C(0,j,Se,a,T,re,D*(1/te)):C(T,re,fe,p,d,0,(D-te)*(1/(1-te)));M.clearRect(0,0,d,j),M.beginPath(),M.moveTo(0,j),M.quadraticCurveTo(Se,a,T,re),M.moveTo(T,re),M.quadraticCurveTo(fe,p,d,0),M.lineWidth=2,M.strokeStyle="#ffbb00",M.stroke(),M.beginPath(),M.arc(P.x,P.y,4,0,2*Math.PI),M.fillStyle=M.strokeStyle,M.fill(),M.save();let w=10;M.font=`${w}pt Verdana, Arial, sans-serif`;let de=D*100,Pe=100-P.y/j*100,Ue=`${Math.round(D<=0?0:de)}% = ${Math.round(D<=0?0:Pe)}%`,Le=M.measureText(Ue);M.fillStyle="#000",M.scale(Le/Y.clientWidth,1),M.fillText(Ue,5,5+w),M.restore()}e(".throttle input").on("input change",()=>setTimeout(()=>ge(!0),0)),_e.pid_tuning.throttleDrawInterval=setInterval(ge,100),e("a.refresh").click(function(){t.refresh(function(){Te(y.getMessage("pidTuningDataRefreshed"))})}),e("#pid-tuning").find("input").each(function(h,f){e(f).attr("class")!=="feature toggle"&&e(f).attr("class")!=="nonProfile"&&e(f).change(function(){t.setDirty(!0)})});const De=e(".dialogCopyProfile")[0],Re=0,Ee=1;let we;const Ge=e(".selectProfile"),ye=e(".selectRateProfile");if(e.each(A,function(h,f){h!==i.CONFIG.profile&&Ge.append(new Option(f,h))}),e.each(G,function(h,f){h!==i.CONFIG.rateProfile&&ye.append(new Option(f,h))}),e(".copyprofilebtn").click(function(){e(".dialogCopyProfile").find(".contentProfile").show(),e(".dialogCopyProfile").find(".contentRateProfile").hide(),we=Re,De.showModal()}),e(".copyrateprofilebtn").click(function(){e(".dialogCopyProfile").find(".contentProfile").hide(),e(".dialogCopyProfile").find(".contentRateProfile").show(),we=Ee,De.showModal()}),e(".dialogCopyProfile-cancelbtn").click(function(){De.close()}),e(".dialogCopyProfile-confirmbtn").click(function(){switch(we){case Re:i.COPY_PROFILE.type=Re,i.COPY_PROFILE.dstProfile=parseInt(Ge.val()),i.COPY_PROFILE.srcProfile=i.CONFIG.profile,S.send_message(g.MSP_COPY_PROFILE,Q.crunch(g.MSP_COPY_PROFILE),!1,h);break;case Ee:i.COPY_PROFILE.type=Ee,i.COPY_PROFILE.dstProfile=parseInt(ye.val()),i.COPY_PROFILE.srcProfile=i.CONFIG.rateProfile,S.send_message(g.MSP_COPY_PROFILE,Q.crunch(g.MSP_COPY_PROFILE),!1,h);break;default:h();break}function h(){De.close()}}),o.gte(i.CONFIG.apiVersion,Ce)){n.initialize();const h=o.gte(i.CONFIG.apiVersion,F)?1.4:1.25,f=.7,C=.05,V=o.gte(i.CONFIG.apiVersion,F)?.05:.1,oe=e("#sliderPidsModeSelect"),te=e("#sliderGyroFilterModeSelect"),ae=e("#sliderDTermFilterModeSelect"),Y=e('input[id="useIntegratedYaw"]');Y.on("change",()=>{o.gte(i.CONFIG.apiVersion,F)?Y.is(":checked")&&n.sliderPidsMode&&oe.val(1).trigger("change"):n.updatePidSlidersDisplay()}),o.gte(i.CONFIG.apiVersion,F)&&(oe.on("change",function(){const d=parseInt(e(this).val());n.sliderPidsMode=d,n.calculateNewPids(),n.updatePidSlidersDisplay(),d===2&&Y.prop("checked",!1).trigger("change")}),te.change(function(){parseInt(e(this).find(":selected").val())===1?n.gyroFilterSliderEnable():n.gyroFilterSliderDisable()}),ae.change(function(){parseInt(e(this).find(":selected").val())!==0?n.dtermFilterSliderEnable():n.dtermFilterSliderDisable()}));let M;o.gte(i.CONFIG.apiVersion,F)?(M=e("#sliderMasterMultiplier, #sliderDGain, #sliderPIGain, #sliderFeedforwardGain, #sliderIGain, #sliderDMaxGain, #sliderRollPitchRatio, #sliderPitchPIGain"),e(".tab-pid-tuning .legacySlider").hide()):(M=e("#sliderMasterMultiplierLegacy, #sliderPDRatio, #sliderPDGain, #sliderFeedforwardGainLegacy"),e(".tab-pid_tuning .advancedSlider").hide(),e(".tab-pid-tuning .baseSlider").hide(),e(".tab-pid_tuning .sliderMode").hide()),M.on("input mouseup",function(){const d=e(this);if(o.lt(i.CONFIG.apiVersion,F)&&(d.val()>=1?d.attr("step",C):d.attr("step",V)),n.expertMode||(d.val()>h?d.val(h):d.val()<f&&d.val(f)),o.gte(i.CONFIG.apiVersion,F)){const T=Ve(d.val())?parseInt(d.val()):parseFloat(d.val());d.is("#sliderDGain")?n.sliderDGain=T:d.is("#sliderPIGain")?n.sliderPIGain=T:d.is("#sliderFeedforwardGain")?n.sliderFeedforwardGain=T:d.is("#sliderDMaxGain")?n.sliderDMaxGain=T:d.is("#sliderIGain")?n.sliderIGain=T:d.is("#sliderRollPitchRatio")?n.sliderRollPitchRatio=T:d.is("#sliderPitchPIGain")?n.sliderPitchPIGain=T:d.is("#sliderMasterMultiplier")&&(n.sliderMasterMultiplier=T)}else{const T=n.scaleSliderValue(d.val());d.is("#sliderMasterMultiplierLegacy")?n.sliderMasterMultiplierLegacy=T:d.is("#sliderPDRatio")?n.sliderPDRatio=T:d.is("#sliderPDGain")?n.sliderPDGain=T:d.is("#sliderFeedforwardGainLegacy")&&(n.sliderFeedforwardGainLegacy=T)}t.calculateNewPids(),t.analyticsChanges.PidTuningSliders="On"}),M.each(function(d){t.sliderOnScroll(e(this))}),M.dblclick(function(){const d=e(this);let T;o.gte(i.CONFIG.apiVersion,F)?d.is("#sliderDGain")?(T=i.DEFAULT_TUNING_SLIDERS.slider_d_gain/100,n.sliderDGain=T):d.is("#sliderPIGain")?(T=i.DEFAULT_TUNING_SLIDERS.slider_pi_gain/100,n.sliderPIGain=T):d.is("#sliderFeedforwardGain")?(T=i.DEFAULT_TUNING_SLIDERS.slider_feedforward_gain/100,n.sliderFeedforwardGain=T):d.is("#sliderDMaxGain")?(T=i.DEFAULT_TUNING_SLIDERS.slider_dmax_gain/100,n.sliderDMaxGain=T):d.is("#sliderIGain")?(T=i.DEFAULT_TUNING_SLIDERS.slider_i_gain/100,n.sliderIGain=T):d.is("#sliderRollPitchRatio")?(T=i.DEFAULT_TUNING_SLIDERS.slider_roll_pitch_ratio/100,n.sliderRollPitchRatio=T):d.is("#sliderPitchPIGain")?(T=i.DEFAULT_TUNING_SLIDERS.slider_pitch_pi_gain/100,n.sliderPitchPIGain=T):d.is("#sliderMasterMultiplier")&&(T=i.DEFAULT_TUNING_SLIDERS.slider_master_multiplier/100,n.sliderMasterMultiplier=T):(T=1,d.is("#sliderMasterMultiplierLegacy")?n.sliderMasterMultiplierLegacy=1:d.is("#sliderPDRatio")?n.sliderPDRatio=1:d.is("#sliderPDGain")?n.sliderPDGain=1:d.is("#sliderFeedforwardGainLegacy")&&(n.sliderFeedforwardGainLegacy=1)),d.val(T),t.calculateNewPids()});const j=e("#sliderGyroFilterMultiplier, #sliderDTermFilterMultiplier");j.on("input mouseup",function(){const d=e(this);n.expertMode||(o.gte(i.CONFIG.apiVersion,F)?d.is("#sliderGyroFilterMultiplier")?d.val()>1.5?d.val(1.5):d.val()<.5&&d.val(.5):d.is("#sliderDTermFilterMultiplier")&&(d.val()>1.2?d.val(1.2):d.val()<.8&&d.val(.8)):d.val()>h?d.val(h):d.val()<f&&d.val(f));let T=Ve(d.val())?parseInt(d.val()):parseFloat(d.val());o.lt(i.CONFIG.apiVersion,F)&&(T=n.scaleSliderValue(d.val())),d.is("#sliderGyroFilterMultiplier")?(n.sliderGyroFilterMultiplier=T,t.calculateNewGyroFilters(),t.analyticsChanges.GyroFilterTuningSlider="On"):d.is("#sliderDTermFilterMultiplier")&&(n.sliderDTermFilterMultiplier=T,t.calculateNewDTermFilters(),t.analyticsChanges.DTermFilterTuningSlider="On")}),j.each(function(){t.sliderOnScroll(e(this))}),j.dblclick(function(){const d=e(this);d.val(1),d.is("#sliderGyroFilterMultiplier")?(n.sliderGyroFilterMultiplier=1,t.calculateNewGyroFilters()):d.is("#sliderDTermFilterMultiplier")&&(n.sliderDTermFilterMultiplier=1,t.calculateNewDTermFilters())}),e(".pid_filter tr:not(.newFilter) input, .pid_filter tr:not(.newFilter) select").on("input",function(d){o.gte(i.CONFIG.apiVersion,F)?d.target.type==="number"?e(`.pid_filter input[name="${d.target.name}"]`).val(d.target.value):d.target.type==="select-one"&&e(`.pid_filter select[name="${d.target.name}"]`).val(d.target.value):n.updateFilterSlidersDisplay(),n.GyroSliderUnavailable&&(t.analyticsChanges.GyroFilterTuningSlider="Off"),n.DTermSliderUnavailable&&(t.analyticsChanges.DTermFilterTuningSlider="Off")}),e(".pid_filter tr:not(.newFilter) .inputSwitch input").change(()=>{e(".pid_filter input").triggerHandler("input"),t.setDirty(!0)}),e(".tuningHelp").hide(),o.lt(i.CONFIG.apiVersion,F)&&(e("#dMinSwitch").change(function(){n.setDMinFeatureEnabled(e(this).is(":checked")),n.pidSlidersUnavailable||(n.dMinFeatureEnabled?(i.ADVANCED_TUNING.dMinRoll=i.PIDS[0][2],i.ADVANCED_TUNING.dMinPitch=i.PIDS[1][2],i.ADVANCED_TUNING.dMinYaw=i.PIDS[2][2]):(i.PIDS[0][2]=i.ADVANCED_TUNING.dMinRoll,i.PIDS[1][2]=i.ADVANCED_TUNING.dMinPitch,i.PIDS[2][2]=i.ADVANCED_TUNING.dMinYaw),n.calculateNewPids())}),M.mouseup(function(){e('.pid_tuning .ROLL input[name="d"]').change(),e('.pid_tuning .PITCH input[name="d"]').change(),e('.pid_tuning .YAW input[name="d"]').change()}),e("a.buttonPidTuningSliders").click(function(){n.resetPidSliders(),n.updatePidSlidersDisplay(),e('input[id="useIntegratedYaw"]').is(":checked")&&e('input[id="useIntegratedYaw"]').prop("checked",!0).click(),t.analyticsChanges.PidTuningSliders="On"}),e("a.buttonFilterTuningSliders").click(function(){n.GyroSliderUnavailable&&(e('input[id="gyroLowpassDynEnabled"]').prop("checked",!1).click(),e('input[id="gyroLowpassEnabled"]').prop("checked",!0).click(),e('input[id="gyroLowpass2Enabled"]').prop("checked",!1).click(),n.resetGyroFilterSlider(),t.analyticsChanges.GyroFilterTuningSlider="On"),n.DTermSliderUnavailable&&(e('input[id="dtermLowpassDynEnabled"]').prop("checked",!1).click(),e('input[id="dtermLowpassEnabled"]').prop("checked",!0).click(),e('input[id="dtermLowpass2Enabled"]').prop("checked",!1).click(),n.resetDTermFilterSlider(),t.analyticsChanges.DTermFilterTuningSlider="On")}),e("#pid_main input").on("input",function(){n.updatePidSlidersDisplay(),t.analyticsChanges.PidTuningSliders="Off"}))}else e(".tuningPIDSliders").hide(),e(".tuningFilterSliders").hide(),e(".slidersDisabled").hide(),e(".slidersWarning").hide(),e(".nonExpertModeSlidersNote").hide(),e(".tuningHelpSliders").hide();e("#pid-tuning .delta select").change(function(){t.setDirty(!0)}),e("a.update").click(function(){c(),t.updating=!0,S.promise(g.MSP_SET_PID,Q.crunch(g.MSP_SET_PID)).then(()=>S.promise(g.MSP_SET_PID_ADVANCED,Q.crunch(g.MSP_SET_PID_ADVANCED))).then(()=>o.gte(i.CONFIG.apiVersion,X)?S.promise(g.MSP2_SET_TEXT,Q.crunch(g.MSP2_SET_TEXT,g.PID_PROFILE_NAME)):!0).then(()=>o.gte(i.CONFIG.apiVersion,X)?S.promise(g.MSP2_SET_TEXT,Q.crunch(g.MSP2_SET_TEXT,g.RATE_PROFILE_NAME)):!0).then(()=>(t.updatePIDColors(),S.promise(g.MSP_SET_FILTER_CONFIG,Q.crunch(g.MSP_SET_FILTER_CONFIG)))).then(()=>S.promise(g.MSP_SET_RC_TUNING,Q.crunch(g.MSP_SET_RC_TUNING))).then(()=>S.promise(g.MSP_SET_FEATURE_CONFIG,Q.crunch(g.MSP_SET_FEATURE_CONFIG))).then(()=>o.gte(i.CONFIG.apiVersion,F)?S.promise(g.MSP_SET_SIMPLIFIED_TUNING,Q.crunch(g.MSP_SET_SIMPLIFIED_TUNING)):!0).then(()=>S.promise(g.MSP_EEPROM_WRITE)).then(()=>{t.updating=!1,t.setDirty(!1),Te(y.getMessage("pidTuningEepromSaved")),t.refresh()}),ze.sendSaveAndChangeEvents(ze.EVENT_CATEGORIES.FLIGHT_CONTROLLER,t.analyticsChanges,"pid_tuning"),t.analyticsChanges={}}),t.initRatesPreview(),t.renderModel(),t.updating=!1,he.interval_add("receiver_pull",t.getReceiverData,250,!0),he.interval_add("update_profile",function(){t.checkUpdateProfile(!0)},500,!0),t.analyticsChanges={},he.content_ready(r),_e.pid_tuning.isHtmlProcessing=!1}};U.getReceiverData=function(){S.send_message(g.MSP_RC,!1,!1)};U.initRatesPreview=function(){this.keepRendering=!0,this.model=new We(e(".rates_preview"),e(".rates_preview canvas")),e(".tab-pid_tuning .tab-container .rates").on("click",e.proxy(this.model.resize,this.model)),e(".tab-pid_tuning .tab-container .rates").on("click",e.proxy(this.updateRatesLabels,this)),e(window).on("resize",e.proxy(this.model.resize,this.model)),e(window).on("resize",e.proxy(this.updateRatesLabels,this))};U.renderModel=function(){if(this.keepRendering&&requestAnimationFrame(this.renderModel.bind(this)),this.clock||(this.clock=new Xe),i.RC.channels[0]&&i.RC.channels[1]&&i.RC.channels[2]){const r=this.clock.getDelta(),t=r*this.rateCurve.rcCommandRawToDegreesPerSecond(i.RC.channels[0],this.currentRates.roll_rate,this.currentRates.rc_rate,this.currentRates.rc_expo,this.currentRates.superexpo,this.currentRates.deadband,this.currentRates.roll_rate_limit),l=r*this.rateCurve.rcCommandRawToDegreesPerSecond(i.RC.channels[1],this.currentRates.pitch_rate,this.currentRates.rc_rate_pitch,this.currentRates.rc_pitch_expo,this.currentRates.superexpo,this.currentRates.deadband,this.currentRates.pitch_rate_limit),_=r*this.rateCurve.rcCommandRawToDegreesPerSecond(i.RC.channels[2],this.currentRates.yaw_rate,this.currentRates.rc_rate_yaw,this.currentRates.rc_yaw_expo,this.currentRates.superexpo,this.currentRates.yawDeadband,this.currentRates.yaw_rate_limit);this.model.rotateBy(-be(l),-be(_),-be(t)),this.checkRC()&&this.updateRatesLabels()}};U.cleanup=function(r){const t=this;t.model&&(e(window).off("resize",e.proxy(t.model.resize,t.model)),t.model.dispose()),e(window).off("resize",e.proxy(this.updateRatesLabels,this)),t.keepRendering=!1,clearInterval(_e.pid_tuning.throttleDrawInterval),r&&r()};U.refresh=function(r){const t=this;he.tab_switch_cleanup(function(){t.initialize(),t.setDirty(!1),r&&r()})};U.setProfile=function(){const r=this;r.currentProfile=i.CONFIG.profile,e('.tab-pid_tuning select[name="profile"]').val(r.currentProfile)};U.setRateProfile=function(){const r=this;r.currentRateProfile=i.CONFIG.rateProfile,e('.tab-pid_tuning select[name="rate_profile"]').val(r.currentRateProfile)};U.setDirty=function(r){const t=this;t.dirty=r,e('.tab-pid_tuning select[name="profile"]').prop("disabled",r),e('.tab-pid_tuning select[name="rate_profile"]').prop("disabled",r)};U.checkUpdateProfile=function(r){const t=this;if(he.active_tab==="pid_tuning"&&!t.updating&&!t.dirty){let l=!1;t.currentProfile!==i.CONFIG.profile&&(t.setProfile(),l=!0);let _=!1;r&&t.currentRateProfile!==i.CONFIG.rateProfile&&(t.setRateProfile(),_=!0),(l||_)&&(t.updating=!0,t.refresh(function(){t.updating=!1,l&&(Te(y.getMessage("pidTuningReceivedProfile",[i.CONFIG.profile+1])),i.CONFIG.profile=t.currentProfile),_&&(Te(y.getMessage("pidTuningReceivedRateProfile",[i.CONFIG.rateProfile+1])),i.CONFIG.rateProfile=t.currentRateProfile)}))}};U.checkRC=function(){this.oldRC||(this.oldRC=[i.RC.channels[0],i.RC.channels[1],i.RC.channels[2]]);let r=!1;for(let t=0;t<this.oldRC.length;t++)this.oldRC[t]!==i.RC.channels[t]&&(this.oldRC[t]=i.RC.channels[t],r=!0);return r};U.checkThrottle=function(){if(!this.oldThrottle)return this.oldThrottle=i.RC.channels[3],!0;const r=this.oldThrottle!==i.RC.channels[3];return this.oldThrottle=i.RC.channels[3],r};U.updatePidControllerParameters=function(){e(".pid_tuning .YAW_JUMP_PREVENTION").hide(),e("#pid-tuning .dtermSetpointTransition").hide(),e("#pid-tuning .dtermSetpoint").hide(),e("#pid-tuning .delta").hide()};U.updateRatesLabels=function(){const r=this;if(!r.rateCurve.useLegacyCurve&&r.rateCurve.maxAngularVel){const t=function(s,E,c,u,L,x){s.fillStyle=x||"#000000",s.textAlign=L||"center",s.fillText(E,c,u)},l=function(s,E,c,u,L,x,v){const Z=parseInt(s.font),N=s.measureText(E).width*1.2,m=Z*1.5,G=u;s.fillStyle=x.color||"#ffffff",s.strokeStyle=x.border||"#000000",c*=s.canvas.clientWidth/s.canvas.clientHeight,c+=(L=="right"?-(N+125):0)+(L=="left"?125:0),u-=m/2,u<0?u=0:u>s.height&&(u=s.height);for(let R=0;R<v.length;R++)(c>=v[R].left&&c<=v[R].right||c+N>=v[R].left&&c+N<=v[R].right)&&(u>=v[R].top&&u<=v[R].bottom||u+m>=v[R].top&&u+m<=v[R].bottom)&&(u<=(v[R].bottom-v[R].top)/2&&v[R].top-m>0?u=v[R].top-m:u=v[R].bottom);v.push({left:c,right:c+N,top:u-5,bottom:u+m+5});const A=(m-2*10)/6;s.beginPath(),s.moveTo(c+10,u),s.lineTo(c+N-10,u),s.quadraticCurveTo(c+N,u,c+N,u+10),L==="right"&&(s.lineTo(c+N,u+10+A),s.lineTo(c+N+125,G),s.lineTo(c+N,u+m-10-A)),s.lineTo(c+N,u+m-10),s.quadraticCurveTo(c+N,u+m,c+N-10,u+m),s.lineTo(c+10,u+m),s.quadraticCurveTo(c,u+m,c,u+m-10),L==="left"&&(s.lineTo(c,u+m-10-A),s.lineTo(c-125,G),s.lineTo(c,u+10-A)),s.lineTo(c,u+10),s.quadraticCurveTo(c,u,c+10,u),s.closePath(),s.fill(),s.stroke(),t(s,E,c+N/2,u+(m+Z)/2-4,"center",x.text)},_={roll:{color:"rgba(255,128,128,0.4)",border:"rgba(255,128,128,0.6)",text:"#000000"},pitch:{color:"rgba(128,255,128,0.4)",border:"rgba(128,255,128,0.6)",text:"#000000"},yaw:{color:"rgba(128,128,255,0.4)",border:"rgba(128,128,255,0.6)",text:"#000000"}},I=e(".rate_curve canvas#rate_curve_layer1").get(0);if(I){I.width=1e3,I.height=1e3;const s=I.getContext("2d");s.save();const E=`${r.maxAngularVelRollElement.text()} deg/s`,c=`${r.maxAngularVelPitchElement.text()} deg/s`,u=`${r.maxAngularVelYawElement.text()} deg/s`;let L=[],x=[];const v=I.height,J=I.width,W=r.rateCurve.maxAngularVel,ee=400/s.canvas.clientHeight,Z=v/2/W,N=s.canvas.width/s.canvas.clientWidth,m=s.canvas.clientHeight/s.canvas.clientWidth;s.clearRect(0,0,J,v),ee<=1?s.font="24pt Verdana, Arial, sans-serif":s.font=`${24*ee}pt Verdana, Arial, sans-serif`,i.RC.channels[0]&&i.RC.channels[1]&&i.RC.channels[2]?(L.push(`${r.rateCurve.drawStickPosition(i.RC.channels[0],r.currentRates.roll_rate,r.currentRates.rc_rate,r.currentRates.rc_expo,r.currentRates.superexpo,r.currentRates.deadband,r.currentRates.roll_rate_limit,W,s,"#FF8080")} deg/s`),L.push(`${r.rateCurve.drawStickPosition(i.RC.channels[1],r.currentRates.pitch_rate,r.currentRates.rc_rate_pitch,r.currentRates.rc_pitch_expo,r.currentRates.superexpo,r.currentRates.deadband,r.currentRates.pitch_rate_limit,W,s,"#80FF80")} deg/s`),L.push(`${r.rateCurve.drawStickPosition(i.RC.channels[2],r.currentRates.yaw_rate,r.currentRates.rc_rate_yaw,r.currentRates.rc_yaw_expo,r.currentRates.superexpo,r.currentRates.yawDeadband,r.currentRates.yaw_rate_limit,W,s,"#8080FF")} deg/s`)):L=[],s.lineWidth=N,s.scale(m,1),t(s,`${W.toFixed(0)} deg/s`,(J/2-10)/m,parseInt(s.font)*1.2,"right"),x=[];const G=[{value:parseInt(E),balloon:function(){l(s,E,J,Z*(W-parseInt(E)),"right",_.roll,x)}},{value:parseInt(c),balloon:function(){l(s,c,J,Z*(W-parseInt(c)),"right",_.pitch,x)}},{value:parseInt(u),balloon:function(){l(s,u,J,Z*(W-parseInt(u)),"right",_.yaw,x)}}],A=1800,R=parseInt(E)>A||parseInt(c)>A||parseInt(u)>A;e(".maxRateWarning").toggle(R),G.sort(function(z,q){return q.value-z.value}),L[0]&&L[1]&&L[2]&&G.push({value:parseInt(L[0]),balloon:function(){l(s,L[0],10,150,"none",_.roll,x)}},{value:parseInt(L[1]),balloon:function(){l(s,L[1],10,250,"none",_.pitch,x)}},{value:parseInt(L[2]),balloon:function(){l(s,L[2],10,350,"none",_.yaw,x)}});for(const z of G)z.balloon();s.restore()}}};U.calculateNewPids=function(){_e.pid_tuning.isHtmlProcessing||n.calculateNewPids()};U.calculateNewGyroFilters=function(){_e.pid_tuning.isHtmlProcessing||n.sliderGyroFilter&&n.calculateNewGyroFilters()};U.calculateNewDTermFilters=function(){_e.pid_tuning.isHtmlProcessing||n.sliderDTermFilter&&n.calculateNewDTermFilters()};U.updateFilterWarning=function(){const r=parseInt(e('.pid_filter select[name="gyroLowpassFilterMode"]').val()),t=r===1,l=!r,_=parseInt(e('.pid_filter select[name="dtermLowpassFilterMode"]').val()),I=_===1,s=!_,E=e("#pid-tuning .filterWarning"),c=e("#pid-tuning .dynamicNotchWarning"),u=e("#pid-tuning .dynamicNotchNyquistWarningNote");E.toggle(!(t||l)||!(I||s)),u.toggle(o.gte(i.CONFIG.apiVersion,F)&&i.CONFIG.sampleRateHz/i.PID_ADVANCED_CONFIG.pid_process_denom<2e3),c.toggle(i.FEATURE_CONFIG.features.isEnabled("DYNAMIC_FILTER")&&o.gte(i.CONFIG.apiVersion,Ce)&&o.lt(i.CONFIG.apiVersion,F))};U.updatePIDColors=function(r=!1){if(o.gte(i.CONFIG.apiVersion,F))return;const t=function(l,_,I){if(r){l.css({"background-color":"transparent"});return}if(I===void 0||_===void 0)return;const s=(I-_)/50;l.css({"background-color":$e(s,ke.pidSlider)})};i.PID_NAMES.forEach(function(l,_){e(`.pid_tuning .${l} input`).each(function(I){t(e(this),i.PIDS_ACTIVE[_][I],i.PIDS[_][I])})}),t(e('.pid_tuning input[name="dMinRoll"]'),i.ADVANCED_TUNING_ACTIVE.dMinRoll,i.ADVANCED_TUNING.dMinRoll),t(e('.pid_tuning input[name="dMinPitch"]'),i.ADVANCED_TUNING_ACTIVE.dMinPitch,i.ADVANCED_TUNING.dMinPitch),t(e('.pid_tuning input[name="dMinYaw"]'),i.ADVANCED_TUNING_ACTIVE.dMinYaw,i.ADVANCED_TUNING.dMinYaw),t(e('.pid_tuning .ROLL input[name="f"]'),i.ADVANCED_TUNING_ACTIVE.feedforwardRoll,i.ADVANCED_TUNING.feedforwardRoll),t(e('.pid_tuning .PITCH input[name="f"]'),i.ADVANCED_TUNING_ACTIVE.feedforwardPitch,i.ADVANCED_TUNING.feedforwardPitch),t(e('.pid_tuning .YAW input[name="f"]'),i.ADVANCED_TUNING_ACTIVE.feedforwardYaw,i.ADVANCED_TUNING.feedforwardYaw)};U.changeRatesType=function(r){const t=this,l=e(".dialogRatesType")[0];if(t.previousRatesType==null){t.currentRatesType=r,t.changeRatesTypeLogo(),t.changeRatesSystem(!0),t.previousRatesType=t.currentRatesType;return}l.hasAttribute("open")||(l.showModal(),e(".dialogRatesType-cancelbtn").click(function(){e('.rates_type select[id="ratesType"]').val(t.currentRatesType),t.previousRatesType=t.currentRatesType,l.close()}),e(".dialogRatesType-confirmbtn").click(function(){t.currentRatesType=r,t.changeRatesTypeLogo(),t.changeRatesSystem(!1),t.previousRatesType=t.currentRatesType,l.close(),i.RC_TUNING.rates_type=t.currentRatesType,t.currentRates=t.rateCurve.getCurrentRates()}))};U.changeRatesSystem=function(r){const t=this;let l=2.55,_=.01,I=.01,s=1,E=.01,c=1,u=.01,L=0;const x=0,v=e('.pid_tuning input[name="pitch_rate"]'),J=e('.pid_tuning input[name="roll_rate"]'),W=e('.pid_tuning input[name="yaw_rate"]'),ee=e('.pid_tuning input[name="rc_rate_pitch"]'),Z=e('.pid_tuning input[name="rc_rate"]'),N=e('.pid_tuning input[name="rc_rate_yaw"]'),m=e('.pid_tuning input[name="rc_pitch_expo"]'),G=e('.pid_tuning input[name="rc_expo"]'),A=e('.pid_tuning input[name="rc_yaw_expo"]'),R=e("#pid-tuning .pid_titlebar .rc_rate"),z=e("#pid-tuning .pid_titlebar .rate"),q=e("#pid-tuning .pid_titlebar .rc_expo");let $=1 .toFixed(2),K=.7.toFixed(2),O=0 .toFixed(2);switch(r&&(v.val(i.RC_TUNING.pitch_rate.toFixed(2)),J.val(i.RC_TUNING.roll_rate.toFixed(2)),W.val(i.RC_TUNING.yaw_rate.toFixed(2)),ee.val(i.RC_TUNING.rcPitchRate.toFixed(2)),Z.val(i.RC_TUNING.RC_RATE.toFixed(2)),N.val(i.RC_TUNING.rcYawRate.toFixed(2)),m.val(i.RC_TUNING.RC_PITCH_EXPO.toFixed(2)),G.val(i.RC_TUNING.RC_EXPO.toFixed(2)),A.val(i.RC_TUNING.RC_YAW_EXPO.toFixed(2))),t.currentRatesType){case i.RATES_TYPE.RACEFLIGHT:R.text(y.getMessage("pidTuningRcRateRaceflight")),z.text(y.getMessage("pidTuningRateRaceflight")),q.text(y.getMessage("pidTuningRcExpoRaceflight")),l=2e3,_=10,I=10,s=255,E=1,c=100,u=1,r?(v.val((i.RC_TUNING.pitch_rate*100).toFixed(0)),J.val((i.RC_TUNING.roll_rate*100).toFixed(0)),W.val((i.RC_TUNING.yaw_rate*100).toFixed(0)),ee.val((i.RC_TUNING.rcPitchRate*1e3).toFixed(0)),Z.val((i.RC_TUNING.RC_RATE*1e3).toFixed(0)),N.val((i.RC_TUNING.rcYawRate*1e3).toFixed(0)),m.val((i.RC_TUNING.RC_PITCH_EXPO*100).toFixed(0)),G.val((i.RC_TUNING.RC_EXPO*100).toFixed(0)),A.val((i.RC_TUNING.RC_YAW_EXPO*100).toFixed(0))):($=370 .toFixed(0),K=80 .toFixed(0),O=50 .toFixed(0));break;case i.RATES_TYPE.KISS:R.text(y.getMessage("pidTuningRcRate")),z.text(y.getMessage("pidTuningRcRateRaceflight")),q.text(y.getMessage("pidTuningRcExpoKISS")),s=.99;break;case i.RATES_TYPE.ACTUAL:R.text(y.getMessage("pidTuningRcRateActual")),z.text(y.getMessage("pidTuningRateQuickRates")),q.text(y.getMessage("pidTuningRcExpoRaceflight")),L=10,s=2e3,E=10,l=2e3,_=10,I=10,r?(v.val((i.RC_TUNING.pitch_rate*1e3).toFixed(0)),J.val((i.RC_TUNING.roll_rate*1e3).toFixed(0)),W.val((i.RC_TUNING.yaw_rate*1e3).toFixed(0)),ee.val((i.RC_TUNING.rcPitchRate*1e3).toFixed(0)),Z.val((i.RC_TUNING.RC_RATE*1e3).toFixed(0)),N.val((i.RC_TUNING.rcYawRate*1e3).toFixed(0))):o.gte(i.CONFIG.apiVersion,F)?($=70 .toFixed(0),K=670 .toFixed(0),O=0 .toFixed(2)):($=200 .toFixed(0),K=670 .toFixed(0),O=.54.toFixed(2));break;case i.RATES_TYPE.QUICKRATES:R.text(y.getMessage("pidTuningRcRate")),z.text(y.getMessage("pidTuningRateQuickRates")),q.text(y.getMessage("pidTuningRcExpoRaceflight")),L=10,s=2e3,E=10,r?(v.val((i.RC_TUNING.pitch_rate*1e3).toFixed(0)),J.val((i.RC_TUNING.roll_rate*1e3).toFixed(0)),W.val((i.RC_TUNING.yaw_rate*1e3).toFixed(0))):K=670 .toFixed(0);break;default:R.text(y.getMessage("pidTuningRcRate")),z.text(y.getMessage("pidTuningRate")),q.text(y.getMessage("pidTuningRcExpo"));break}const b=e('#pid-tuning input[class="rc_rate_input"]'),k=e('#pid-tuning input[class="rate_input"]'),H=e('#pid-tuning input[class="expo_input"]');r||(k.val(K),b.val($),H.val(O)),b.attr({max:l,min:_,step:I}).change(),k.attr({max:s,min:L,step:E}).change(),H.attr({max:c,min:x,step:u}).change(),r&&t.setDirty(!1)};U.changeRatesTypeLogo=function(){const r=this,t=e('.rates_type img[id="ratesLogo"]');switch(r.currentRatesType){case i.RATES_TYPE.RACEFLIGHT:t.attr("src","./images/rate_logos/raceflight.svg");break;case i.RATES_TYPE.KISS:t.attr("src","./images/rate_logos/kiss.svg");break;case i.RATES_TYPE.ACTUAL:t.attr("src","./images/rate_logos/actual.svg");break;case i.RATES_TYPE.QUICKRATES:t.attr("src","./images/rate_logos/quickrates.svg");break;default:t.attr("src","./images/rate_logos/betaflight.svg");break}};U.expertModeChanged=function(r){n.setExpertMode(r)};U.sliderOnScroll=function(r,t){r.parent().on("input wheel",function(l){var c,u;if(r.prop("disabled")||!((c=l.originalEvent)!=null&&c.deltaY&&((u=l.originalEvent)!=null&&u.altKey)))return;l.preventDefault();const _=parseFloat(r.attr("step")),I=l.originalEvent.deltaY>0?-_:_,s=Ve(r.val())?parseInt(r.val()):parseFloat(r.val()),E=(Math.floor(s*100)+Math.floor(I*100))/100;r.val(E),r.trigger("input"),r.trigger("change")})};_e.pid_tuning=U;export{U as pid_tuning};
