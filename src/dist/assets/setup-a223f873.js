import{d as Q,F as e,h as O,j as t,k as se,G as A,f as E,i,N as ne,t as z,m as p,O as le,Q as oe,w as H,x as F,R as re,S as J,W as de,$ as a,X as Se,T as Y,Y as m,Z as Ie,E as Z,A as Oe,H as ee}from"./index-9715db87.js";import{g as Ee}from"./generate_filename-ef5ebf28.js";function Ce(R){let u=null,g=Q.version;g.indexOf(".")===-1&&(g=`${g}.0.0`);const _={generatedBy:g,apiVersion:e.CONFIG.apiVersion,profiles:[]},b=[t.MSP_PID_CONTROLLER,t.MSP_PID,t.MSP_RC_TUNING,t.MSP_ACC_TRIM,t.MSP_SERVO_CONFIGURATIONS,t.MSP_MODE_RANGES,t.MSP_ADJUSTMENT_RANGES,t.MSP_SERVO_MIX_RULES,t.MSP_RC_DEADBAND];O.send_message(t.MSP_STATUS,!1,!1,function(){u=e.CONFIG.profile,v()});function v(){u>0?O.send_message(t.MSP_SELECT_SETTING,[0],!1,s):s()}function s(){let I=0,N=0;function M(){I<e.CONFIG.numProfiles?O.send_message(b[N],!1,!1,function(){N++,N<b.length?M():(_.profiles.push({PID:jQuery.extend(!0,{},e.PID),PIDs:jQuery.extend(!0,[],e.PIDS),RC:jQuery.extend(!0,{},e.RC_TUNING),AccTrim:jQuery.extend(!0,[],e.CONFIG.accelerometerTrims),ServoConfig:jQuery.extend(!0,[],e.SERVO_CONFIG),ServoRules:jQuery.extend(!0,[],e.SERVO_RULES),ModeRanges:jQuery.extend(!0,[],e.MODE_RANGES),AdjustmentRanges:jQuery.extend(!0,[],e.ADJUSTMENT_RANGES)}),_.profiles[I].RCdeadband=jQuery.extend(!0,{},e.RC_DEADBAND_CONFIG),N=0,I++,O.send_message(t.MSP_SELECT_SETTING,[I],!1,M))}):O.send_message(t.MSP_SELECT_SETTING,[u],!1,o)}M()}const l=[t.MSP_RX_MAP,t.MSP_CF_SERIAL_CONFIG,t.MSP_LED_STRIP_CONFIG,t.MSP_LED_COLORS];function n(){l.push(t.MSP_LOOP_TIME),l.push(t.MSP_ARMING_CONFIG),l.push(t.MSP_MOTOR_3D_CONFIG),l.push(t.MSP_SENSOR_ALIGNMENT),l.push(t.MSP_RX_CONFIG),l.push(t.MSP_FAILSAFE_CONFIG),l.push(t.MSP_RXFAIL_CONFIG),l.push(t.MSP_LED_STRIP_MODECOLOR),l.push(t.MSP_MOTOR_CONFIG),l.push(t.MSP_RSSI_CONFIG),l.push(t.MSP_GPS_CONFIG),l.push(t.MSP_FEATURE_CONFIG),l.push(t.MSP_MODE_RANGES_EXTRA)}n();function o(){let I=0;function N(){I<l.length?O.send_message(l[I],!1,!1,function(){I++,N()}):(_.RCMAP=jQuery.extend(!0,[],e.RC_MAP),_.SERIAL_CONFIG=jQuery.extend(!0,{},e.SERIAL_CONFIG),_.LED_STRIP=jQuery.extend(!0,[],e.LED_STRIP),_.LED_COLORS=jQuery.extend(!0,[],e.LED_COLORS),_.BOARD_ALIGNMENT_CONFIG=jQuery.extend(!0,{},e.BOARD_ALIGNMENT_CONFIG),p.gte(e.CONFIG.apiVersion,H)?(_.CRAFT_NAME=e.CONFIG.craftName,_.PILOT_NAME=e.CONFIG.pilotName):(_.CRAFT_NAME=e.CONFIG.name,_.DISPLAY_NAME=e.CONFIG.displayName),_.MIXER_CONFIG=jQuery.extend(!0,{},e.MIXER_CONFIG),_.SENSOR_CONFIG=jQuery.extend(!0,{},e.SENSOR_CONFIG),_.PID_ADVANCED_CONFIG=jQuery.extend(!0,{},e.PID_ADVANCED_CONFIG),_.LED_MODE_COLORS=jQuery.extend(!0,[],e.LED_MODE_COLORS),_.FC_CONFIG=jQuery.extend(!0,{},e.FC_CONFIG),_.ARMING_CONFIG=jQuery.extend(!0,{},e.ARMING_CONFIG),_.MOTOR_3D_CONFIG=jQuery.extend(!0,{},e.MOTOR_3D_CONFIG),_.SENSOR_ALIGNMENT=jQuery.extend(!0,{},e.SENSOR_ALIGNMENT),_.RX_CONFIG=jQuery.extend(!0,{},e.RX_CONFIG),_.FAILSAFE_CONFIG=jQuery.extend(!0,{},e.FAILSAFE_CONFIG),_.RXFAIL_CONFIG=jQuery.extend(!0,[],e.RXFAIL_CONFIG),_.RSSI_CONFIG=jQuery.extend(!0,{},e.RSSI_CONFIG),_.FEATURE_CONFIG=jQuery.extend(!0,{},e.FEATURE_CONFIG),_.MOTOR_CONFIG=jQuery.extend(!0,{},e.MOTOR_CONFIG),_.GPS_CONFIG=jQuery.extend(!0,{},e.GPS_CONFIG),_.BEEPER_CONFIG=jQuery.extend(!0,{},e.BEEPER_CONFIG),_.MODE_RANGES_EXTRA=jQuery.extend(!0,[],e.MODE_RANGES_EXTRA),r())}if(A.configuration_loaded===!0)return N();O.promise(t.MSP_ADVANCED_CONFIG).then(()=>O.promise(t.MSP_SENSOR_CONFIG)).then(()=>p.gte(e.CONFIG.apiVersion,H)?O.promise(t.MSP2_GET_TEXT,F.crunch(t.MSP2_GET_TEXT,t.CRAFT_NAME)):O.promise(t.MSP_NAME)).then(()=>p.gte(e.CONFIG.apiVersion,H)?O.promise(t.MSP2_GET_TEXT,F.crunch(t.MSP2_GET_TEXT,t.PILOT_NAME)):Promise.resolve(!0)).then(()=>O.promise(t.MSP_BOARD_ALIGNMENT_CONFIG)).then(()=>O.promise(t.MSP_MIXER_CONFIG)).then(()=>O.promise(t.MSP_BEEPER_CONFIG)).then(()=>N())}function r(){let I=null;const N="backup",M="json",L=Ee(N,M),k=[{description:`${M.toUpperCase()} files`,extensions:[M]}];chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:L,accepts:k},function(x){if(!se()){if(!x){console.log("No file selected, backup aborted.");return}I=x,chrome.fileSystem.getDisplayPath(I,function(P){console.log(`Backup file path: ${P}`)}),chrome.fileSystem.getWritableEntry(I,function(P){chrome.fileSystem.isWritableEntry(P,function(U){if(U){I=P;const X=JSON.stringify(_,null,"	"),h=new Blob([X],{type:"text/plain"});I.createWriter(function(C){C.onerror=function(G){console.error(G)};let d=!1;C.onwriteend=function(){if(!d){d=!0,C.truncate(h.size);return}z.sendEvent(z.EVENT_CATEGORIES.FLIGHT_CONTROLLER,"Backup"),console.log("Write SUCCESSFUL"),R&&R()},C.write(h)},function(C){console.error(C)})}else console.log("File appears to be read only, sorry.")})})}})}}function Ne(R){let u=null;const g=[{description:"JSON files",extensions:["json"]}];chrome.fileSystem.chooseEntry({type:"openFile",accepts:g},function(s){if(!se()){if(!s){console.log("No file selected, restore aborted.");return}u=s,chrome.fileSystem.getDisplayPath(u,function(l){console.log(`Restore file path: ${l}`)}),u.file(function(l){const n=new FileReader;n.onprogress=function(o){o.total>1048576&&(console.log("File limit (1 MB) exceeded, aborting"),n.abort())},n.onloadend=function(o){if(o.total!=0&&o.total==o.loaded||A.isCordova()){console.log("Read SUCCESSFUL");let r;try{r=JSON.parse(o.target.result)}catch(I){console.log(`Data provided != valid JSON string, restore aborted: ${I}`);return}if(typeof r.generatedBy<"u"&&_(r.generatedBy,Q.BACKUP_FILE_VERSION_MIN_SUPPORTED)){if(!_(r.generatedBy,"1.14.0")&&!b(r)){E(i.getMessage("backupFileUnmigratable"));return}if(r.FEATURE_CONFIG.features._featureMask){const I=new ne(e.CONFIG);I.setMask(r.FEATURE_CONFIG.features._featureMask),r.FEATURE_CONFIG.features=I}z.sendEvent(z.EVENT_CATEGORIES.FLIGHT_CONTROLLER,"Restore"),v(r,R)}else E(i.getMessage("backupFileIncompatible"))}},n.readAsText(l)})}});function _(s,l){return s==null?!1:p.gte(s,l)}function b(s){let l=0,n=s.generatedBy;if(E(i.getMessage("configMigrationFrom",[n])),_(n,"0.59.1")||(s.RSSI_CONFIG.channel=s.MISC.rssi_aux_channel,s.MISC.rssi_aux_channel=void 0,n="0.59.1",E(i.getMessage("configMigratedTo",[n])),l++),_(n,"0.60.1")||(s.LED_STRIP||(s.LED_STRIP=[]),n="0.60.1",E(i.getMessage("configMigratedTo",[n])),l++),_(n,"0.61.0")||(!s.PIDs&&s.PID&&(s.PIDs=s.PID,s.PID={controller:0}),n="0.61.0",E(i.getMessage("configMigratedTo",[n])),l++),!_(n,"0.63.0")){if(typeof s.LED_STRIP=="object"){const o=[];let r=0;for(;s.LED_STRIP[r];)o.push(s.LED_STRIP[r++]);s.LED_STRIP=o}for(let o=0;o<3;o++){const r=s.profiles[o].RC;r.dynamic_THR_breakpoint||(r.dynamic_THR_breakpoint=1500),r.roll_rate=r.roll_pitch_rate,r.pitch_rate=r.roll_pitch_rate}n="0.63.0",E(i.getMessage("configMigratedTo",[n])),l++}if(s.apiVersion==null&&(s.apiVersion="1.0.0"),!p.parse(s.apiVersion)&&(s.apiVersion+=".0",!p.parse(s.apiVersion)))return!1;if(_(n,"0.63.0")&&!_(s.apiVersion,"1.7.0")){const o=[];for(const r of s.SERIAL_CONFIG.ports){const I=r,N={identifier:I.identifier,functions:[],msp_baudrate:String(s.SERIAL_CONFIG.mspBaudRate),gps_baudrate:String(s.SERIAL_CONFIG.gpsBaudRate),telemetry_baudrate:"AUTO",blackbox_baudrate:"115200"};switch(I.scenario){case 1:case 5:case 8:N.functions.push("MSP");break;case 2:N.functions.push("GPS");break;case 3:N.functions.push("RX_SERIAL");break;case 10:N.functions.push("BLACKBOX");break;case 11:N.functions.push("MSP"),N.functions.push("BLACKBOX");break}o.push(N)}s.SERIAL_CONFIG={ports:o},E(i.getMessage("configMigratedTo",[n])),l++}if(_(n,"0.63.0")&&!_(s.apiVersion,"1.8.0")&&(s.FC_CONFIG==null&&(s.FC_CONFIG={loopTime:3500}),s.ARMING_CONFIG==null&&(s.ARMING_CONFIG={auto_disarm_delay:5,disarm_kill_switch:1}),E(i.getMessage("configMigratedTo",[n])),l++),_(n,"0.63.0")&&s.FC_CONFIG.loopTime==0&&(s.FC_CONFIG.loopTime=3500),p.lt(n,"0.66.0")){for(let o=0;o<s.profiles.length;o++){if(p.eq(s.apiVersion,"1.10.0"))for(;s.profiles[o].ServoConfig.length>8;)s.profiles[o].ServoConfig.pop();for(let r=0;r<s.profiles[o].ServoConfig.length;r++){const I=s.profiles[o].ServoConfig;I[r].angleAtMin=45,I[r].angleAtMax=45,I[r].reversedInputSources=0,(I[r].rate<-100||I[r].rate>100)&&(I[r].rate=0)}s.profiles[o].ServoRules=[]}n="0.66.0",E(i.getMessage("configMigratedTo",[n])),l++}if(p.lt(s.apiVersion,"1.14.0")&&p.gte(e.CONFIG.apiVersion,"1.14.0")){for(let o=0;o<s.profiles.length;o++){let r=s.profiles[o].PID.controller;switch(r){case 3:case 4:case 5:r=0;break}s.profiles[o].PID.controller=r}E(i.getMessage("configMigratedTo",[n])),l++}if(_(n,"0.66.0")&&!_(s.apiVersion,"1.14.0")&&(s.MOTOR_3D_CONFIG==null&&(s.MOTOR_3D_CONFIG={deadband3d_low:1406,deadband3d_high:1514,neutral:1460,deadband3d_throttle:50}),E(i.getMessage("configMigratedTo",[n])),l++),_(n,"0.66.0")&&!_(s.apiVersion,"1.15.0")){for(let o=0;o<s.profiles.length;o++)s.profiles[o].RCdeadband==null&&(s.profiles[o].RCdeadband={deadband:0,yaw_deadband:0,alt_hold_deadband:40});if(s.SENSOR_ALIGNMENT==null&&(s.SENSOR_ALIGNMENT={align_gyro:0,align_acc:0,align_mag:0}),s.RX_CONFIG==null&&(s.RX_CONFIG={serialrx_provider:0,spektrum_sat_bind:0,stick_center:1500,stick_min:1100,stick_max:1900,rx_min_usec:885,rx_max_usec:2115}),s.FAILSAFE_CONFIG==null&&(s.FAILSAFE_CONFIG={failsafe_delay:10,failsafe_off_delay:200,failsafe_throttle:1e3,failsafe_switch_mode:0,failsafe_throttle_low_delay:100,failsafe_procedure:0}),s.RXFAIL_CONFIG==null){s.RXFAIL_CONFIG=[{mode:0,value:1500},{mode:0,value:1500},{mode:0,value:1500},{mode:0,value:875}];for(let o=0;o<14;o++){const r={mode:1,value:1500};s.RXFAIL_CONFIG.push(r)}}E(i.getMessage("configMigratedTo",[n])),l++}return _(n,"1.2.0")&&(e.GPS_CONFIG.ublox_sbas<0&&(e.GPS_CONFIG.ublox_sbas=0),n="1.2.0",E(i.getMessage("configMigratedTo",[n])),l++),_(n,"1.3.1")&&(s.LED_COLORS||(s.LED_COLORS=[]),s.LED_MODE_COLORS||(s.LED_MODE_COLORS=[]),n="1.3.1",E(i.getMessage("configMigratedTo",[n])),l++),l>0&&E(i.getMessage("configMigrationSuccessful",[l])),!0}function v(s,l){function n(){let o=null,r=e.CONFIG.numProfiles;s.profiles.length<r&&(r=s.profiles.length);const I=[t.MSP_SET_PID_CONTROLLER,t.MSP_SET_PID,t.MSP_SET_RC_TUNING,t.MSP_SET_ACC_TRIM,t.MSP_SET_RC_DEADBAND];O.send_message(t.MSP_STATUS,!1,!1,function(){o=e.CONFIG.profile,N()});function N(){o>0?O.send_message(t.MSP_SELECT_SETTING,[0],!1,M):M()}function M(){let C=0,d=0;function G(f){e.PID=s.profiles[f].PID,e.PIDS=s.profiles[f].PIDs,e.RC_TUNING=s.profiles[f].RC,e.CONFIG.accelerometerTrims=s.profiles[f].AccTrim,e.SERVO_CONFIG=s.profiles[f].ServoConfig,e.SERVO_RULES=s.profiles[f].ServoRules,e.MODE_RANGES=s.profiles[f].ModeRanges,e.ADJUSTMENT_RANGES=s.profiles[f].AdjustmentRanges,e.RC_DEADBAND_CONFIG=s.profiles[f].RCdeadband}function T(){O.send_message(I[d],F.crunch(I[d]),!1,function(){d++,d<I.length?T():(d=0,C++,C<r?(G(C),O.send_message(t.MSP_EEPROM_WRITE,!1,!1,function(){O.send_message(t.MSP_SELECT_SETTING,[C],!1,T)})):O.send_message(t.MSP_EEPROM_WRITE,!1,!1,function(){O.send_message(t.MSP_SELECT_SETTING,[o],!1,L)}))})}function y(){F.sendServoConfigurations(B)}function B(){if(p.gte(e.CONFIG.apiVersion,re))if(s.MODE_RANGES_EXTRA==null){e.MODE_RANGES_EXTRA=[];for(let f=0;f<e.MODE_RANGES.length;f++){const W={modeId:e.MODE_RANGES[f].modeId,modeLogic:0,linkedTo:0};e.MODE_RANGES_EXTRA.push(W)}}else e.MODE_RANGES_EXTRA=s.MODE_RANGES_EXTRA;F.sendModeRanges(K)}function K(){F.sendAdjustmentRanges(T)}G(0),y()}function L(){let C=0;const d=[t.MSP_SET_RX_MAP,t.MSP_SET_CF_SERIAL_CONFIG];function G(){p.gte(e.CONFIG.apiVersion,H)?(d.push([t.MSP2_SET_TEXT,t.CRAFT_NAME]),d.push([t.MSP2_SET_TEXT,t.PILOT_NAME])):d.push(t.MSP_SET_NAME),d.push(t.MSP_SET_SENSOR_CONFIG),d.push(t.MSP_SET_MIXER_CONFIG),d.push(t.MSP_SET_BEEPER_CONFIG),d.push(t.MSP_SET_BOARD_ALIGNMENT_CONFIG),d.push(t.MSP_SET_ADVANCED_CONFIG),d.push(t.MSP_SET_LOOP_TIME),d.push(t.MSP_SET_ARMING_CONFIG),d.push(t.MSP_SET_MOTOR_3D_CONFIG),d.push(t.MSP_SET_SENSOR_ALIGNMENT),d.push(t.MSP_SET_RX_CONFIG),d.push(t.MSP_SET_FAILSAFE_CONFIG),d.push(t.MSP_SET_FEATURE_CONFIG),d.push(t.MSP_SET_MOTOR_CONFIG),d.push(t.MSP_SET_GPS_CONFIG),d.push(t.MSP_SET_RSSI_CONFIG)}function T(){e.MISC=s.MISC,e.RC_MAP=s.RCMAP,e.SERIAL_CONFIG=s.SERIAL_CONFIG,e.LED_STRIP=s.LED_STRIP,e.LED_COLORS=s.LED_COLORS,e.LED_MODE_COLORS=s.LED_MODE_COLORS,e.ARMING_CONFIG=s.ARMING_CONFIG,e.FC_CONFIG=s.FC_CONFIG,e.MOTOR_3D_CONFIG=s.MOTOR_3D_CONFIG,e.SENSOR_ALIGNMENT=s.SENSOR_ALIGNMENT,e.RX_CONFIG=s.RX_CONFIG,e.FAILSAFE_CONFIG=s.FAILSAFE_CONFIG,e.RXFAIL_CONFIG=s.RXFAIL_CONFIG,e.FEATURE_CONFIG=s.FEATURE_CONFIG,e.MOTOR_CONFIG=s.MOTOR_CONFIG,e.GPS_CONFIG=s.GPS_CONFIG,e.RSSI_CONFIG=s.RSSI_CONFIG,e.BOARD_ALIGNMENT_CONFIG=s.BOARD_ALIGNMENT_CONFIG,p.gte(e.CONFIG.apiVersion,H)?(e.CONFIG.craftName=s.CRAFT_NAME,e.CONFIG.pilotName=s.PILOT_NAME):(e.CONFIG.name=s.CRAFT_NAME,e.CONFIG.displayName=s.DISPLAY_NAME),e.MIXER_CONFIG=s.MIXER_CONFIG,e.SENSOR_CONFIG=s.SENSOR_CONFIG,e.PID_ADVANCED_CONFIG=s.PID_ADVANCED_CONFIG,e.BEEPER_CONFIG.beepers=new J(e.CONFIG),e.BEEPER_CONFIG.beepers.setDisabledMask(s.BEEPER_CONFIG.beepers._beeperDisabledMask),e.BEEPER_CONFIG.dshotBeaconTone=s.BEEPER_CONFIG.dshotBeaconTone,e.BEEPER_CONFIG.dshotBeaconConditions=new J(e.CONFIG,["RX_LOST","RX_SET"]),e.BEEPER_CONFIG.dshotBeaconConditions.setDisabledMask(s.BEEPER_CONFIG.dshotBeaconConditions._beeperDisabledMask)}function y(){if(C<d.length){const B=()=>{C++,y()};Array.isArray(d[C])?O.send_message(d[C][0],F.crunch(...d[C]),!1,B):O.send_message(d[C],F.crunch(d[C]),!1,B)}else k()}T(),G(),y()}function k(){F.sendLedStripConfig(x)}function x(){F.sendLedStripColors(P)}function P(){F.sendLedStripModeColors(U)}function U(){F.sendRxFailConfig(X)}function X(){O.send_message(t.MSP_EEPROM_WRITE,!1,!1,h)}function h(){E(i.getMessage("eeprom_saved_ok")),A.tab_switch_cleanup(function(){O.Promise(t.MSP_SET_REBOOT).then(()=>de()).then(()=>l())})}}Q.virtualMode&&(e.resetState(),e.CONFIG.apiVersion=Q.virtualApiVersion,le(e.CONFIG.activeSensors),oe()),n()}}const w={yaw_fix:0};w.initialize=function(R){const u=this;A.active_tab!="setup"&&(A.active_tab="setup");function g(){O.send_message(t.MSP_STATUS_EX,!1,!1,_)}function _(){O.send_message(t.MSP_MIXER_CONFIG,!1,!1,b)}function b(){a("#content").load("./tabs/setup.html",s)}O.send_message(t.MSP_ACC_TRIM,!1,!1,g);function v(){const l=a("#content .backup"),n=a("#content .restore");l.on("click",()=>Ce(()=>E(i.getMessage("initialSetupBackupSuccess")))),n.on("click",()=>Ne(()=>{Y.setup.initialize(),E(i.getMessage("initialSetupRestoreSuccess"))})),Q.virtualMode?l.addClass("disabled"):(n.addClass("disabled"),p.gte(e.CONFIG.apiVersion,Z)&&a(".backupRestore").hide())}function s(){i.localizePage(),v(),u.initModel(),a("span.roll").text(i.getMessage("initialSetupAttitude",[0])),a("span.pitch").text(i.getMessage("initialSetupAttitude",[0])),a("span.heading").text(i.getMessage("initialSetupAttitude",[0])),m(e.CONFIG.activeSensors,"acc")||(a("a.calibrateAccel").addClass("disabled"),a("default_btn").addClass("disabled")),m(e.CONFIG.activeSensors,"mag")||(a("a.calibrateMag").addClass("disabled"),a("default_btn").addClass("disabled")),u.initializeInstruments(),a("#arming-disable-flag").attr("title",i.getMessage("initialSetupArmingDisableFlagsTooltip")),Ie()?a(".initialSetupRebootBootloader").show():a(".initialSetupRebootBootloader").hide(),a("a.rebootBootloader").click(function(){const S=[];S.push(e.boardHasFlashBootloader()?F.REBOOT_TYPES.BOOTLOADER_FLASH:F.REBOOT_TYPES.BOOTLOADER),O.send_message(t.MSP_SET_REBOOT,S,!1)}),a("a.calibrateAccel").click(function(){const S=a(this);S.hasClass("calibrating")||(S.addClass("calibrating"),A.interval_pause("setup_data_pull"),O.send_message(t.MSP_ACC_CALIBRATION,!1,!1,function(){E(i.getMessage("initialSetupAccelCalibStarted")),a("#accel_calib_running").show(),a("#accel_calib_rest").hide()}),A.timeout_add("button_reset",function(){A.interval_resume("setup_data_pull"),E(i.getMessage("initialSetupAccelCalibEnded")),S.removeClass("calibrating"),a("#accel_calib_running").hide(),a("#accel_calib_rest").show()},2e3))}),a("a.calibrateMag").click(function(){const S=a(this);!S.hasClass("calibrating")&&!S.hasClass("disabled")&&(S.addClass("calibrating"),O.send_message(t.MSP_MAG_CALIBRATION,!1,!1,function(){E(i.getMessage("initialSetupMagCalibStarted")),a("#mag_calib_running").show(),a("#mag_calib_rest").hide()}),A.timeout_add("button_reset",function(){E(i.getMessage("initialSetupMagCalibEnded")),S.removeClass("calibrating"),a("#mag_calib_running").hide(),a("#mag_calib_rest").show()},3e4))});const l=a(".dialogConfirmReset")[0];a("a.resetSettings").click(function(){l.showModal()}),a(".dialogConfirmReset-cancelbtn").click(function(){l.close()}),a(".dialogConfirmReset-confirmbtn").click(function(){l.close(),O.send_message(t.MSP_RESET_CONF,!1,!1,function(){E(i.getMessage("initialSetupSettingsRestored")),A.tab_switch_cleanup(function(){Y.setup.initialize()})})}),a("div#interactive_block > a.reset").text(i.getMessage("initialSetupButtonResetZaxisValue",[u.yaw_fix])),a("div#interactive_block > a.reset").click(function(){u.yaw_fix=e.SENSOR_DATA.kinematics[2]*-1,a(this).text(i.getMessage("initialSetupButtonResetZaxisValue",[u.yaw_fix])),console.log(`YAW reset to 0 deg, fix: ${u.yaw_fix} deg`)});const n=a(".bat-voltage"),o=a(".bat-mah-drawn"),r=a(".bat-mah-drawing"),I=a(".rssi"),N=a(".cpu-temp"),M=a(".arming-disable-flags"),L=a(".GPS_info span.colorToggle"),k=a(".gpsSats"),x=a("dd.roll"),P=a("dd.pitch"),U=a("dd.heading"),X=a(".sonarAltitude"),h=a(".sensor_gyro_hw"),C=a(".sensor_acc_hw"),d=a(".sensor_mag_hw"),G=a(".sensor_baro_hw"),T=a(".sensor_sonar_hw"),y=a(".api-version"),B=a(".build-date"),K=a(".build-info"),f=a(".build-options"),W=function(){let S=["NO_GYRO","FAILSAFE","RX_FAILSAFE","BAD_RX_RECOVERY","BOXFAILSAFE","RUNAWAY_TAKEOFF","THROTTLE","ANGLE","BOOT_GRACE_TIME","NOPREARM","LOAD","CALIBRATING","CLI","CMS_MENU","BST","MSP","PARALYZE","GPS","RESC","RPMFILTER"];p.gte(e.CONFIG.apiVersion,Oe)&&(S.splice(S.indexOf("THROTTLE"),0,"CRASH_DETECTED"),S=S.concat(["REBOOT_REQUIRED","DSHOT_BITBANG"])),p.gte(e.CONFIG.apiVersion,Z)&&(S=S.concat(["ACC_CALIBRATION","MOTOR_PROTOCOL"])),S=S.concat(["ARM_SWITCH"]),M.append('<span id="initialSetupArmingAllowed" i18n="initialSetupArmingAllowed" style="display: none;"></span>');for(let c=0;c<e.CONFIG.armingDisableCount;c++)if(c<S.length-1){const D=`initialSetupArmingDisableFlagsTooltip${S[c]}`;M.append(`<span id="initialSetupArmingDisableFlags${c}" class="cf_tip disarm-flag" title="${i.getMessage(D)}" style="display: none;">${S[c]}</span>`)}else c==e.CONFIG.armingDisableCount-1?M.append(`<span id="initialSetupArmingDisableFlags${c}" class="cf_tip disarm-flag" title="${i.getMessage("initialSetupArmingDisableFlagsTooltipARM_SWITCH")}" style="display: none;">ARM_SWITCH</span>`):M.append(`<span id="initialSetupArmingDisableFlags${c}" class="disarm-flag" style="display: none;">${c+1}</span>`)},te=function(){const S=["NONE","DEFAULT","MPU6050","L3G4200D","MPU3050","L3GD20","MPU6000","MPU6500","MPU9250","ICM20601","ICM20602","ICM20608G","ICM20649","ICM20689","ICM42605","ICM42688P","BMI160","BMI270","LSM6DSO","LSM6DSV16X","VIRTUAL"],c=["DEFAULT","NONE","ADXL345","MPU6050","MMA8452","BMA280","LSM303DLHC","MPU6000","MPU6500","MPU9250","ICM20601","ICM20602","ICM20608G","ICM20649","ICM20689","ICM42605","ICM42688P","BMI160","BMI270","LSM6DSO","LSM6DSV16X","VIRTUAL"],D=["DEFAULT","NONE","HMC5883","AK8975","AK8963","QMC5883","LIS3MDL","MPU925X_AK8963","IST8310"],q=["DEFAULT","NONE","BMP085","MS5611","BMP280","LPS","QMP6988","BMP388","DPS310","2SMPB_02B","VIRTUAL"],V=["NONE","HCSR04","TFMINI","TF02"];p.gte(e.CONFIG.apiVersion,ee)&&O.send_message(t.MSP2_SENSOR_CONFIG_ACTIVE,!1,!1,function(){const j=i.getMessage("initialSetupNotInBuild"),$=i.getMessage("initialSetupNotDetected");e.SENSOR_CONFIG_ACTIVE.gyro_hardware==255?h.text(j):m(e.CONFIG.activeSensors,"gyro")&&e.SENSOR_CONFIG_ACTIVE.gyro_hardware>1?h.text(S[e.SENSOR_CONFIG_ACTIVE.gyro_hardware]):h.text($),e.SENSOR_CONFIG_ACTIVE.acc_hardware==255?C.text(j):m(e.CONFIG.activeSensors,"acc")&&e.SENSOR_CONFIG_ACTIVE.acc_hardware>1?C.text(c[e.SENSOR_CONFIG_ACTIVE.acc_hardware]):C.text($),e.SENSOR_CONFIG_ACTIVE.baro_hardware==255?G.text(j):m(e.CONFIG.activeSensors,"baro")&&e.SENSOR_CONFIG_ACTIVE.baro_hardware>1?G.text(q[e.SENSOR_CONFIG_ACTIVE.baro_hardware]):G.text($),e.SENSOR_CONFIG_ACTIVE.mag_hardware==255?d.text(j):m(e.CONFIG.activeSensors,"mag")&&e.SENSOR_CONFIG_ACTIVE.mag_hardware>1?d.text(D[e.SENSOR_CONFIG_ACTIVE.mag_hardware]):d.text($),e.SENSOR_CONFIG_ACTIVE.sonar_hardware==255?T.text(j):m(e.CONFIG.activeSensors,"sonar")&&e.SENSOR_CONFIG_ACTIVE.sonar_hardware>1?T.text(V[e.SENSOR_CONFIG_ACTIVE.sonar_hardware]):T.text($)})},ae=function(){if(y.text([e.CONFIG.apiVersion]),B.text([e.CONFIG.buildInfo]),e.CONFIG.buildKey.length===32){const S=`https://build.betaflight.com/api/builds/${e.CONFIG.buildKey}`,c=`<span class="buildInfoBtn" title="${i.getMessage("initialSetupInfoBuildInfoConfig")}: ${S}/json">
                                     <a href="${S}/json" target="_blank"><strong>${i.getMessage("initialSetupInfoBuildInfoConfig")}</a></strong></span>`,D=`<span class="buildInfoBtn" title="${i.getMessage("initialSetupInfoBuildInfoLog")}: ${S}/log">
                                     <a href="${S}/log" target="_blank"><strong>${i.getMessage("initialSetupInfoBuildInfoLog")}</a></strong></span>`;K.html(`${c} &nbsp &nbsp ${D}`),a(".build-info a").removeClass("disabled")}else a(".build-info a").addClass("disabled");if(e.CONFIG.buildOptions.length){let S="";f.text="";for(const c of e.CONFIG.buildOptions)S=`${S} &nbsp ${c}`;f.html(`<span class="buildInfoClassOptions" 
                                  title="${i.getMessage("initialSetupInfoBuildOptions")}${S}">
                                  <strong>${i.getMessage("initialSetupInfoBuildOptionsList")}</strong></span>`)}else f.html(i.getMessage(navigator.onLine?"initialSetupInfoBuildOptionsEmpty":"initialSetupNotOnline"))};W(),te(),ae(),m(e.CONFIG.activeSensors,"sonar")||a(".sonarBox").hide();function ie(){a("#initialSetupArmingAllowed").toggle(e.CONFIG.armingDisableFlags===0);for(let V=0;V<e.CONFIG.armingDisableCount;V++)a(`#initialSetupArmingDisableFlags${V}`).css("display",e.CONFIG.armingDisableFlags&1<<V?"inline-block":"none");n.text(i.getMessage("initialSetupBatteryValue",[e.ANALOG.voltage])),o.text(i.getMessage("initialSetupBatteryMahValue",[e.ANALOG.mAhdrawn])),r.text(i.getMessage("initialSetupBatteryAValue",[e.ANALOG.amperage.toFixed(2)])),I.text(i.getMessage("initialSetupRSSIValue",[(e.ANALOG.rssi/1023*100).toFixed(0)])),p.gte(e.CONFIG.apiVersion,ee)&&e.CONFIG.cpuTemp&&N.html(`${e.CONFIG.cpuTemp.toFixed(0)} &#8451;`),L.text(e.GPS_DATA.fix?i.getMessage("gpsFixTrue"):i.getMessage("gpsFixFalse")),L.toggleClass("ready",e.GPS_DATA.fix!=0),k.text(e.GPS_DATA.numSat);const S=e.GPS_DATA.lat/1e7,c=e.GPS_DATA.lon/1e7,D=`https://maps.google.com/?q=${S},${c}`,q=i.getMessage("gpsPositionUnit");a(".GPS_info td.latLon a").prop("href",D).text(`${S.toFixed(4)} / ${c.toFixed(4)} ${q}`)}function _e(){O.send_message(t.MSP_ATTITUDE,!1,!1,function(){x.text(i.getMessage("initialSetupAttitude",[e.SENSOR_DATA.kinematics[0]])),P.text(i.getMessage("initialSetupAttitude",[e.SENSOR_DATA.kinematics[1]])),U.text(i.getMessage("initialSetupAttitude",[e.SENSOR_DATA.kinematics[2]])),u.renderModel(),u.updateInstruments()}),m(e.CONFIG.activeSensors,"sonar")&&O.send_message(t.MSP_SONAR,!1,!1,function(){X.text(`${e.SENSOR_DATA.sonar.toFixed(1)} cm`)})}A.interval_add("setup_data_pull_fast",_e,33,!0),A.interval_add("setup_data_pull_slow",ie,250,!0),A.content_ready(R)}};w.initializeInstruments=function(){const R={size:90,showBox:!1,img_directory:"images/flightindicators/"},u=a.flightIndicator("#attitude","attitude",R),g=a.flightIndicator("#heading","heading",R);this.updateInstruments=function(){u.setRoll(e.SENSOR_DATA.kinematics[0]),u.setPitch(e.SENSOR_DATA.kinematics[1]),g.setHeading(e.SENSOR_DATA.kinematics[2])}};w.initModel=function(){this.model=new Se(a(".model-and-info #canvas_wrapper"),a(".model-and-info #canvas")),a(window).on("resize",a.proxy(this.model.resize,this.model))};w.renderModel=function(){const R=e.SENSOR_DATA.kinematics[1]*-1*.017453292519943295,u=(e.SENSOR_DATA.kinematics[2]*-1-this.yaw_fix)*.017453292519943295,g=e.SENSOR_DATA.kinematics[0]*-1*.017453292519943295;this.model.rotateTo(R,u,g)};w.cleanup=function(R){this.model&&(a(window).off("resize",a.proxy(this.model.resize,this.model)),this.model.dispose()),R&&R()};Y.setup=w;export{w as setup};
