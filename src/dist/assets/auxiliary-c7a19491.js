import{G as v,h as C,j as E,x as A,$ as e,F as t,y as z,i as M,g as B,s as j,z as H,n as W}from"./index-9715db87.js";import{a as J}from"./peripherals-b0d6e618.js";const b={};b.initialize=function(R){v.active_tab_ref=this,v.active_tab="auxiliary";let k=null;function D(){C.send_message(E.MSP_MODE_RANGES,!1,!1,L)}function L(){C.send_message(E.MSP_MODE_RANGES_EXTRA,!1,!1,U)}function U(){C.send_message(E.MSP_BOXIDS,!1,!1,y)}function y(){C.send_message(E.MSP_RSSI_CONFIG,!1,!1,F)}function F(){C.send_message(E.MSP_RC,!1,!1,X)}function X(){A.loadSerialConfig($)}function $(){e("#content").load("./tabs/auxiliary.html",V)}C.send_message(E.MSP_BOXNAMES,!1,!1,D);function w(l,s){const a=e("#tab-auxiliary-templates .mode").clone();let o=t.AUX_CONFIG[l];const g=J(s,o),p=H.camelize(o.replace(/\s+/g,""));return e(a).attr("id",`mode-${l}`),e(a).find(".name").text(g),e(a).find(".helpicon").attr("i18n_title",`auxiliaryHelpMode_${p}`),e(a).data("index",l),e(a).data("id",s),e(a).find(".name").data("modeElement",a),e(a).find("a.addRange").data("modeElement",a),e(a).find("a.addLink").data("modeElement",a),s==0&&e(a).find(".addLink").hide(),a}function N(l){const s=e(l).find(".logic"),c=e(s).find("option");c.remove();let a=c.clone();a.text(M.getMessage("auxiliaryModeLogicOR")),a.val(0),s.append(a),a=c.clone(),a.text(M.getMessage("auxiliaryModeLogicAND")),a.val(1),s.append(a),c.val(0)}function q(l){const s=e("#tab-auxiliary-templates .range"),c=e(s).find(".channel"),a=e(c).find("option");a.remove();let o=a.clone();o.text(M.getMessage("auxiliaryAutoChannelSelect")),o.val(-1),c.append(o);for(let g=0;g<l;g++)o=a.clone(),o.text(`AUX ${g+1}`),o.val(g),c.append(o);a.val(-1),N(s)}function P(){const l=e("#tab-auxiliary-templates .link"),s=e(l).find(".linkedTo"),c=e(s).find("option");c.remove();let a=c.clone();a.text(""),a.val(0),s.append(a);for(let o=1;o<t.AUX_CONFIG.length;o++)a=c.clone(),a.text(t.AUX_CONFIG[o]),a.val(t.AUX_CONFIG_IDS[o]),s.append(a);s.sortSelect(),c.val(0),N(l)}function G(l,s,c,a){const o=e(l).data("index"),g=e(l).find(".ranges"),p={min:[900],max:[2100]};let m=[1300,1700];a!==void 0&&(m=[a.start,a.end]);const _=g.children().length;let r=e("#tab-auxiliary-templates .range").clone();r.attr("id",`mode-${o}-range-${_}`),g.append(r),_==0?e(r).find(".logic").hide():_==1&&g.children().eq(0).find(".logic").show(),e(r).find(".channel-slider").noUiSlider({start:m,behaviour:"snap-drag",margin:25,step:25,connect:!0,range:p,format:wNumb({decimals:0})});const i=`#mode-${o}-range-${_}`;e(`${i} .channel-slider`).Link("lower").to(e(`${i} .lowerLimitValue`)),e(`${i} .channel-slider`).Link("upper").to(e(`${i} .upperLimitValue`));let h=[900,1e3,1200,1400,1500,1600,1800,2e3,2100];e(window).width()<575&&(h=[1e3,1200,1400,1600,1800,2e3]),e(r).find(".pips-channel-range").noUiSlider_pips({mode:"values",values:h,density:4,stepped:!0}),e(r).find(".deleteRange").data("rangeElement",r),e(r).find(".deleteRange").data("modeElement",l),e(r).find("a.deleteRange").click(function(){l=e(this).data("modeElement"),r=e(this).data("rangeElement"),r.remove();const n=e(l).find(".ranges").children();n.length==1&&n.eq(0).find(".logic").hide()}),e(r).find(".channel").val(s),e(r).find(".logic").val(c)}function T(l,s,c){const a=e(l).data("id"),o=e(l).data("index"),g=e(l).find(".ranges"),p=g.children().length;let m=e("#tab-auxiliary-templates .link").clone();m.attr("id",`mode-${o}-link-${p}`),g.append(m),p==0?e(m).find(".logic").hide():p==1&&g.children().eq(0).find(".logic").show();const _=e(m).find(".linkedTo");e(_).find(`option[value="${a}"]`).prop("disabled",!0),e(m).find(".deleteLink").data("linkElement",m),e(m).find(".deleteLink").data("modeElement",l),e(m).find("a.deleteLink").click(function(){l=e(this).data("modeElement"),m=e(this).data("linkElement"),m.remove();const r=e(l).find(".ranges").children();r.length==1&&r.eq(0).find(".logic").hide()}),e(m).find(".linkedTo").val(c),e(m).find(".logic").val(s)}function V(){let l=t.RC.active_channels-4;q(l),P();const s=e(".tab-auxiliary .modes");for(let i=0;i<t.AUX_CONFIG.length;i++){const h=t.AUX_CONFIG_IDS[i],n=w(i,h);s.append(n);for(let d=0;d<t.MODE_RANGES.length;d++){const f=t.MODE_RANGES[d],u=t.MODE_RANGES_EXTRA[d];if(!(f.id!=h||u.id!=h))if(h==0||u.linkedTo==0){const x=f.range;if(x.start>=x.end)continue;G(n,f.auxChannelIndex,u.modeLogic,x)}else T(n,u.modeLogic,u.linkedTo)}}const c=Math.max(...t.AUX_CONFIG.map(i=>i.length));e(".tab-auxiliary .mode .info").css("min-width",`${Math.round(c*z("A"))}px`),e("a.addRange").click(function(){const i=e(this).data("modeElement");G(i,-1,0)}),e("a.addLink").click(function(){const i=e(this).data("modeElement");T(i,0,0)}),M.localizePage(),e("a.save").click(function(){const i=t.MODE_RANGES.length;t.MODE_RANGES=[],t.MODE_RANGES_EXTRA=[],e(".tab-auxiliary .modes .mode").each(function(){const n=e(this),d=n.data("id");e(n).find(".range").each(function(){const f=e(this).find(".channel-slider").val(),u={id:d,auxChannelIndex:parseInt(e(this).find(".channel").val()),range:{start:f[0],end:f[1]}};t.MODE_RANGES.push(u);const x={id:d,modeLogic:parseInt(e(this).find(".logic").val()),linkedTo:0};t.MODE_RANGES_EXTRA.push(x)}),e(n).find(".link").each(function(){const f=parseInt(e(this).find(".linkedTo").val());if(f==0)e(this).remove();else{const u={id:d,auxChannelIndex:0,range:{start:900,end:900}};t.MODE_RANGES.push(u);const x={id:d,modeLogic:parseInt(e(this).find(".logic").val()),linkedTo:f};t.MODE_RANGES_EXTRA.push(x)}})});for(let n=t.MODE_RANGES.length;n<i;n++){const d={id:0,auxChannelIndex:0,range:{start:900,end:900}};t.MODE_RANGES.push(d);const f={id:0,modeLogic:0,linkedTo:0};t.MODE_RANGES_EXTRA.push(f)}A.sendModeRanges(h);function h(){A.writeConfiguration(!1)}});function a(i){return i<900?i=900:i>2100&&(i=2100),i}function o(i,h){const n=(h-900)/1200*100;e(".modes .ranges .range").each(function(){parseInt(e(this).find(".channel").val())===i&&e(this).find(".marker").css("left",`${n}%`)})}function g(){C.send_message(E.MSP_RC,!1,!1,p)}function p(){let i=!1;for(let n=0;n<t.AUX_CONFIG.length;n++){let d=e(`#mode-${n}`);if(d.find(" .range").length==0&&d.find(" .link").length==0){d.removeClass("off").removeClass("on").removeClass("disabled");continue}if(W(t.CONFIG.mode,n))e(".mode .name").eq(n).data("modeElement").addClass("on").removeClass("off").removeClass("disabled"),n==0&&e(".mode .name").eq(n).html(t.AUX_CONFIG[n]);else if(n==0){let f=!1;if(t.CONFIG.armingDisableCount>0){const u=1<<t.CONFIG.armingDisableCount-1;(t.CONFIG.armingDisableFlags&u)>0&&(f=!0)}f?(e(".mode .name").eq(n).data("modeElement").removeClass("on").removeClass("off").addClass("disabled"),e(".mode .name").eq(n).html(`${t.AUX_CONFIG[n]}<br>${M.getMessage("auxiliaryDisabled")}`)):(e(".mode .name").eq(n).data("modeElement").removeClass("on").removeClass("disabled").addClass("off"),e(".mode .name").eq(n).html(t.AUX_CONFIG[n]))}else e(".mode .name").eq(n).data("modeElement").removeClass("on").removeClass("disabled").addClass("off");i=!0}let h=_&&i;for(let n=0;n<t.AUX_CONFIG.length;n++){let d=e(`#mode-${n}`);d.find(" .range").length==0&&d.find(" .link").length==0&&d.toggle(!h)}m(t.RC.channels,t.RC.active_channels,t.RSSI_CONFIG.channel),l=t.RC.active_channels-4;for(let n=0;n<l;n++)o(n,a(t.RC.channels[n+4]))}function m(i,h,n){const d=e('.tab-auxiliary select.channel option[value="-1"]:selected');if(d.length===0){k=null;return}const f=function(){k=i.slice(0)};if(!k||i.length===0)return f();let u=i.map(function(I,O){return Math.abs(k[O]-I)});u=u.slice(0,h);const x=u.reduce(function(I,O){return I>O?I:O},0);if(x<100)return f();const S=u.indexOf(x);return S>=4&&S!=n-1&&d.parent().val(S-4),f()}let _=!1;const r=B("hideUnusedModes");e("input#switch-toggle-unused").change(function(){_=e(this).prop("checked"),j({hideUnusedModes:_}),p()}).prop("checked",!!r.hideUnusedModes).change(),p(),v.interval_add("aux_data_pull",g,50),v.interval_add("status_pull",function(){C.send_message(E.MSP_STATUS)},250,!0),v.content_ready(R)}};b.cleanup=function(R){R&&R()};export{b as auxiliary};
