import{G as d,T as Q,x as _,h as i,j as a,m as c,F as n,w as S,$ as e,i as g,A as Z,E as B,_ as b,t as V}from"./index-9715db87.js";const R={analyticsChanges:{}};R.initialize=function(m){const r=this;d.active_tab!="configuration"&&(d.active_tab="configuration",d.configuration_loaded=!0);function U(){_.loadSerialConfig($)}function $(){Promise.resolve(!0).then(()=>i.promise(a.MSP_FEATURE_CONFIG)).then(()=>i.promise(a.MSP_BEEPER_CONFIG)).then(()=>i.promise(a.MSP_BOARD_ALIGNMENT_CONFIG)).then(()=>i.promise(a.MSP_ACC_TRIM)).then(()=>i.promise(a.MSP_ARMING_CONFIG)).then(()=>i.promise(a.MSP_RC_DEADBAND)).then(()=>i.promise(a.MSP_SENSOR_CONFIG)).then(()=>i.promise(a.MSP_SENSOR_ALIGNMENT)).then(()=>c.lt(n.CONFIG.apiVersion,S)?i.promise(a.MSP_NAME):Promise.resolve(!0)).then(()=>c.gte(n.CONFIG.apiVersion,S)?i.promise(a.MSP2_GET_TEXT,_.crunch(a.MSP2_GET_TEXT,a.CRAFT_NAME)):Promise.resolve(!0)).then(()=>i.promise(a.MSP_RX_CONFIG)).then(()=>c.gte(n.CONFIG.apiVersion,S)?i.promise(a.MSP2_GET_TEXT,_.crunch(a.MSP2_GET_TEXT,a.PILOT_NAME)):Promise.resolve(!0)).then(()=>i.promise(a.MSP_ADVANCED_CONFIG)).then(()=>H())}function H(){e("#content").load("./tabs/configuration.html",X)}U();function X(){r.analyticsChanges={};const C=e(".tab-configuration .features");n.FEATURE_CONFIG.features.generateElements(C);const x=e(".tab-configuration .dshotbeeper"),I=e("select.dshotBeeperBeaconTone"),v=e("tbody.dshotBeaconConditions"),k=e("tr.dshotBeaconSwitch");for(let t=1;t<=5;t++)I.append(`<option value="${t}">${t}</option>`);x.show(),I.change(function(){n.BEEPER_CONFIG.dshotBeaconTone=I.val()}),I.val(n.BEEPER_CONFIG.dshotBeaconTone);const y=e(".beepers .beeper-template");k.hide(),n.BEEPER_CONFIG.dshotBeaconConditions.generateElements(y,v),e("input.condition",v).change(function(){const t=e(this);n.BEEPER_CONFIG.dshotBeaconConditions.updateData(t)});const W=e(".beepers .beeper-configuration"),z=e(".tab-configuration .beepers");n.BEEPER_CONFIG.beepers.generateElements(y,W),g.localizePage();const N=["CW 0°","CW 90°","CW 180°","CW 270°","CW 0° flip","CW 90° flip","CW 180° flip","CW 270° flip"];c.gte(n.CONFIG.apiVersion,Z)&&N.push("Custom");const P=e(".tab-configuration .gyro_align_content"),Y=e(".tab-configuration .legacy_gyro_alignment"),q=e(".tab-configuration .legacy_accel_alignment"),O=e("select.gyroalign"),T=e("select.accalign"),f=e("select.magalign"),u=e("select.gyro_to_use"),A=e("select.gyro_1_align"),M=e("select.gyro_2_align");P.hide();for(let t=0;t<N.length;t++)O.append(`<option value="${t+1}">${N[t]}</option>`),T.append(`<option value="${t+1}">${N[t]}</option>`),f.append(`<option value="${t+1}">${N[t]}</option>`);O.val(n.SENSOR_ALIGNMENT.align_gyro),T.val(n.SENSOR_ALIGNMENT.align_acc),f.val(n.SENSOR_ALIGNMENT.align_mag),O.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.align_gyro&&(o=e(this).find("option:selected").text()),r.analyticsChanges.GyroAlignment=o,n.SENSOR_ALIGNMENT.align_gyro=t}),T.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.align_acc&&(o=e(this).find("option:selected").text()),r.analyticsChanges.AccAlignment=o,n.SENSOR_ALIGNMENT.align_acc=t}),f.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.align_mag&&(o=e(this).find("option:selected").text()),r.analyticsChanges.MagAlignment=o,n.SENSOR_ALIGNMENT.align_mag=t}),P.show(),Y.hide(),q.hide();const F={DETECTED_GYRO_1:1,DETECTED_GYRO_2:2,DETECTED_DUAL_GYROS:128},h=(n.SENSOR_ALIGNMENT.gyro_detection_flags&F.DETECTED_GYRO_1)!=0,G=(n.SENSOR_ALIGNMENT.gyro_detection_flags&F.DETECTED_GYRO_2)!=0,K=(n.SENSOR_ALIGNMENT.gyro_detection_flags&F.DETECTED_DUAL_GYROS)!=0;h&&u.append(`<option value="0">${g.getMessage("configurationSensorGyroToUseFirst")}</option>`),G&&u.append(`<option value="1">${g.getMessage("configurationSensorGyroToUseSecond")}</option>`),K&&u.append(`<option value="2">${g.getMessage("configurationSensorGyroToUseBoth")}</option>`);for(let t=0;t<N.length;t++)A.append(`<option value="${t+1}">${N[t]}</option>`),M.append(`<option value="${t+1}">${N[t]}</option>`);u.val(n.SENSOR_ALIGNMENT.gyro_to_use),A.val(n.SENSOR_ALIGNMENT.gyro_1_align),M.val(n.SENSOR_ALIGNMENT.gyro_2_align),e(".gyro_alignment_inputs_first").toggle(h),e(".gyro_alignment_inputs_second").toggle(G),e(".gyro_alignment_inputs_selection").toggle(h||G),e(".gyro_alignment_inputs_notfound").toggle(!h&&!G),A.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.gyro_1_align&&(o=e(this).find("option:selected").text()),r.analyticsChanges.Gyro1Alignment=o,n.SENSOR_ALIGNMENT.gyro_1_align=t}),M.change(function(){let t=parseInt(e(this).val()),o;t!==n.SENSOR_ALIGNMENT.gyro_2_align&&(o=e(this).find("option:selected").text()),r.analyticsChanges.Gyro2Alignment=o,n.SENSOR_ALIGNMENT.gyro_2_align=t});const D=e("input.gyroFrequency"),l=e("select.gyroSyncDenom"),E=e("select.pidProcessDenom");function L(t,o,p){let s;p===0?s=g.getMessage("configurationSpeedPidNoGyro",{value:o}):s=g.getMessage("configurationKHzUnitLabel",{value:(p/o).toFixed(2)}),t.append(`<option value="${o}">${s}</option>`)}const j=function(t){D.hide();const o=l.val();l.empty();const p=8;for(let s=1;s<=p;s++)L(l,s,t);l.val(o),l.change()},J=function(t){l.hide();let o;t===0?o=g.getMessage("configurationSpeedGyroNoGyro"):o=g.getMessage("configurationKHzUnitLabel",{value:(t/1e3).toFixed(2)}),D.val(o)};e("div.gyroUse32kHz").hide(),c.gte(n.CONFIG.apiVersion,B)?J(n.CONFIG.sampleRateHz):j(8),l.val(n.PID_ADVANCED_CONFIG.gyro_sync_denom),e(".systemconfigNote").html(g.getMessage("configurationLoopTimeHelp")),l.change(function(){const t=parseInt(E.val());let o;c.gte(n.CONFIG.apiVersion,B)?o=n.CONFIG.sampleRateHz/1e3:(o=8,o/=parseInt(e(this).val())),E.empty();const p=8;for(let s=1;s<=p;s++)L(E,s,o);E.val(t)}).change(),E.val(n.PID_ADVANCED_CONFIG.pid_process_denom),e('input[id="accHardwareSwitch"]').prop("checked",n.SENSOR_CONFIG.acc_hardware!==1),e('input[id="baroHardwareSwitch"]').prop("checked",n.SENSOR_CONFIG.baro_hardware!==1),e('input[id="magHardwareSwitch"]').prop("checked",n.SENSOR_CONFIG.mag_hardware!==1),c.gte(n.CONFIG.apiVersion,S)?(e('input[name="craftName"]').val(n.CONFIG.craftName),e('input[name="pilotName"]').val(n.CONFIG.pilotName)):(e('input[name="craftName"]').val(n.CONFIG.name),e(".pilotName").hide()),e('input[name="fpvCamAngleDegrees"]').val(n.RX_CONFIG.fpvCamAngleDegrees),e('input[name="fpvCamAngleDegrees"]').attr("max",90),e('input[name="board_align_roll"]').val(n.BOARD_ALIGNMENT_CONFIG.roll),e('input[name="board_align_pitch"]').val(n.BOARD_ALIGNMENT_CONFIG.pitch),e('input[name="board_align_yaw"]').val(n.BOARD_ALIGNMENT_CONFIG.yaw),e('input[name="roll"]').val(n.CONFIG.accelerometerTrims[1]),e('input[name="pitch"]').val(n.CONFIG.accelerometerTrims[0]),e("._smallAngle").show(),e('input[id="configurationSmallAngle"]').val(n.ARMING_CONFIG.small_angle);function w(){n.FEATURE_CONFIG.features.isEnabled("GPS")?e(".gpsSettings").show():e(".gpsSettings").hide()}e("input.feature",C).change(function(){const t=e(this);n.FEATURE_CONFIG.features.updateData(t),b(n.FEATURE_CONFIG.features),t.attr("name")==="GPS"&&w()}),e('input[id="accHardwareSwitch"]').change(function(){const t=e(this).is(":checked");e(".accelNeeded").toggle(t)}).change(),e(C).filter("select").change(function(){const t=e(this);n.FEATURE_CONFIG.features.updateData(t),b(n.FEATURE_CONFIG.features)}),e("input.condition",z).change(function(){const t=e(this);n.BEEPER_CONFIG.beepers.updateData(t)}),w(),e("a.save").on("click",function(){n.BOARD_ALIGNMENT_CONFIG.roll=parseInt(e('input[name="board_align_roll"]').val()),n.BOARD_ALIGNMENT_CONFIG.pitch=parseInt(e('input[name="board_align_pitch"]').val()),n.BOARD_ALIGNMENT_CONFIG.yaw=parseInt(e('input[name="board_align_yaw"]').val()),n.CONFIG.accelerometerTrims[1]=parseInt(e('input[name="roll"]').val()),n.CONFIG.accelerometerTrims[0]=parseInt(e('input[name="pitch"]').val()),n.ARMING_CONFIG.small_angle=parseInt(e('input[id="configurationSmallAngle"]').val()),n.SENSOR_ALIGNMENT.gyro_to_use=parseInt(u.val()),n.PID_ADVANCED_CONFIG.gyro_sync_denom=parseInt(l.val());const t=parseInt(E.val());if(t!==n.PID_ADVANCED_CONFIG.pid_process_denom){const p=E.find("option:selected").text();r.analyticsChanges.PIDLoopSettings=`denominator: ${t} | frequency: ${p}`}else r.analyticsChanges.PIDLoopSettings=void 0;n.PID_ADVANCED_CONFIG.pid_process_denom=t,n.RX_CONFIG.fpvCamAngleDegrees=parseInt(e('input[name="fpvCamAngleDegrees"]').val()),V.sendSaveAndChangeEvents(V.EVENT_CATEGORIES.FLIGHT_CONTROLLER,r.analyticsChanges,"configuration"),r.analyticsChanges={},n.SENSOR_CONFIG.acc_hardware=e('input[id="accHardwareSwitch"]').is(":checked")?0:1,n.SENSOR_CONFIG.baro_hardware=e('input[id="baroHardwareSwitch"]').is(":checked")?0:1,n.SENSOR_CONFIG.mag_hardware=e('input[id="magHardwareSwitch"]').is(":checked")?0:1,c.gte(n.CONFIG.apiVersion,S)?(n.CONFIG.craftName=e('input[name="craftName"]').val().trim(),n.CONFIG.pilotName=e('input[name="pilotName"]').val().trim()):n.CONFIG.name=e('input[name="craftName"]').val().trim();function o(){Promise.resolve(!0).then(()=>i.promise(a.MSP_SET_FEATURE_CONFIG,_.crunch(a.MSP_SET_FEATURE_CONFIG))).then(()=>i.promise(a.MSP_SET_BEEPER_CONFIG,_.crunch(a.MSP_SET_BEEPER_CONFIG))).then(()=>i.promise(a.MSP_SET_BOARD_ALIGNMENT_CONFIG,_.crunch(a.MSP_SET_BOARD_ALIGNMENT_CONFIG))).then(()=>i.promise(a.MSP_SET_RC_DEADBAND,_.crunch(a.MSP_SET_RC_DEADBAND))).then(()=>i.promise(a.MSP_SET_SENSOR_ALIGNMENT,_.crunch(a.MSP_SET_SENSOR_ALIGNMENT))).then(()=>i.promise(a.MSP_SET_ADVANCED_CONFIG,_.crunch(a.MSP_SET_ADVANCED_CONFIG))).then(()=>i.promise(a.MSP_SET_ACC_TRIM,_.crunch(a.MSP_SET_ACC_TRIM))).then(()=>i.promise(a.MSP_SET_ARMING_CONFIG,_.crunch(a.MSP_SET_ARMING_CONFIG))).then(()=>i.promise(a.MSP_SET_SENSOR_CONFIG,_.crunch(a.MSP_SET_SENSOR_CONFIG))).then(()=>c.gte(n.CONFIG.apiVersion,S)?i.promise(a.MSP2_SET_TEXT,_.crunch(a.MSP2_SET_TEXT,a.CRAFT_NAME)):i.promise(a.MSP_SET_NAME,_.crunch(a.MSP_SET_NAME))).then(()=>c.gte(n.CONFIG.apiVersion,S)?i.promise(a.MSP2_SET_TEXT,_.crunch(a.MSP2_SET_TEXT,a.PILOT_NAME)):Promise.resolve(!0)).then(()=>i.promise(a.MSP_SET_RX_CONFIG,_.crunch(a.MSP_SET_RX_CONFIG))).then(()=>_.writeConfiguration(!0))}_.sendSerialConfig(o)}),d.interval_add("status_pull",function(){i.send_message(a.MSP_STATUS)},250,!0),d.content_ready(m)}};R.cleanup=function(m){m&&m()};Q.configuration=R;export{R as configuration};
