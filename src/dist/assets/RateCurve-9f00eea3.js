import{F as l,m as N,E as w}from"./index-9715db87.js";const p=1e3,C=1500,d=2e3,g=function(o){this.useLegacyCurve=o,this.maxAngularVel=null,this.constrain=function(e,s,t){return Math.max(s,Math.min(e,t))},this.rcCommand=function(e,s,t){let i=Math.min(Math.max(Math.abs(e-C)-t,0),500)*s;return e<C&&(i=-i),i},this.drawRateCurve=function(e,s,t,a,i,n,_,r,u,c){const R=c/(2*_),T=r.lineWidth;r.save(),r.translate(u/2,c/2),r.beginPath();let h=p;for(r.moveTo(-500,-R*this.rcCommandRawToDegreesPerSecond(h,e,s,t,a,i,n)),h=h+T;h<=d;)r.lineTo(h-C,-R*this.rcCommandRawToDegreesPerSecond(h,e,s,t,a,i,n)),h=h+T;r.stroke(),r.restore()},this.drawLegacyRateCurve=function(e,s,t,a,i,n){let _=n*s;_=_+1/(1-_/n*e),a.beginPath(),a.moveTo(0,n),a.quadraticCurveTo(i*11/20,n-_/2*(1-t),i,n-_),a.stroke()},this.drawStickPosition=function(e,s,t,a,i,n,_,r,u,c){const T=u.canvas.height/2/r,h=this.rcCommandRawToDegreesPerSecond(e,s,t,a,i,n,_);return e!=null&&(u.save(),u.fillStyle=c||"#000000",u.translate(u.canvas.width/2,u.canvas.height/2),u.beginPath(),u.arc(e-1500,-T*h,u.canvas.height/60,0,2*Math.PI),u.fill(),u.restore()),Math.abs(h)<.5?0:h.toFixed(0)},this.getBetaflightRates=function(e,s,t,a,i,n,_){let r;a>2&&(a=a+(a-2)*14.54);let u,c;if(u=3,c=200,i>0&&(e=e*Math.pow(s,u)*i+e*(1-i)),n){const R=1/this.constrain(1-s*t,.01,1);r=c*a*e,r=r*R}else r=(t*100+27)*e/16/4.1;return r=this.constrain(r,-1*_,_),r},this.getRaceflightRates=function(e,s,t,a){let i=(1+.01*a*(e*e-1))*e;return i=i*(t+Math.abs(i)*t*s*.01),i},this.getKISSRates=function(e,s,t,a,i){const n=1-s*t,_=e*e;return e=(e*_*i+e*(1-i))*(a/10),2e3*(1/n)*e},this.getActualRates=function(e,s,t,a,i){let n;const _=s*(Math.pow(e,5)*i+e*(1-i));return n=Math.max(0,t-a),n=e*a+n*_,n},this.getQuickRates=function(e,s,t,a,i){a=a*200,t=Math.max(t,a);let n;const _=(t/a-1)/(t/a);return n=1/(1-(Math.pow(s,3)*i+s*(1-i))*_),n=e*a*n,n},this.getCurrentRates=function(){const e={roll_rate:l.RC_TUNING.roll_rate,pitch_rate:l.RC_TUNING.pitch_rate,yaw_rate:l.RC_TUNING.yaw_rate,rc_rate:l.RC_TUNING.RC_RATE,rc_rate_yaw:l.RC_TUNING.rcYawRate,rc_expo:l.RC_TUNING.RC_EXPO,rc_yaw_expo:l.RC_TUNING.RC_YAW_EXPO,rc_rate_pitch:l.RC_TUNING.rcPitchRate,rc_pitch_expo:l.RC_TUNING.RC_PITCH_EXPO,superexpo:l.FEATURE_CONFIG.features.isEnabled("SUPEREXPO_RATES"),deadband:l.RC_DEADBAND_CONFIG.deadband,yawDeadband:l.RC_DEADBAND_CONFIG.yaw_deadband,roll_rate_limit:l.RC_TUNING.roll_rate_limit,pitch_rate_limit:l.RC_TUNING.pitch_rate_limit,yaw_rate_limit:l.RC_TUNING.yaw_rate_limit};if(e.superexpo=!0,N.gte(l.CONFIG.apiVersion,w))switch(l.RC_TUNING.rates_type){case l.RATES_TYPE.RACEFLIGHT:e.roll_rate*=100,e.pitch_rate*=100,e.yaw_rate*=100,e.rc_rate*=1e3,e.rc_rate_yaw*=1e3,e.rc_rate_pitch*=1e3,e.rc_expo*=100,e.rc_yaw_expo*=100,e.rc_pitch_expo*=100;break;case l.RATES_TYPE.ACTUAL:e.roll_rate*=1e3,e.pitch_rate*=1e3,e.yaw_rate*=1e3,e.rc_rate*=1e3,e.rc_rate_yaw*=1e3,e.rc_rate_pitch*=1e3;break;case l.RATES_TYPE.QUICKRATES:e.roll_rate*=1e3,e.pitch_rate*=1e3,e.yaw_rate*=1e3;break}return e}};g.prototype.rcCommandRawToDegreesPerSecond=function(o,e,s,t,a,i,n){let _;if(e!==void 0&&s!==void 0&&t!==void 0){let r=this.rcCommand(o,1,i);N.gte(l.CONFIG.apiVersion,w)?r=r/(500-i):r=r/500;const u=Math.abs(r);switch(l.RC_TUNING.rates_type){case l.RATES_TYPE.RACEFLIGHT:_=this.getRaceflightRates(r,e,s,t);break;case l.RATES_TYPE.KISS:_=this.getKISSRates(r,u,e,s,t);break;case l.RATES_TYPE.ACTUAL:_=this.getActualRates(r,u,e,s,t);break;case l.RATES_TYPE.QUICKRATES:_=this.getQuickRates(r,u,e,s,t);break;default:_=this.getBetaflightRates(r,u,e,s,t,a,n);break}}return _};g.prototype.getMaxAngularVel=function(o,e,s,t,a,i){let n;return this.useLegacyCurve||(n=this.rcCommandRawToDegreesPerSecond(d,o,e,s,t,a,i)),n};g.prototype.setMaxAngularVel=function(o){return this.maxAngularVel=Math.ceil(o/200)*200,this.maxAngularVel};g.prototype.draw=function(o,e,s,t,a,i,n,_){if(o!==void 0&&e!==void 0&&s!==void 0){const r=_.canvas.height,u=_.canvas.width;this.useLegacyCurve?this.drawLegacyRateCurve(o,e,s,_,u,r):this.drawRateCurve(o,e,s,t,a,i,n,_,u,r)}};export{g as R};
